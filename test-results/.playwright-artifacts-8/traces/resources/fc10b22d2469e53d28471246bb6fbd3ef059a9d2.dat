globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { ServiceBadInputError, ServiceExternalBadOutputError, ServiceUnhandledResponseError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { currentContractInfoAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/current-contract-info-atoms.ts";
import { API, generateOperationID } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/index.ts";
import { areCheckBypassed } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/flags.ts";
import { atomWithErrorReset } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/atomWithRetryableQuery.ts";
export var StatoPod = /* @__PURE__ */ ((StatoPod2) => {
  StatoPod2["Disalimentato"] = "DISALIMENTATO";
  StatoPod2["Libero"] = "LIBERO";
  StatoPod2["NonAttivabile"] = "NON ATTIVABILE";
  StatoPod2["Inesistente"] = "INESISTENTE";
  StatoPod2["Attivo"] = "ATTIVO";
  StatoPod2["Errore"] = "ERRORE";
  StatoPod2["Altro_Fornitore"] = "ATTIVO_ALTRO_FORNITORE";
  return StatoPod2;
})(StatoPod || {});
const url = `${API}/webOrderCommonServices/checkPod`;
async function checkPod(payload) {
  if (areCheckBypassed()) {
    return {
      status: "INESISTENTE" /* Inesistente */
    };
  }
  const logHash = generateOperationID();
  const response = await fetch(url, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Accept: "application/json"
    },
    body: JSON.stringify({
      POD: payload.pod,
      source: "SALESUP",
      codiceAgente: "FAKE001002",
      logHash,
      idLead: payload.idLead,
      plicoCode: payload.plicoCode,
      salesProcessForLog: payload.salesProcessForLog
    })
  });
  if (response.status !== 200) {
    throw new ServiceUnhandledResponseError(response.statusText, logHash);
  }
  const data = await response.json();
  switch (data.esito) {
    case "KO_RESPONSE_NULL":
      throw new ServiceExternalBadOutputError(data.esito, logHash, data);
    case "KO_BAD_REQUEST":
    case "KO_INPUT_NON_VALIDO":
      throw new ServiceBadInputError(data.esito, logHash, data);
    case "OK":
      break;
    default:
      throw new ServiceUnhandledResponseError(data.esito, logHash, data);
  }
  const stato = data.stato;
  if (["DISALIMENTATO", "LIBERO", "NON ATTIVABILE", "INESISTENTE", "ATTIVO", "ATTIVO_ALTRO_FORNITORE", "ERRORE"].indexOf(stato) === -1) {
    throw new ServiceUnhandledResponseError(data.esito, logHash, data);
  }
  return {
    kw: data.ultimaPotDisp,
    status: stato,
    logHash
  };
}
export const atomWithCheckPod = (pod) => {
  return atomWithErrorReset(async (get) => {
    const contract = get(currentContractInfoAtom);
    const idLead = contract.idLead;
    const plicoCode = await contract.plicoCode;
    const salesProcessForLog = await contract.salesProcessForLog;
    return checkPod({
      idLead,
      plicoCode,
      salesProcessForLog,
      pod
    });
  });
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLFNBQ0VBLHNCQUNBQywrQkFDQUMscUNBQ0s7QUFDUCxTQUFTQywrQkFBK0I7QUFDeEMsU0FBU0MsS0FBS0MsMkJBQTJCO0FBQ3pDLFNBQVNDLHdCQUF3QjtBQUNqQyxTQUFTQywwQkFBMEI7QUFpRTVCLFdBQUtDLFdBQUwsa0JBQUtBLGNBQUw7QUFRTEMsK0JBQWdCO0FBUWhCQyx3QkFBUztBQVdUQywrQkFBZ0I7QUFTaEJDLDZCQUFjO0FBUWRDLHdCQUFTO0FBVVRDLHdCQUFTO0FBQ1RDLGlDQUFrQjtBQXZEUlA7QUFBQUE7QUEwRFosTUFBTVEsTUFBTSxHQUFHWixHQUFHO0FBRWxCLGVBQWVhLFNBQVNDLFNBS3JCO0FBQ0QsTUFBSVosaUJBQWlCLEdBQUc7QUFDdEIsV0FBTztBQUFBLE1BQ0xhLFFBQVFYO0FBQUFBLElBQ1Y7QUFBQSxFQUNGO0FBRUEsUUFBTVksVUFBVWYsb0JBQW9CO0FBRXBDLFFBQU1nQixXQUFXLE1BQU1DLE1BQU1OLEtBQUs7QUFBQSxJQUNoQ08sUUFBUTtBQUFBLElBQ1JDLFNBQVM7QUFBQSxNQUNQLGdCQUFnQjtBQUFBLE1BQ2hCQyxRQUFRO0FBQUEsSUFDVjtBQUFBLElBQ0FDLE1BQU1DLEtBQUtDLFVBQVU7QUFBQSxNQUNuQkMsS0FBS1gsUUFBUVk7QUFBQUEsTUFDYkMsUUFBUTtBQUFBLE1BQ1JDLGNBQWM7QUFBQSxNQUNkWjtBQUFBQSxNQUNBYSxRQUFRZixRQUFRZTtBQUFBQSxNQUNoQkMsV0FBV2hCLFFBQVFnQjtBQUFBQSxNQUNuQkMsb0JBQW9CakIsUUFBUWlCO0FBQUFBLElBQzlCLENBQUM7QUFBQSxFQUNILENBQUM7QUFFRCxNQUFJZCxTQUFTRixXQUFXLEtBQUs7QUFDM0IsVUFBTSxJQUFJakIsOEJBQThCbUIsU0FBU2UsWUFBWWhCLE9BQU87QUFBQSxFQUN0RTtBQUVBLFFBQU1pQixPQUFRLE1BQU1oQixTQUFTaUIsS0FBSztBQUVsQyxVQUFRRCxLQUFLRSxPQUFLO0FBQUEsSUFDaEIsS0FBSztBQUNILFlBQU0sSUFBSXRDLDhCQUE4Qm9DLEtBQUtFLE9BQU9uQixTQUFTaUIsSUFBSTtBQUFBLElBQ25FLEtBQUs7QUFBQSxJQUNMLEtBQUs7QUFDSCxZQUFNLElBQUlyQyxxQkFBcUJxQyxLQUFLRSxPQUFPbkIsU0FBU2lCLElBQUk7QUFBQSxJQUMxRCxLQUFLO0FBQ0g7QUFBQSxJQUNGO0FBQ0UsWUFBTSxJQUFJbkMsOEJBQThCbUMsS0FBS0UsT0FBT25CLFNBQVNpQixJQUFJO0FBQUEsRUFDckU7QUFFQSxRQUFNRyxRQUFRSCxLQUFLRztBQUVuQixNQUNFLENBQ0UsaUJBQ0EsVUFDQSxrQkFDQSxlQUNBLFVBQ0EsMEJBQ0EsUUFBUSxFQUNSQyxRQUFRRCxLQUFLLE1BQU0sSUFDckI7QUFDQSxVQUFNLElBQUl0Qyw4QkFBOEJtQyxLQUFLRSxPQUFPbkIsU0FBU2lCLElBQUk7QUFBQSxFQUNuRTtBQUVBLFNBQU87QUFBQSxJQUNMSyxJQUFJTCxLQUFLTTtBQUFBQSxJQUNUeEIsUUFBUXFCO0FBQUFBLElBQ1JwQjtBQUFBQSxFQUNGO0FBQ0Y7QUFFTyxhQUFNd0IsbUJBQW1CQSxDQUFDZCxRQUFnQjtBQUMvQyxTQUFPdkIsbUJBQW1CLE9BQU9zQyxRQUFRO0FBQ3ZDLFVBQU1DLFdBQVdELElBQUkxQyx1QkFBdUI7QUFDNUMsVUFBTThCLFNBQVNhLFNBQVNiO0FBQ3hCLFVBQU1DLFlBQVksTUFBTVksU0FBU1o7QUFDakMsVUFBTUMscUJBQXFCLE1BQU1XLFNBQVNYO0FBRTFDLFdBQU9sQixTQUFTO0FBQUEsTUFDZGdCO0FBQUFBLE1BQ0FDO0FBQUFBLE1BQ0FDO0FBQUFBLE1BQ0FMO0FBQUFBLElBQ0YsQ0FBQztBQUFBLEVBQ0gsQ0FBQztBQUNIIiwibmFtZXMiOlsiU2VydmljZUJhZElucHV0RXJyb3IiLCJTZXJ2aWNlRXh0ZXJuYWxCYWRPdXRwdXRFcnJvciIsIlNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yIiwiY3VycmVudENvbnRyYWN0SW5mb0F0b20iLCJBUEkiLCJnZW5lcmF0ZU9wZXJhdGlvbklEIiwiYXJlQ2hlY2tCeXBhc3NlZCIsImF0b21XaXRoRXJyb3JSZXNldCIsIlN0YXRvUG9kIiwiRGlzYWxpbWVudGF0byIsIkxpYmVybyIsIk5vbkF0dGl2YWJpbGUiLCJJbmVzaXN0ZW50ZSIsIkF0dGl2byIsIkVycm9yZSIsIkFsdHJvX0Zvcm5pdG9yZSIsInVybCIsImNoZWNrUG9kIiwicGF5bG9hZCIsInN0YXR1cyIsImxvZ0hhc2giLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsIkFjY2VwdCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiUE9EIiwicG9kIiwic291cmNlIiwiY29kaWNlQWdlbnRlIiwiaWRMZWFkIiwicGxpY29Db2RlIiwic2FsZXNQcm9jZXNzRm9yTG9nIiwic3RhdHVzVGV4dCIsImRhdGEiLCJqc29uIiwiZXNpdG8iLCJzdGF0byIsImluZGV4T2YiLCJrdyIsInVsdGltYVBvdERpc3AiLCJhdG9tV2l0aENoZWNrUG9kIiwiZ2V0IiwiY29udHJhY3QiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiY2hlY2tQb2QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBTZXJ2aWNlQmFkSW5wdXRFcnJvcixcclxuICBTZXJ2aWNlRXh0ZXJuYWxCYWRPdXRwdXRFcnJvcixcclxuICBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvcixcclxufSBmcm9tICdAbmFqLXdvL3V0aWwnO1xyXG5pbXBvcnQgeyBjdXJyZW50Q29udHJhY3RJbmZvQXRvbSB9IGZyb20gJy4uLy4uL2F0b21zL2N1cnJlbnQtY29udHJhY3QtaW5mby1hdG9tcyc7XHJcbmltcG9ydCB7IEFQSSwgZ2VuZXJhdGVPcGVyYXRpb25JRCB9IGZyb20gJy4uLy4uL3V0aWxzJztcclxuaW1wb3J0IHsgYXJlQ2hlY2tCeXBhc3NlZCB9IGZyb20gJy4uLy4uL3V0aWxzL2ZsYWdzJztcclxuaW1wb3J0IHsgYXRvbVdpdGhFcnJvclJlc2V0IH0gZnJvbSAnLi4vLi4vdXRpbHMvYXRvbVdpdGhSZXRyeWFibGVRdWVyeSc7XHJcblxyXG50eXBlIFdTT3V0cHV0ID0ge1xyXG4gIHN0YXRvOiBTdGF0b1BvZDtcclxuICBlc2l0bzogJ09LJyB8ICdLT19SRVNQT05TRV9OVUxMJyB8ICdLT19CQURfUkVRVUVTVCcgfCAnS09fSU5QVVRfTk9OX1ZBTElETyc7XHJcbiAgdWx0aW1hUG90RGlzcDogc3RyaW5nO1xyXG59O1xyXG5cclxudHlwZSBSZXNwb25zZSA9IHtcclxuICBDb21tb25SZXNwb25zZToge1xyXG4gICAgLyoqIEBleGFtcGxlIFwiU1VDQ0VTU1wiICovXHJcbiAgICBSZXNwb25zZVR5cGU6IHN0cmluZztcclxuICAgIC8qKiBAZXhhbXBsZSBcIlBSVC1HVFctMDAwMDAwXCIgKi9cclxuICAgIFJlc3BvbnNlQ29kZTogc3RyaW5nO1xyXG4gICAgLyoqIEBleGFtcGxlIFwiU1VDQ0VTU1wiICovXHJcbiAgICBSZXNwb25zZURlc2M6IHN0cmluZztcclxuICAgIC8qKiBAZXhhbXBsZSBudWxsICovXHJcbiAgICBLVkVsZW1lbnQ6IGFueTtcclxuICB9O1xyXG4gIGludGVycm9nYVBPRFJlc3BvbnNlOiB7XHJcbiAgICBFc2l0b1JpY2hpZXN0YToge1xyXG4gICAgICBJZGVudGlmaWNhdGl2aVJpY2hpZXN0YToge1xyXG4gICAgICAgIC8qKiBAZXhhbXBsZSBudWxsICovXHJcbiAgICAgICAgQ09EX1BSQVRfRElTVFI6IGFueTtcclxuICAgICAgICAvKiogQGV4YW1wbGUgXCJEUDE2MTZcIiAqL1xyXG4gICAgICAgIENPRF9DT05UUl9ESVNQOiBzdHJpbmc7XHJcbiAgICAgICAgLyoqIEBleGFtcGxlIG51bGwgKi9cclxuICAgICAgICBDT0RfUFJBVF9VVEVOVEU6IGFueTtcclxuICAgICAgICAvKiogQGV4YW1wbGUgXCIxMjMwMDAyMDE1OFwiICovXHJcbiAgICAgICAgUElWQV9VVEVOVEU6IHN0cmluZztcclxuICAgICAgICAvKiogQGV4YW1wbGUgXCIwNTc3OTcxMTAwMFwiICovXHJcbiAgICAgICAgUElWQV9ESVNUUjogc3RyaW5nO1xyXG4gICAgICB9O1xyXG4gICAgICBBbW1pc3NpYmlsaXRhOiB7XHJcbiAgICAgICAgLyoqIEBleGFtcGxlIFwiMFwiICovXHJcbiAgICAgICAgVkVSSUZJQ0FfQU1NOiBzdHJpbmc7XHJcbiAgICAgICAgLyoqIEBleGFtcGxlIFwiMDAxXCIgKi9cclxuICAgICAgICBDT0RfQ0FVU0FMRTogc3RyaW5nO1xyXG4gICAgICAgIC8qKiBAZXhhbXBsZSBcIlBPRCBOT04gVFJPVkFUT1wiICovXHJcbiAgICAgICAgTU9USVZBWklPTkU6IHN0cmluZztcclxuICAgICAgfTtcclxuICAgICAgLyoqIEBleGFtcGxlIG51bGwgKi9cclxuICAgICAgRGF0aVRlY25pY2k6IGFueTtcclxuICAgICAgLyoqIEBleGFtcGxlIG51bGwgKi9cclxuICAgICAgRm9ybml0dXJhOiBhbnk7XHJcbiAgICAgIC8qKiBAZXhhbXBsZSBudWxsICovXHJcbiAgICAgIEVTSVRPOiBhbnk7XHJcbiAgICAgIC8qKiBAZXhhbXBsZSBudWxsICovXHJcbiAgICAgIERFVFRBR0xJT19FU0lUTzogYW55O1xyXG4gICAgfTtcclxuICAgIC8qKiBAZXhhbXBsZSBudWxsICovXHJcbiAgICBFcnJvcmU6IGFueTtcclxuICB9O1xyXG4gIFN0YXRvOiBTdGF0b1BvZDtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIENoZWNrUG9kVmFsdWUgPSB7XHJcbiAgc3RhdHVzOiBTdGF0b1BvZDtcclxuICAvKiogUG93ZXIgaW4ga1csIGlmIGF2YWlsYWJsZS4gKi9cclxuICBrdz86IHN0cmluZztcclxuICAvKiogbG9naGFzaCBzdWJtaXR0ZWQgd2l0aCB0aGUgcmVxdWVzdCAqL1xyXG4gIGxvZ0hhc2g6IHN0cmluZztcclxuICAvLyBwb2Q/OiBzdHJpbmc7XHJcbn07XHJcblxyXG5leHBvcnQgZW51bSBTdGF0b1BvZCB7XHJcbiAgLyoqXHJcbiAgICogX19TaWduaWZpY2F0byBmdW56aW9uYWxlX186IFBPRCBkaXNhbGltZW50YXRvLCBtYSBpbiBwcmVjZWRlbnphIGVuZXJnaXp6YXRvLlxyXG4gICAqXHJcbiAgICogX19TaWduaWZpY2F0b19fOiBEaXNhbGltZW50YXRvIC0gw6ggcG9zc2liaWxlIGluc2VyaXJlIHVuIHN1YmVudHJvIFMwMS5cclxuICAgKlxyXG4gICAqIF9fQXppb25lIHdlYl9fOiBPSyAtIHByb3NlZ3VpcmUgY29uIGNvbnRyb2xsbyBzdWNjZXNzaXZvLlxyXG4gICAqL1xyXG4gIERpc2FsaW1lbnRhdG8gPSAnRElTQUxJTUVOVEFUTycsXHJcbiAgLyoqXHJcbiAgICogX19TaWduaWZpY2F0byBmdW56aW9uYWxlX186IFBPRCBtYWkgZW5lcmdpenphdG8uXHJcbiAgICpcclxuICAgKiBfX1NpZ25pZmljYXRvX186IExpYmVybyAtIMOoIHBvc3NpYmlsZSBpbnNlcmlyZSB1biBBMDEgYXR0aXZhemlvbmUgY29uIGlzdGFuemEuXHJcbiAgICpcclxuICAgKiBfX0F6aW9uZSB3ZWJfXzogT0sgLSBNb2RpZmljYXJlIGlsIHNhbGVzIHByb2Nlc3MgaW4gQXR0aXZhemlvbmUgY29uIGlzdGFuemEuXHJcbiAgICovXHJcbiAgTGliZXJvID0gJ0xJQkVSTycsXHJcbiAgLyoqXHJcbiAgICogX19TaWduaWZpY2F0byBmdW56aW9uYWxlX186XHJcbiAgICogLSBQT0QgcHJlZGlzcG9zdG8gc3UgaW5pemlhdGl2YSBkZWwgZGlzdHJpYnV0b3JlXHJcbiAgICogZG9wbyBhdmVyIHJpc2NvbnRyYXRvIHVuIGFsbGFjY2lvIGRpcmV0dG8gYWxsYSByZXRlIChhbGxhY2NpbyBhYnVzaXZvKVxyXG4gICAqIC0gb3BwdXJlIFBPRCBjb24gaW1waWFudG8gZGkgcHJvZHV6aW9uZSBhdHRpdm8gYWwgbW9tZW50byBkZWxsYSBkaXNhdHRpdmF6aW9uZS5cclxuICAgKlxyXG4gICAqIF9fU2lnbmlmaWNhdG9fXzogUHVudG8gbm9uIGRpc3BvbmliaWxlIHBlciBs4oCZYXR0aXZhemlvbmUuXHJcbiAgICpcclxuICAgKiBfX0F6aW9uZSB3ZWJfXzogS08gcGVyIHB1bnRvIG5vbiBhdHRpdmFiaWxlIC0gY29udGF0dGFyZSBkaXN0cmlidXRvcmUuXHJcbiAgICovXHJcbiAgTm9uQXR0aXZhYmlsZSA9ICdOT04gQVRUSVZBQklMRScsXHJcbiAgLyoqXHJcbiAgICogX19TaWduaWZpY2F0byBmdW56aW9uYWxlX186IElsIFBPRCBmb3JuaXRvIGRhbCBjbGllbnRlIG5vbiBlc2lzdGUuXHJcbiAgICpcclxuICAgKiBfX1NpZ25pZmljYXRvX186IFB1bnRvIGluZXNpc3RlbnRlIC0gcHVudG8gbm9uIHRyb3ZhdG8gaW4gaW50ZWdyYXppb25lLlxyXG4gICAqXHJcbiAgICogX19BemlvbmUgd2ViX186IEFsZXJ0IGNoZSBub24gc2kgdHJvdmEgaWwgcHVudG8gZSBzZSBzaSB2dW9sZSBjb211bnF1ZVxyXG4gICAqIGNvbnRpbnVhcmUgKMOoIHNvbG8gdW4gYWxlcnQsIHNpIHB1w7IgY29tdW5xdWUgcHJvY2VkZXJlIGFsbCdpbnNlcmltZW50bykuXHJcbiAgICovXHJcbiAgSW5lc2lzdGVudGUgPSAnSU5FU0lTVEVOVEUnLFxyXG4gIC8qKlxyXG4gICAqIF9fU2lnbmlmaWNhdG8gZnVuemlvbmFsZV9fOiBTdWwgUE9EIHJpc3VsdGEgZ2nDoCBhdHRpdmEgdW5hIGZvcm5pdHVyYS5cclxuICAgKlxyXG4gICAqIF9fU2lnbmlmaWNhdG9fXzogUHVudG8gQXR0aXZvLlxyXG4gICAqXHJcbiAgICogX19BemlvbmUgd2ViX186IEtPIHBlciBwdW50byBub24gYXR0aXZhYmlsZSBwZXJjaMOpIGdpw6AgYXR0aXZvLlxyXG4gICAqL1xyXG4gIEF0dGl2byA9ICdBVFRJVk8nLFxyXG4gIC8qKlxyXG4gICAqIF9fU2lnbmlmaWNhdG8gZnVuemlvbmFsZV9fOiBlcnJvcmUgbmVsbGEgcmljaGllc3RhLlxyXG4gICAqXHJcbiAgICogX19TaWduaWZpY2F0b19fOiBFcnJvcmUgbmVsIHNlcnZpemlvIC0gc2kgcHXDsiBwcm9jZWRlcmUgY29uIHVuIG1lc3NhZ2dpb1xyXG4gICAqIGRpIGF0dGVuemlvbmUuXHJcbiAgICpcclxuICAgKiBfX0F6aW9uZSB3ZWJfXzogQWxlcnQgY2hlIG5vbiBzaSB0cm92YSBpbCBwdW50byBlIHNlIHNpIHZ1b2xlIGNvbXVucXVlXHJcbiAgICogY29udGludWFyZSAow6ggc29sbyB1biBhbGVydCwgc2kgcHXDsiBjb211bnF1ZSBwcm9jZWRlcmUgYWxsJ2luc2VyaW1lbnRvKS5cclxuICAgKi9cclxuICBFcnJvcmUgPSAnRVJST1JFJyxcclxuICBBbHRyb19Gb3JuaXRvcmUgPSAnQVRUSVZPX0FMVFJPX0ZPUk5JVE9SRScsXHJcbn1cclxuXHJcbmNvbnN0IHVybCA9IGAke0FQSX0vd2ViT3JkZXJDb21tb25TZXJ2aWNlcy9jaGVja1BvZGA7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBjaGVja1BvZChwYXlsb2FkOiB7XHJcbiAgcG9kOiBzdHJpbmc7XHJcbiAgaWRMZWFkOiBzdHJpbmc7XHJcbiAgcGxpY29Db2RlOiBzdHJpbmc7XHJcbiAgc2FsZXNQcm9jZXNzRm9yTG9nOiBzdHJpbmc7XHJcbn0pIHtcclxuICBpZiAoYXJlQ2hlY2tCeXBhc3NlZCgpKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdGF0dXM6IFN0YXRvUG9kLkluZXNpc3RlbnRlLFxyXG4gICAgfSBhcyBDaGVja1BvZFZhbHVlO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgbG9nSGFzaCA9IGdlbmVyYXRlT3BlcmF0aW9uSUQoKTtcclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIFBPRDogcGF5bG9hZC5wb2QsXHJcbiAgICAgIHNvdXJjZTogJ1NBTEVTVVAnLFxyXG4gICAgICBjb2RpY2VBZ2VudGU6ICdGQUtFMDAxMDAyJyxcclxuICAgICAgbG9nSGFzaDogbG9nSGFzaCxcclxuICAgICAgaWRMZWFkOiBwYXlsb2FkLmlkTGVhZCxcclxuICAgICAgcGxpY29Db2RlOiBwYXlsb2FkLnBsaWNvQ29kZSxcclxuICAgICAgc2FsZXNQcm9jZXNzRm9yTG9nOiBwYXlsb2FkLnNhbGVzUHJvY2Vzc0ZvckxvZyxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgIHRocm93IG5ldyBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0LCBsb2dIYXNoKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRhdGEgPSAoYXdhaXQgcmVzcG9uc2UuanNvbigpKSBhcyBXU091dHB1dDtcclxuXHJcbiAgc3dpdGNoIChkYXRhLmVzaXRvKSB7XHJcbiAgICBjYXNlICdLT19SRVNQT05TRV9OVUxMJzpcclxuICAgICAgdGhyb3cgbmV3IFNlcnZpY2VFeHRlcm5hbEJhZE91dHB1dEVycm9yKGRhdGEuZXNpdG8sIGxvZ0hhc2gsIGRhdGEpO1xyXG4gICAgY2FzZSAnS09fQkFEX1JFUVVFU1QnOlxyXG4gICAgY2FzZSAnS09fSU5QVVRfTk9OX1ZBTElETyc6XHJcbiAgICAgIHRocm93IG5ldyBTZXJ2aWNlQmFkSW5wdXRFcnJvcihkYXRhLmVzaXRvLCBsb2dIYXNoLCBkYXRhKTtcclxuICAgIGNhc2UgJ09LJzpcclxuICAgICAgYnJlYWs7XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICB0aHJvdyBuZXcgU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IoZGF0YS5lc2l0bywgbG9nSGFzaCwgZGF0YSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBzdGF0byA9IGRhdGEuc3RhdG87XHJcblxyXG4gIGlmIChcclxuICAgIFtcclxuICAgICAgJ0RJU0FMSU1FTlRBVE8nLFxyXG4gICAgICAnTElCRVJPJyxcclxuICAgICAgJ05PTiBBVFRJVkFCSUxFJyxcclxuICAgICAgJ0lORVNJU1RFTlRFJyxcclxuICAgICAgJ0FUVElWTycsXHJcbiAgICAgICdBVFRJVk9fQUxUUk9fRk9STklUT1JFJyxcclxuICAgICAgJ0VSUk9SRScsXHJcbiAgICBdLmluZGV4T2Yoc3RhdG8pID09PSAtMVxyXG4gICkge1xyXG4gICAgdGhyb3cgbmV3IFNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yKGRhdGEuZXNpdG8sIGxvZ0hhc2gsIGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGt3OiBkYXRhLnVsdGltYVBvdERpc3AsXHJcbiAgICBzdGF0dXM6IHN0YXRvLFxyXG4gICAgbG9nSGFzaCxcclxuICB9IGFzIENoZWNrUG9kVmFsdWU7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBhdG9tV2l0aENoZWNrUG9kID0gKHBvZDogc3RyaW5nKSA9PiB7XHJcbiAgcmV0dXJuIGF0b21XaXRoRXJyb3JSZXNldChhc3luYyAoZ2V0KSA9PiB7XHJcbiAgICBjb25zdCBjb250cmFjdCA9IGdldChjdXJyZW50Q29udHJhY3RJbmZvQXRvbSk7XHJcbiAgICBjb25zdCBpZExlYWQgPSBjb250cmFjdC5pZExlYWQ7XHJcbiAgICBjb25zdCBwbGljb0NvZGUgPSBhd2FpdCBjb250cmFjdC5wbGljb0NvZGU7XHJcbiAgICBjb25zdCBzYWxlc1Byb2Nlc3NGb3JMb2cgPSBhd2FpdCBjb250cmFjdC5zYWxlc1Byb2Nlc3NGb3JMb2c7XHJcblxyXG4gICAgcmV0dXJuIGNoZWNrUG9kKHtcclxuICAgICAgaWRMZWFkLFxyXG4gICAgICBwbGljb0NvZGUsXHJcbiAgICAgIHNhbGVzUHJvY2Vzc0ZvckxvZyxcclxuICAgICAgcG9kLFxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn07XHJcbiJdLCJmaWxlIjoiQzovVXNlcnMvYWludHJvbmEvRGVza3RvcC9BcHAvcmVhY3QvbmFqL2xpYnMvZGF0YS1hY2Nlc3Mvc3JjL2xpYi9hcGkvd2Vib3JkZXIvY2hlY2tQb2QudHMifQ==