globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { Segment } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/enums.ts";
import { API, generateOperationID } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/index.ts";
import { ENABLE_NEW_PRODUCTS } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/flags.ts";
import { MOCKS_OFFERS } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/products-collection/offerte.ts";
export async function fetchProduct(offer) {
  const mock = MOCKS_OFFERS[offer.code];
  if (mock) {
    if (mock.suboffer) {
      const aemResid2 = await fetchFromAem(mock.suboffer, Segment.RESID);
      if (!aemResid2) {
        throw Error("OFFERTA NON TROVATA");
      }
      return {
        ...aemResid2,
        ...mock
      };
    }
    return mock;
  }
  const [product, aemResid, aemSmall] = await Promise.all([ENABLE_NEW_PRODUCTS && fetchProductV2(offer), !ENABLE_NEW_PRODUCTS && fetchFromAem(offer, Segment.RESID), !ENABLE_NEW_PRODUCTS && fetchFromAem(offer, Segment.SMALL)]);
  if (!product && !aemResid && !aemSmall) {
    throw Error("OFFERTA NON TROVATA");
  }
  return {
    ...aemResid || {},
    ...aemSmall || {},
    ...product || {}
  };
}
async function fetchProductV2(offer) {
  const logHash = generateOperationID();
  const response = await fetch(`${API}/productsServices/v1/code/${offer.code}/channel/${offer.channel}/touchpoint/${offer.touchpoint}`, {
    method: "GET",
    headers: {
      Accept: "application/json",
      logHash
    }
  });
  if (response.status !== 200) {
    return null;
  }
  const json = await response.json();
  if (json.statusCodeValue !== 200) {
    return null;
  }
  return json.body;
}
async function fetchFromAem(offer, settore) {
  const {
    code,
    channel,
    touchpoint
  } = offer;
  if (!code || !channel || !touchpoint) {
    console.warn("Unexpected call of offerInfoAtom. Offer is not set.");
    return null;
  }
  const query = `code=${code}`;
  const url = `/graphql/execute.json/enigaseluce/${settore === Segment.SMALL ? "OffertaCommodityBusinessList" : "OffertaCommodityResidenzialeList"};${query}?t=${Date.now()}`;
  const response = await fetch(url, {
    method: "GET",
    headers: {
      Accept: "application/json",
      "Content-Type": "application/json"
    }
  });
  if (response.status !== 200) {
    return null;
  }
  const data = await response.json();
  const items = data.data[settore === "SMALL" ? "eniGasELuceDettaglioOffertaCommodityBusinessList" : "eniGasELuceDettaglioOffertaCommodityResidenzialeList"].items;
  if (!items.length) {
    return null;
  }
  const itemsFiltered = items.filter((item) => item.codiceCanale === channel && item.codiceTpCanale === touchpoint);
  if (!itemsFiltered.length) {
    return null;
  }
  const adobeItem = itemsFiltered[0];
  if (!adobeItem) {
    return null;
  }
  return {
    ...getProductFromAdobe(adobeItem, settore),
    contentFragment: adobeItem,
    corrispettiviCommodity: offertaSetFromAdobe(adobeItem, settore)
  };
}
function offertaSetFromAdobe(offer, settore) {
  const luce = offer.contentFragmentLuce;
  const gas = offer.contentFragmentGas;
  return {
    codice: offer.codiceOfferta,
    settore,
    luce: !!luce,
    gas: !!gas,
    verde: {
      luceInclusa: luce.opzione_green_obbligatoria,
      luce: luce.opzione_green,
      gasIncluso: gas.opzione_green_obbligatoria,
      gas: gas.opzione_green
    },
    prezzi: {
      // Credo che si siano sbagliati ma se nessuno si lamenta allora il campo è giusto...
      gas: gas.commercializzazioneGasSmc,
      luce: {
        monoraria: luce.corrispettivoLuceMonorarioPrezzo || luce.corrispettivoVariabileLuceMonorario || // Su SMALL è diverso!
        luce.corrispettivoLuceMonorario,
        bioraria: {
          f1: luce.corrispettivoLuceBiorarioF1 || luce.corrispettivoVariabileLuceF1,
          f23: luce.corrispettivoLuceBiorarioF23 || luce.corrispettivoVariabileLuceF23
        },
        trioraria: {
          f1: luce.corrispettivoLuceMultiorarioF1,
          f2: luce.corrispettivoLuceMultiorarioF2,
          f3: luce.corrispettivoLuceMultiorarioF3
        }
      }
    },
    costiDiCommercializzazione: {
      gas: {
        qty: gas.commercializzazioneGasMese,
        unit: "€/mese"
      },
      luce: {
        qty: luce.commercializzazioneLuceMese,
        unit: "€/mese"
      }
    },
    promo: extractPromo(offer.contentFragmentPromo),
    sconti: {
      ...offer.prezziBarratiModalitOperativeAttive ? {
        prezziBarrati: {
          operativeModes: offer.prezziBarratiModalitOperativeAttive,
          badge: offer.prezziBarratiBadge
        }
      } : {}
    }
  };
}
function extractPromo(f) {
  if (!f) {
    return [];
  }
  const now = Date.now();
  const inizioPromo = new Date(f.dataInizioPromozione).getTime();
  const finePromo = new Date(f.dataFinePromozione).getTime();
  const checkDate = inizioPromo < now && finePromo > now;
  if (!checkDate) {
    console.debug("La promo non è visualizzata perché è passata o scaduta");
    return [];
  }
  const promo = {
    title: f.titoloWeborder,
    text: f.descrizioneWeborder,
    imageUrl: f.immagineWeborder?._path,
    scontoPercentualePromoSummer: f.scontoPercentualePromoSummer,
    operativeModes: f.scontoModalitaOperative,
    commodities: f.tipologiaPromozione.map((s) => {
      switch (s) {
        case "luce":
          return "POWER";
        case "gas":
          return "GAS";
        case "dual":
          return "DUAL";
        default:
          return s;
      }
    })
  };
  return [promo];
}
function getProductFromAdobe(offer, settore) {
  const luce = offer.contentFragmentLuce;
  const gas = offer.contentFragmentGas;
  return {
    type: settore === Segment.SMALL ? "BUSINESS" : "RESIDENTIAL",
    code: offer.codiceOfferta,
    channel: offer.codiceCanale,
    touchpoint: offer.codiceTpCanale,
    name: offer.nomeOfferta?.plaintext,
    coupon: offer.coupon?.split(/\s*\|\s*/),
    bills: offer.web_bolletta_obbligatoria ? ["DIGITAL"] : ["PAPER", "DIGITAL"],
    payments: offer.domiciliazione_obbligatoria ? ["DIRECT"] : ["POSTAL", "DIRECT"],
    // contentFragmentPromo: offer.contentFragmentPromo,
    // costs: {
    //   changeOffer: offer.costocambioprodotto,
    // },
    power: luce ? {
      productId: luce.codice_cpq,
      document: luce.documentoContrattuale,
      operativeModes: offer.modalitaOperativeAttive,
      green: luce.opzione_green
      // greenMandatory: luce.opzione_green_obbligatoria,
      // opzioni: luce.opzione_bioraria
      //   ? ['monoraria', 'bioraria']
      //   : ['monoraria'],
    } : void 0,
    gas: gas ? {
      productId: gas.codice_cpq,
      document: gas.documentoContrattuale,
      operativeModes: offer.modalitaOperativeAttive,
      green: gas.opzione_green
      // greenMandatory: gas.opzione_green_obbligatoria,
    } : void 0
  };
}

//# sourceMappingURL=data:application/json;base64,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QUNEO0FBQUEsTUFDRTBFLFdBQVcxRSxJQUFJMkU7QUFBQUEsTUFDZkMsVUFBVTVFLElBQUk2RTtBQUFBQSxNQUNkdEMsZ0JBQWdCdkYsTUFBTThIO0FBQUFBLE1BQ3RCQyxPQUFPL0UsSUFBSU87QUFBQUE7QUFBQUEsSUFFYixJQUNBeUU7QUFBQUEsRUFDTjtBQUNGIiwibmFtZXMiOlsiU2VnbWVudCIsIkFQSSIsImdlbmVyYXRlT3BlcmF0aW9uSUQiLCJFTkFCTEVfTkVXX1BST0RVQ1RTIiwiTU9DS1NfT0ZGRVJTIiwiZmV0Y2hQcm9kdWN0Iiwib2ZmZXIiLCJtb2NrIiwiY29kZSIsInN1Ym9mZmVyIiwiYWVtUmVzaWQiLCJmZXRjaEZyb21BZW0iLCJSRVNJRCIsIkVycm9yIiwicHJvZHVjdCIsImFlbVNtYWxsIiwiUHJvbWlzZSIsImFsbCIsImZldGNoUHJvZHVjdFYyIiwiU01BTEwiLCJsb2dIYXNoIiwicmVzcG9uc2UiLCJmZXRjaCIsImNoYW5uZWwiLCJ0b3VjaHBvaW50IiwibWV0aG9kIiwiaGVhZGVycyIsIkFjY2VwdCIsInN0YXR1cyIsImpzb24iLCJzdGF0dXNDb2RlVmFsdWUiLCJib2R5Iiwic2V0dG9yZSIsImNvbnNvbGUiLCJ3YXJuIiwicXVlcnkiLCJ1cmwiLCJEYXRlIiwibm93IiwiZGF0YSIsIml0ZW1zIiwibGVuZ3RoIiwiaXRlbXNGaWx0ZXJlZCIsImZpbHRlciIsIml0ZW0iLCJjb2RpY2VDYW5hbGUiLCJjb2RpY2VUcENhbmFsZSIsImFkb2JlSXRlbSIsImdldFByb2R1Y3RGcm9tQWRvYmUiLCJjb250ZW50RnJhZ21lbnQiLCJjb3JyaXNwZXR0aXZpQ29tbW9kaXR5Iiwib2ZmZXJ0YVNldEZyb21BZG9iZSIsImx1Y2UiLCJjb250ZW50RnJhZ21lbnRMdWNlIiwiZ2FzIiwiY29udGVudEZyYWdtZW50R2FzIiwiY29kaWNlIiwiY29kaWNlT2ZmZXJ0YSIsInZlcmRlIiwibHVjZUluY2x1c2EiLCJvcHppb25lX2dyZWVuX29iYmxpZ2F0b3JpYSIsIm9wemlvbmVfZ3JlZW4iLCJnYXNJbmNsdXNvIiwicHJlenppIiwiY29tbWVyY2lhbGl6emF6aW9uZUdhc1NtYyIsIm1vbm9yYXJpYSIsImNvcnJpc3BldHRpdm9MdWNlTW9ub3JhcmlvUHJlenpvIiwiY29ycmlzcGV0dGl2b1ZhcmlhYmlsZUx1Y2VNb25vcmFyaW8iLCJjb3JyaXNwZXR0aXZvTHVjZU1vbm9yYXJpbyIsImJpb3JhcmlhIiwiZjEiLCJjb3JyaXNwZXR0aXZvTHVjZUJpb3JhcmlvRjEiLCJjb3JyaXNwZXR0aXZvVmFyaWFiaWxlTHVjZUYxIiwiZjIzIiwiY29ycmlzcGV0dGl2b0x1Y2VCaW9yYXJpb0YyMyIsImNvcnJpc3BldHRpdm9WYXJpYWJpbGVMdWNlRjIzIiwidHJpb3JhcmlhIiwiY29ycmlzcGV0dGl2b0x1Y2VNdWx0aW9yYXJpb0YxIiwiZjIiLCJjb3JyaXNwZXR0aXZvTHVjZU11bHRpb3JhcmlvRjIiLCJmMyIsImNvcnJpc3BldHRpdm9MdWNlTXVsdGlvcmFyaW9GMyIsImNvc3RpRGlDb21tZXJjaWFsaXp6YXppb25lIiwicXR5IiwiY29tbWVyY2lhbGl6emF6aW9uZUdhc01lc2UiLCJ1bml0IiwiY29tbWVyY2lhbGl6emF6aW9uZUx1Y2VNZXNlIiwicHJvbW8iLCJleHRyYWN0UHJvbW8iLCJjb250ZW50RnJhZ21lbnRQcm9tbyIsInNjb250aSIsInByZXp6aUJhcnJhdGlNb2RhbGl0T3BlcmF0aXZlQXR0aXZlIiwicHJlenppQmFycmF0aSIsIm9wZXJhdGl2ZU1vZGVzIiwiYmFkZ2UiLCJwcmV6emlCYXJyYXRpQmFkZ2UiLCJmIiwiaW5pemlvUHJvbW8iLCJkYXRhSW5pemlvUHJvbW96aW9uZSIsImdldFRpbWUiLCJmaW5lUHJvbW8iLCJkYXRhRmluZVByb21vemlvbmUiLCJjaGVja0RhdGUiLCJkZWJ1ZyIsInRpdGxlIiwidGl0b2xvV2Vib3JkZXIiLCJ0ZXh0IiwiZGVzY3JpemlvbmVXZWJvcmRlciIsImltYWdlVXJsIiwiaW1tYWdpbmVXZWJvcmRlciIsIl9wYXRoIiwic2NvbnRvUGVyY2VudHVhbGVQcm9tb1N1bW1lciIsInNjb250b01vZGFsaXRhT3BlcmF0aXZlIiwiY29tbW9kaXRpZXMiLCJ0aXBvbG9naWFQcm9tb3ppb25lIiwibWFwIiwicyIsInR5cGUiLCJuYW1lIiwibm9tZU9mZmVydGEiLCJwbGFpbnRleHQiLCJjb3Vwb24iLCJzcGxpdCIsImJpbGxzIiwid2ViX2JvbGxldHRhX29iYmxpZ2F0b3JpYSIsInBheW1lbnRzIiwiZG9taWNpbGlhemlvbmVfb2JibGlnYXRvcmlhIiwicG93ZXIiLCJwcm9kdWN0SWQiLCJjb2RpY2VfY3BxIiwiZG9jdW1lbnQiLCJkb2N1bWVudG9Db250cmF0dHVhbGUiLCJtb2RhbGl0YU9wZXJhdGl2ZUF0dGl2ZSIsImdyZWVuIiwidW5kZWZpbmVkIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbInByb2R1Y3RzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNlZ21lbnQgfSBmcm9tICcuLi8uLi9hdG9tcy9lbnVtcyc7XHJcbmltcG9ydCB7IENvbW1vZGl0eSB9IGZyb20gJy4uLy4uL2F0b21zL3R5cGVzJztcclxuaW1wb3J0IHsgRW5pQWRvYmVJdGVtIH0gZnJvbSAnLi4vLi4vb2ZmZXJ0YS9hZG9iZS10eXBlcyc7XHJcbmltcG9ydCB7XHJcbiAgdHlwZSBPZmZlcnRhU3RhdGUsXHJcbiAgT2ZmZXJ0YVN0YXRlRm9yQ29ycmlzcGV0dGl2aSxcclxuICBTZXR0b3JlLFxyXG59IGZyb20gJy4uLy4uL29mZmVydGEvdHlwZXMnO1xyXG5pbXBvcnQgeyBBUEksIGdlbmVyYXRlT3BlcmF0aW9uSUQgfSBmcm9tICcuLi8uLi91dGlscyc7XHJcbmltcG9ydCB7IEVOQUJMRV9ORVdfUFJPRFVDVFMgfSBmcm9tICcuLi8uLi91dGlscy9mbGFncyc7XHJcbmltcG9ydCB7IE1PQ0tTX09GRkVSUyB9IGZyb20gJy4vb2ZmZXJ0ZSc7XHJcbmltcG9ydCB0eXBlIHsgUHJvZHVjdCB9IGZyb20gJy4vdHlwZXMnO1xyXG5cclxudHlwZSBHZXRQcm9kdWN0c1Jlc3BvbnNlID0ge1xyXG4gIGhlYWRlcnM6IHtcclxuICAgICdDb250ZW50LVR5cGUnOiBbJ2FwcGxpY2F0aW9uL2pzb24nXTtcclxuICB9O1xyXG4gIGJvZHk6IFByb2R1Y3Q7XHJcbiAgc3RhdHVzQ29kZVZhbHVlOiAyMDA7XHJcbiAgc3RhdHVzQ29kZTogJ09LJztcclxufTtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFByb2R1Y3Qob2ZmZXI6IHtcclxuICBjb2RlOiBzdHJpbmc7XHJcbiAgY2hhbm5lbDogc3RyaW5nO1xyXG4gIHRvdWNocG9pbnQ6IHN0cmluZztcclxufSk6IFByb21pc2U8UHJvZHVjdD4ge1xyXG4gIGNvbnN0IG1vY2sgPSBNT0NLU19PRkZFUlNbb2ZmZXIuY29kZV07XHJcbiAgaWYgKG1vY2spIHtcclxuICAgIGlmIChtb2NrLnN1Ym9mZmVyKSB7XHJcbiAgICAgIGNvbnN0IGFlbVJlc2lkID0gYXdhaXQgZmV0Y2hGcm9tQWVtKG1vY2suc3Vib2ZmZXIsIFNlZ21lbnQuUkVTSUQpO1xyXG4gICAgICBpZiAoIWFlbVJlc2lkKSB7XHJcbiAgICAgICAgdGhyb3cgRXJyb3IoJ09GRkVSVEEgTk9OIFRST1ZBVEEnKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLmFlbVJlc2lkLFxyXG4gICAgICAgIC4uLm1vY2ssXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbW9jayBhcyBQcm9kdWN0O1xyXG4gIH1cclxuXHJcbiAgY29uc3QgW3Byb2R1Y3QsIGFlbVJlc2lkLCBhZW1TbWFsbF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICBFTkFCTEVfTkVXX1BST0RVQ1RTICYmIGZldGNoUHJvZHVjdFYyKG9mZmVyKSxcclxuICAgICFFTkFCTEVfTkVXX1BST0RVQ1RTICYmIGZldGNoRnJvbUFlbShvZmZlciwgU2VnbWVudC5SRVNJRCksXHJcbiAgICAhRU5BQkxFX05FV19QUk9EVUNUUyAmJiBmZXRjaEZyb21BZW0ob2ZmZXIsIFNlZ21lbnQuU01BTEwpLFxyXG4gIF0pO1xyXG5cclxuICAvLyBUT0RPIGN1c3RvbSBtZXNzYWdlXHJcbiAgaWYgKCFwcm9kdWN0ICYmICFhZW1SZXNpZCAmJiAhYWVtU21hbGwpIHtcclxuICAgIHRocm93IEVycm9yKCdPRkZFUlRBIE5PTiBUUk9WQVRBJyk7XHJcbiAgfVxyXG5cclxuICAvLyBAdHMtZXhwZWN0LWVycm9yIGNpw7Igc3Bhcmlyw6AgcXVhbmRvIGF2cmVtbyBzb2xvIGlsIG51b3ZvIGZyYWdtZW50XHJcbiAgcmV0dXJuIHtcclxuICAgIC4uLihhZW1SZXNpZCB8fCB7fSksXHJcbiAgICAuLi4oYWVtU21hbGwgfHwge30pLFxyXG4gICAgLi4uKHByb2R1Y3QgfHwge30pLFxyXG4gIH07XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGZldGNoUHJvZHVjdFYyKG9mZmVyOiB7XHJcbiAgY29kZTogc3RyaW5nO1xyXG4gIGNoYW5uZWw6IHN0cmluZztcclxuICB0b3VjaHBvaW50OiBzdHJpbmc7XHJcbn0pIHtcclxuICBjb25zdCBsb2dIYXNoID0gZ2VuZXJhdGVPcGVyYXRpb25JRCgpO1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXHJcbiAgICBgJHtBUEl9L3Byb2R1Y3RzU2VydmljZXMvdjEvY29kZS8ke29mZmVyLmNvZGV9L2NoYW5uZWwvJHtvZmZlci5jaGFubmVsfS90b3VjaHBvaW50LyR7b2ZmZXIudG91Y2hwb2ludH1gLFxyXG4gICAge1xyXG4gICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgbG9nSGFzaDogbG9nSGFzaCxcclxuICAgICAgfSxcclxuICAgIH1cclxuICApO1xyXG5cclxuICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gICAgLy8gdGhyb3cgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBqc29uID0gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSkgYXMgR2V0UHJvZHVjdHNSZXNwb25zZTtcclxuICBpZiAoanNvbi5zdGF0dXNDb2RlVmFsdWUgIT09IDIwMCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgICAvLyB0aHJvdyBFcnJvcihqc29uLnN0YXR1c0NvZGUpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGpzb24uYm9keTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hGcm9tQWVtKFxyXG4gIG9mZmVyOiB7XHJcbiAgICBjb2RlOiBzdHJpbmc7XHJcbiAgICBjaGFubmVsOiBzdHJpbmc7XHJcbiAgICB0b3VjaHBvaW50OiBzdHJpbmc7XHJcbiAgfSxcclxuICBzZXR0b3JlOiBTZXR0b3JlXHJcbikge1xyXG4gIGNvbnN0IHsgY29kZSwgY2hhbm5lbCwgdG91Y2hwb2ludCB9ID0gb2ZmZXI7XHJcbiAgaWYgKCFjb2RlIHx8ICFjaGFubmVsIHx8ICF0b3VjaHBvaW50KSB7XHJcbiAgICBjb25zb2xlLndhcm4oJ1VuZXhwZWN0ZWQgY2FsbCBvZiBvZmZlckluZm9BdG9tLiBPZmZlciBpcyBub3Qgc2V0LicpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBjb25zdCBxdWVyeSA9IGBjb2RlPSR7Y29kZX1gO1xyXG5cclxuICBjb25zdCB1cmwgPSBgL2dyYXBocWwvZXhlY3V0ZS5qc29uL2VuaWdhc2VsdWNlLyR7XHJcbiAgICBzZXR0b3JlID09PSBTZWdtZW50LlNNQUxMXHJcbiAgICAgID8gJ09mZmVydGFDb21tb2RpdHlCdXNpbmVzc0xpc3QnXHJcbiAgICAgIDogJ09mZmVydGFDb21tb2RpdHlSZXNpZGVuemlhbGVMaXN0J1xyXG4gIH07JHtxdWVyeX0/dD0ke0RhdGUubm93KCl9YDtcclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XHJcbiAgICAvLyB0aHJvdyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICBjb25zdCBpdGVtcyA9XHJcbiAgICBkYXRhLmRhdGFbXHJcbiAgICAgIHNldHRvcmUgPT09ICdTTUFMTCdcclxuICAgICAgICA/ICdlbmlHYXNFTHVjZURldHRhZ2xpb09mZmVydGFDb21tb2RpdHlCdXNpbmVzc0xpc3QnXHJcbiAgICAgICAgOiAnZW5pR2FzRUx1Y2VEZXR0YWdsaW9PZmZlcnRhQ29tbW9kaXR5UmVzaWRlbnppYWxlTGlzdCdcclxuICAgIF0uaXRlbXM7XHJcblxyXG4gIGlmICghaXRlbXMubGVuZ3RoKSB7XHJcbiAgICAvLyB0aHJvdyBFcnJvcignT0ZGRVJUQV9OT05fVFJPVkFUQScpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyBQb3Nzb25vIGVzc2VyY2kgMiBvZmZlcnRlIGNvbiBjb2RpY2VDYW5hbGUgZSBjb2RpY2VUcENhbmFsZSB1Z3VhbGkgbWEgbW9kYWxpdGFPcGVyYXRpdmUgZGl2ZXJzZVxyXG4gIGNvbnN0IGl0ZW1zRmlsdGVyZWQgPSBpdGVtcy5maWx0ZXIoXHJcbiAgICAoaXRlbTogYW55KSA9PlxyXG4gICAgICBpdGVtLmNvZGljZUNhbmFsZSA9PT0gY2hhbm5lbCAmJiBpdGVtLmNvZGljZVRwQ2FuYWxlID09PSB0b3VjaHBvaW50XHJcbiAgKTtcclxuXHJcbiAgaWYgKCFpdGVtc0ZpbHRlcmVkLmxlbmd0aCkge1xyXG4gICAgLy8gdGhyb3cgRXJyb3IoJ0NBTkFMRV9OT05fVFJPVkFUTycpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBjb25zdCBhZG9iZUl0ZW06IEVuaUFkb2JlSXRlbSB8IHVuZGVmaW5lZCA9IGl0ZW1zRmlsdGVyZWRbMF07XHJcbiAgaWYgKCFhZG9iZUl0ZW0pIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIC4uLmdldFByb2R1Y3RGcm9tQWRvYmUoYWRvYmVJdGVtLCBzZXR0b3JlKSxcclxuICAgIGNvbnRlbnRGcmFnbWVudDogYWRvYmVJdGVtLFxyXG4gICAgY29ycmlzcGV0dGl2aUNvbW1vZGl0eTogb2ZmZXJ0YVNldEZyb21BZG9iZShhZG9iZUl0ZW0sIHNldHRvcmUpLFxyXG4gIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9mZmVydGFTZXRGcm9tQWRvYmUob2ZmZXI6IEVuaUFkb2JlSXRlbSwgc2V0dG9yZTogU2V0dG9yZSkge1xyXG4gIGNvbnN0IGx1Y2UgPSBvZmZlci5jb250ZW50RnJhZ21lbnRMdWNlO1xyXG4gIGNvbnN0IGdhcyA9IG9mZmVyLmNvbnRlbnRGcmFnbWVudEdhcztcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGNvZGljZTogb2ZmZXIuY29kaWNlT2ZmZXJ0YSxcclxuICAgIHNldHRvcmU6IHNldHRvcmUsXHJcblxyXG4gICAgbHVjZTogISFsdWNlLFxyXG4gICAgZ2FzOiAhIWdhcyxcclxuXHJcbiAgICB2ZXJkZToge1xyXG4gICAgICBsdWNlSW5jbHVzYTogbHVjZS5vcHppb25lX2dyZWVuX29iYmxpZ2F0b3JpYSxcclxuICAgICAgbHVjZTogbHVjZS5vcHppb25lX2dyZWVuLFxyXG4gICAgICBnYXNJbmNsdXNvOiBnYXMub3B6aW9uZV9ncmVlbl9vYmJsaWdhdG9yaWEsXHJcbiAgICAgIGdhczogZ2FzLm9wemlvbmVfZ3JlZW4sXHJcbiAgICB9LFxyXG5cclxuICAgIHByZXp6aToge1xyXG4gICAgICAvLyBDcmVkbyBjaGUgc2kgc2lhbm8gc2JhZ2xpYXRpIG1hIHNlIG5lc3N1bm8gc2kgbGFtZW50YSBhbGxvcmEgaWwgY2FtcG8gw6ggZ2l1c3RvLi4uXHJcbiAgICAgIGdhczogZ2FzLmNvbW1lcmNpYWxpenphemlvbmVHYXNTbWMsXHJcbiAgICAgIGx1Y2U6IHtcclxuICAgICAgICBtb25vcmFyaWE6XHJcbiAgICAgICAgICBsdWNlLmNvcnJpc3BldHRpdm9MdWNlTW9ub3JhcmlvUHJlenpvIHx8XHJcbiAgICAgICAgICBsdWNlLmNvcnJpc3BldHRpdm9WYXJpYWJpbGVMdWNlTW9ub3JhcmlvIHx8XHJcbiAgICAgICAgICAvLyBTdSBTTUFMTCDDqCBkaXZlcnNvIVxyXG4gICAgICAgICAgKGx1Y2UgYXMgYW55KS5jb3JyaXNwZXR0aXZvTHVjZU1vbm9yYXJpbyxcclxuICAgICAgICBiaW9yYXJpYToge1xyXG4gICAgICAgICAgZjE6XHJcbiAgICAgICAgICAgIGx1Y2UuY29ycmlzcGV0dGl2b0x1Y2VCaW9yYXJpb0YxIHx8XHJcbiAgICAgICAgICAgIGx1Y2UuY29ycmlzcGV0dGl2b1ZhcmlhYmlsZUx1Y2VGMSxcclxuICAgICAgICAgIGYyMzpcclxuICAgICAgICAgICAgbHVjZS5jb3JyaXNwZXR0aXZvTHVjZUJpb3JhcmlvRjIzIHx8XHJcbiAgICAgICAgICAgIGx1Y2UuY29ycmlzcGV0dGl2b1ZhcmlhYmlsZUx1Y2VGMjMsXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0cmlvcmFyaWE6IHtcclxuICAgICAgICAgIGYxOiAobHVjZSBhcyBhbnkpLmNvcnJpc3BldHRpdm9MdWNlTXVsdGlvcmFyaW9GMSxcclxuICAgICAgICAgIGYyOiAobHVjZSBhcyBhbnkpLmNvcnJpc3BldHRpdm9MdWNlTXVsdGlvcmFyaW9GMixcclxuICAgICAgICAgIGYzOiAobHVjZSBhcyBhbnkpLmNvcnJpc3BldHRpdm9MdWNlTXVsdGlvcmFyaW9GMyxcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIGNvc3RpRGlDb21tZXJjaWFsaXp6YXppb25lOiB7XHJcbiAgICAgIGdhczoge1xyXG4gICAgICAgIHF0eTogZ2FzLmNvbW1lcmNpYWxpenphemlvbmVHYXNNZXNlLFxyXG4gICAgICAgIHVuaXQ6ICfigqwvbWVzZScsXHJcbiAgICAgIH0sXHJcbiAgICAgIGx1Y2U6IHtcclxuICAgICAgICBxdHk6IGx1Y2UuY29tbWVyY2lhbGl6emF6aW9uZUx1Y2VNZXNlLFxyXG4gICAgICAgIHVuaXQ6ICfigqwvbWVzZScsXHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgcHJvbW86IGV4dHJhY3RQcm9tbyhvZmZlci5jb250ZW50RnJhZ21lbnRQcm9tbyksXHJcbiAgICBzY29udGk6IHtcclxuICAgICAgLi4uKG9mZmVyLnByZXp6aUJhcnJhdGlNb2RhbGl0T3BlcmF0aXZlQXR0aXZlXHJcbiAgICAgICAgPyB7XHJcbiAgICAgICAgICAgIHByZXp6aUJhcnJhdGk6IHtcclxuICAgICAgICAgICAgICBvcGVyYXRpdmVNb2Rlczogb2ZmZXIucHJlenppQmFycmF0aU1vZGFsaXRPcGVyYXRpdmVBdHRpdmUsXHJcbiAgICAgICAgICAgICAgYmFkZ2U6IG9mZmVyLnByZXp6aUJhcnJhdGlCYWRnZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIH1cclxuICAgICAgICA6IHt9KSxcclxuICAgIH0sXHJcbiAgfSBhcyBPZmZlcnRhU3RhdGVGb3JDb3JyaXNwZXR0aXZpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0UHJvbW8oZjogRW5pQWRvYmVJdGVtWydjb250ZW50RnJhZ21lbnRQcm9tbyddKSB7XHJcbiAgaWYgKCFmKSB7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgY29uc3QgaW5pemlvUHJvbW8gPSBuZXcgRGF0ZShmLmRhdGFJbml6aW9Qcm9tb3ppb25lKS5nZXRUaW1lKCk7XHJcbiAgY29uc3QgZmluZVByb21vID0gbmV3IERhdGUoZi5kYXRhRmluZVByb21vemlvbmUpLmdldFRpbWUoKTtcclxuICBjb25zdCBjaGVja0RhdGUgPSBpbml6aW9Qcm9tbyA8IG5vdyAmJiBmaW5lUHJvbW8gPiBub3c7XHJcblxyXG4gIGlmICghY2hlY2tEYXRlKSB7XHJcbiAgICBjb25zb2xlLmRlYnVnKCdMYSBwcm9tbyBub24gw6ggdmlzdWFsaXp6YXRhIHBlcmNow6kgw6ggcGFzc2F0YSBvIHNjYWR1dGEnKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHByb21vOiBPZmZlcnRhU3RhdGVbJ3Byb21vJ11bbnVtYmVyXSA9IHtcclxuICAgIHRpdGxlOiBmLnRpdG9sb1dlYm9yZGVyLFxyXG4gICAgdGV4dDogZi5kZXNjcml6aW9uZVdlYm9yZGVyLFxyXG4gICAgaW1hZ2VVcmw6IGYuaW1tYWdpbmVXZWJvcmRlcj8uX3BhdGgsXHJcbiAgICBzY29udG9QZXJjZW50dWFsZVByb21vU3VtbWVyOiBmLnNjb250b1BlcmNlbnR1YWxlUHJvbW9TdW1tZXIsXHJcbiAgICBvcGVyYXRpdmVNb2RlczogZi5zY29udG9Nb2RhbGl0YU9wZXJhdGl2ZSxcclxuICAgIGNvbW1vZGl0aWVzOiBmLnRpcG9sb2dpYVByb21vemlvbmUubWFwKChzKTogQ29tbW9kaXR5ID0+IHtcclxuICAgICAgc3dpdGNoIChzKSB7XHJcbiAgICAgICAgY2FzZSAnbHVjZSc6XHJcbiAgICAgICAgICByZXR1cm4gJ1BPV0VSJztcclxuICAgICAgICBjYXNlICdnYXMnOlxyXG4gICAgICAgICAgcmV0dXJuICdHQVMnO1xyXG4gICAgICAgIGNhc2UgJ2R1YWwnOlxyXG4gICAgICAgICAgcmV0dXJuICdEVUFMJztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgIH1cclxuICAgIH0pLFxyXG4gIH07XHJcblxyXG4gIC8vIFZlcmlmaWNhIGlsIGZsdXNzbyBXT1xyXG4gIC8vIGlmIChmLnNjb250b01vZGFsaXRhT3BlcmF0aXZlKSB7XHJcbiAgLy8gICBjb25zdCBtb2RPcGVyYXRpdmEgPSBmLnNjb250b01vZGFsaXRhT3BlcmF0aXZlXHJcbiAgLy8gICAgIC5zcGxpdCgnfCcpXHJcbiAgLy8gICAgIC5tYXAoKG0pID0+IGdldE1vZE9wZXJhdGl2YShtKSk7XHJcbiAgLy8gICBpZiAoIW1vZE9wZXJhdGl2YS5pbmNsdWRlcyhXTykpIHtcclxuICAvLyAgICAgY29uc29sZS5kZWJ1ZyhcclxuICAvLyAgICAgICAnTGEgcHJvbW8gbm9uIMOoIHZpc3VhbGl6emF0YSBwZXJjaMOpIGxhIG1vZGFsaXTDoCBvcGVyYXRpdmEgbm9uIMOoIHByZXNlbnRlJ1xyXG4gIC8vICAgICApO1xyXG4gIC8vICAgICByZXR1cm47XHJcbiAgLy8gICB9XHJcbiAgLy8gfVxyXG5cclxuICByZXR1cm4gW3Byb21vXTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0UHJvZHVjdEZyb21BZG9iZShvZmZlcjogRW5pQWRvYmVJdGVtLCBzZXR0b3JlOiBTZXR0b3JlKSB7XHJcbiAgY29uc3QgbHVjZSA9IG9mZmVyLmNvbnRlbnRGcmFnbWVudEx1Y2U7XHJcbiAgY29uc3QgZ2FzID0gb2ZmZXIuY29udGVudEZyYWdtZW50R2FzO1xyXG4gIHJldHVybiB7XHJcbiAgICB0eXBlOiBzZXR0b3JlID09PSBTZWdtZW50LlNNQUxMID8gJ0JVU0lORVNTJyA6ICdSRVNJREVOVElBTCcsXHJcbiAgICBjb2RlOiBvZmZlci5jb2RpY2VPZmZlcnRhLFxyXG4gICAgY2hhbm5lbDogb2ZmZXIuY29kaWNlQ2FuYWxlLFxyXG4gICAgdG91Y2hwb2ludDogb2ZmZXIuY29kaWNlVHBDYW5hbGUsXHJcbiAgICBuYW1lOiBvZmZlci5ub21lT2ZmZXJ0YT8ucGxhaW50ZXh0LFxyXG4gICAgY291cG9uOiBvZmZlci5jb3Vwb24/LnNwbGl0KC9cXHMqXFx8XFxzKi8pLFxyXG4gICAgYmlsbHM6IG9mZmVyLndlYl9ib2xsZXR0YV9vYmJsaWdhdG9yaWEgPyBbJ0RJR0lUQUwnXSA6IFsnUEFQRVInLCAnRElHSVRBTCddLFxyXG4gICAgcGF5bWVudHM6IG9mZmVyLmRvbWljaWxpYXppb25lX29iYmxpZ2F0b3JpYVxyXG4gICAgICA/IFsnRElSRUNUJ11cclxuICAgICAgOiBbJ1BPU1RBTCcsICdESVJFQ1QnXSxcclxuICAgIC8vIGNvbnRlbnRGcmFnbWVudFByb21vOiBvZmZlci5jb250ZW50RnJhZ21lbnRQcm9tbyxcclxuICAgIC8vIGNvc3RzOiB7XHJcbiAgICAvLyAgIGNoYW5nZU9mZmVyOiBvZmZlci5jb3N0b2NhbWJpb3Byb2RvdHRvLFxyXG4gICAgLy8gfSxcclxuICAgIHBvd2VyOiBsdWNlXHJcbiAgICAgID8ge1xyXG4gICAgICAgICAgcHJvZHVjdElkOiBsdWNlLmNvZGljZV9jcHEsXHJcbiAgICAgICAgICBkb2N1bWVudDogbHVjZS5kb2N1bWVudG9Db250cmF0dHVhbGUsXHJcbiAgICAgICAgICBvcGVyYXRpdmVNb2Rlczogb2ZmZXIubW9kYWxpdGFPcGVyYXRpdmVBdHRpdmUsXHJcbiAgICAgICAgICBncmVlbjogbHVjZS5vcHppb25lX2dyZWVuLFxyXG4gICAgICAgICAgLy8gZ3JlZW5NYW5kYXRvcnk6IGx1Y2Uub3B6aW9uZV9ncmVlbl9vYmJsaWdhdG9yaWEsXHJcbiAgICAgICAgICAvLyBvcHppb25pOiBsdWNlLm9wemlvbmVfYmlvcmFyaWFcclxuICAgICAgICAgIC8vICAgPyBbJ21vbm9yYXJpYScsICdiaW9yYXJpYSddXHJcbiAgICAgICAgICAvLyAgIDogWydtb25vcmFyaWEnXSxcclxuICAgICAgICB9XHJcbiAgICAgIDogdW5kZWZpbmVkLFxyXG4gICAgZ2FzOiBnYXNcclxuICAgICAgPyB7XHJcbiAgICAgICAgICBwcm9kdWN0SWQ6IGdhcy5jb2RpY2VfY3BxLFxyXG4gICAgICAgICAgZG9jdW1lbnQ6IGdhcy5kb2N1bWVudG9Db250cmF0dHVhbGUsXHJcbiAgICAgICAgICBvcGVyYXRpdmVNb2Rlczogb2ZmZXIubW9kYWxpdGFPcGVyYXRpdmVBdHRpdmUsXHJcbiAgICAgICAgICBncmVlbjogZ2FzLm9wemlvbmVfZ3JlZW4sXHJcbiAgICAgICAgICAvLyBncmVlbk1hbmRhdG9yeTogZ2FzLm9wemlvbmVfZ3JlZW5fb2JibGlnYXRvcmlhLFxyXG4gICAgICAgIH1cclxuICAgICAgOiB1bmRlZmluZWQsXHJcbiAgfSBhcyBQcm9kdWN0O1xyXG59XHJcbiJdLCJmaWxlIjoiQzovVXNlcnMvYWludHJvbmEvRGVza3RvcC9BcHAvcmVhY3QvbmFqL2xpYnMvZGF0YS1hY2Nlc3Mvc3JjL2xpYi9hcGkvcHJvZHVjdHMtY29sbGVjdGlvbi9wcm9kdWN0cy50cyJ9