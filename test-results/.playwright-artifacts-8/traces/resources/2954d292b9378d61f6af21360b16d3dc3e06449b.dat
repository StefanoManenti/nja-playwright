globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { API, generateOperationID } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/index.ts";
import { atomAction, OK, ServiceUnhandledResponseError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { VulnerableDocumentoDatiAnagraficiError, VulnerableDocumentoNonCompletoError, VulnerableDocumentoNonLeggibileError, VulnerableDocumentoNonRiconosciutoError, VulnerableDocumentoScadutoError, VulnerableDocumentoTecnicoError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/errors/index.ts";
import { atomWithMutation } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/node_modules/.vite/apps/naj/deps/jotai-tanstack-query.js?v=0189a8d1";
import { currentContractInfoAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/current-contract-info-atoms.ts";
import { familyNameAtom, givenNameAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/profile-atoms.ts";
import { OperativeMode } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/troubleshooting/types.ts";
import { operativeModeAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/troubleshooting/atoms.ts";
import { VulnerabilityFlag, vulnerabilitySelfCertificationFlags$ } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/vulnerability/vulnerability.ts";
let attempts = 1;
export async function identityOcrUpload(payload) {
  const form = new FormData();
  form.append("contractCode", payload.plicoCode);
  form.append("front", payload.front, getFileName("fronte", payload.front));
  form.append("back", payload.back, getFileName("retro", payload.back));
  if (payload.type) {
    form.append("identityOcrUploadType", payload.type);
  }
  form.append("name", payload.nome);
  form.append("surname", payload.cognome);
  if (payload.salesProcess !== "CAMBIO_PRODOTTO") {
    form.append("salesProcessForLog", payload.salesProcess);
  }
  const logHash = generateOperationID();
  const response = await fetch(`${API}/webOrderCommonServices/file/identityOcrUpload`, {
    method: "POST",
    headers: {
      // 'Content-Type': 'multipart/form-data',
      Accept: "application/json",
      transactionId: logHash
    },
    body: form
  });
  if (response.status !== 200) {
    throw new ServiceUnhandledResponseError(response.statusText, logHash);
  }
  const data = await response.json();
  if (data.outcome === "OK") {
    return OK;
  }
  if (data.code) {
    if (attempts-- <= 0) {
      return OK;
    }
    if (data.type !== "ServiceError") {
      throw new VulnerableDocumentoTecnicoError(data.code, logHash);
    }
    switch (data.code) {
      case "E003" /* DocumentoScaduto */:
        throw new VulnerableDocumentoScadutoError(data.code, logHash);
      case "E004" /* DocumentoNonLeggibile */:
        throw new VulnerableDocumentoNonLeggibileError(data.code, logHash);
      case "E005" /* DocumentoNonRiconosciuto */:
        throw new VulnerableDocumentoNonRiconosciutoError(data.code, logHash);
      case "E006" /* DocumentoNonCompleto */:
        throw new VulnerableDocumentoNonCompletoError(data.code, logHash);
      case "E007" /* DocumentoDatiAnagrafici */:
        throw new VulnerableDocumentoDatiAnagraficiError(data.code, logHash);
      default:
        throw new VulnerableDocumentoTecnicoError(data.code, logHash);
    }
  }
}
const extensionForFileName = {
  "application/pdf": "pdf",
  "image/png": "png",
  "image/jpeg": "jpg"
};
function getFileName(part, file) {
  const b = extensionForFileName[file.type];
  if (!b) {
    throw Error(`Tipo mime ${file.type} non valido o non abilitato.`);
  }
  return `${part}.${b}`;
}
export var IdentityAcquisitionErrorCode = /* @__PURE__ */ ((IdentityAcquisitionErrorCode2) => {
  IdentityAcquisitionErrorCode2["FormatoNonCorretto"] = "E001";
  IdentityAcquisitionErrorCode2["PesoMassimo"] = "E002";
  IdentityAcquisitionErrorCode2["DocumentoScaduto"] = "E003";
  IdentityAcquisitionErrorCode2["DocumentoNonLeggibile"] = "E004";
  IdentityAcquisitionErrorCode2["DocumentoNonRiconosciuto"] = "E005";
  IdentityAcquisitionErrorCode2["DocumentoNonCompleto"] = "E006";
  IdentityAcquisitionErrorCode2["DocumentoDatiAnagrafici"] = "E007";
  return IdentityAcquisitionErrorCode2;
})(IdentityAcquisitionErrorCode || {});
export { VulnerabilityFlag };
export const vulnerabilitySelfCertification$ = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\api\\weborder\\ocr-vulnerabili.ts/vulnerabilitySelfCertification$", atomAction(async (get, set, args) => {
  set(vulnerabilitySelfCertificationFlags$, args.flags);
  const contract = get(currentContractInfoAtom);
  const plicoCode = await contract.plicoCode;
  const operativeMode = await get(operativeModeAtom);
  const nome = await get(givenNameAtom);
  const cognome = await get(familyNameAtom);
  const mutation$ = atomWithMutation(() => {
    return {
      mutationKey: ["identityOcrUpload"],
      mutationFn: ({
        front,
        back
      }) => identityOcrUpload({
        plicoCode,
        front,
        back,
        nome,
        cognome,
        salesProcess: getSalesProcess(operativeMode)
      })
    };
  });
  mutation$.debugLabel = "mutation$";
  mutation$.debugLabel = "mutation$";
  return get(mutation$).mutateAsync(args);
}));
vulnerabilitySelfCertification$.debugLabel = "vulnerabilitySelfCertification$";
function getSalesProcess(operativeMode) {
  switch (operativeMode) {
    case OperativeMode.SWITCH_IN:
      return "SWITCH_IN";
    case OperativeMode.NEW_ACTIVATION:
      return "ATTIVAZIONI";
    case OperativeMode.CHANGE_OFFER:
      return "CAMBIO_PRODOTTO";
  }
}

//# sourceMappingURL=data:application/json;base64,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Q0FBQWEsYUFBQTtBQUVGLFNBQVNELGdCQUFnQkosZUFBMEM7QUFDakUsVUFBUUEsZUFBYTtBQUFBLElBQ25CLEtBQUtyRCxjQUFjNEQ7QUFDakIsYUFBTztBQUFBLElBQ1QsS0FBSzVELGNBQWM2RDtBQUNqQixhQUFPO0FBQUEsSUFDVCxLQUFLN0QsY0FBYzhEO0FBQ2pCLGFBQU87QUFBQSxFQUNYO0FBQ0YiLCJuYW1lcyI6WyJBUEkiLCJnZW5lcmF0ZU9wZXJhdGlvbklEIiwiYXRvbUFjdGlvbiIsIk9LIiwiU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IiLCJWdWxuZXJhYmxlRG9jdW1lbnRvRGF0aUFuYWdyYWZpY2lFcnJvciIsIlZ1bG5lcmFibGVEb2N1bWVudG9Ob25Db21wbGV0b0Vycm9yIiwiVnVsbmVyYWJsZURvY3VtZW50b05vbkxlZ2dpYmlsZUVycm9yIiwiVnVsbmVyYWJsZURvY3VtZW50b05vblJpY29ub3NjaXV0b0Vycm9yIiwiVnVsbmVyYWJsZURvY3VtZW50b1NjYWR1dG9FcnJvciIsIlZ1bG5lcmFibGVEb2N1bWVudG9UZWNuaWNvRXJyb3IiLCJhdG9tV2l0aE11dGF0aW9uIiwiY3VycmVudENvbnRyYWN0SW5mb0F0b20iLCJmYW1pbHlOYW1lQXRvbSIsImdpdmVuTmFtZUF0b20iLCJPcGVyYXRpdmVNb2RlIiwib3BlcmF0aXZlTW9kZUF0b20iLCJWdWxuZXJhYmlsaXR5RmxhZyIsInZ1bG5lcmFiaWxpdHlTZWxmQ2VydGlmaWNhdGlvbkZsYWdzJCIsImF0dGVtcHRzIiwiaWRlbnRpdHlPY3JVcGxvYWQiLCJwYXlsb2FkIiwiZm9ybSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwicGxpY29Db2RlIiwiZnJvbnQiLCJnZXRGaWxlTmFtZSIsImJhY2siLCJ0eXBlIiwibm9tZSIsImNvZ25vbWUiLCJzYWxlc1Byb2Nlc3MiLCJsb2dIYXNoIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBY2NlcHQiLCJ0cmFuc2FjdGlvbklkIiwiYm9keSIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJkYXRhIiwianNvbiIsIm91dGNvbWUiLCJjb2RlIiwiSWRlbnRpdHlBY3F1aXNpdGlvbkVycm9yQ29kZSIsImV4dGVuc2lvbkZvckZpbGVOYW1lIiwicGFydCIsImZpbGUiLCJiIiwiRXJyb3IiLCJGb3JtYXRvTm9uQ29ycmV0dG8iLCJQZXNvTWFzc2ltbyIsIkRvY3VtZW50b1NjYWR1dG8iLCJEb2N1bWVudG9Ob25MZWdnaWJpbGUiLCJEb2N1bWVudG9Ob25SaWNvbm9zY2l1dG8iLCJEb2N1bWVudG9Ob25Db21wbGV0byIsIkRvY3VtZW50b0RhdGlBbmFncmFmaWNpIiwidnVsbmVyYWJpbGl0eVNlbGZDZXJ0aWZpY2F0aW9uJCIsImdsb2JhbFRoaXMiLCJqb3RhaUF0b21DYWNoZSIsImdldCIsInNldCIsImFyZ3MiLCJmbGFncyIsImNvbnRyYWN0Iiwib3BlcmF0aXZlTW9kZSIsIm11dGF0aW9uJCIsIm11dGF0aW9uS2V5IiwibXV0YXRpb25GbiIsImdldFNhbGVzUHJvY2VzcyIsImRlYnVnTGFiZWwiLCJtdXRhdGVBc3luYyIsIlNXSVRDSF9JTiIsIk5FV19BQ1RJVkFUSU9OIiwiQ0hBTkdFX09GRkVSIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbIm9jci12dWxuZXJhYmlsaS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBUEksIGdlbmVyYXRlT3BlcmF0aW9uSUQgfSBmcm9tICcuLi8uLi91dGlscyc7XHJcbmltcG9ydCB7IGF0b21BY3Rpb24sIE9LLCBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvciB9IGZyb20gJ0BuYWotd28vdXRpbCc7XHJcbmltcG9ydCB7XHJcbiAgVnVsbmVyYWJsZURvY3VtZW50b0RhdGlBbmFncmFmaWNpRXJyb3IsXHJcbiAgVnVsbmVyYWJsZURvY3VtZW50b05vbkNvbXBsZXRvRXJyb3IsXHJcbiAgVnVsbmVyYWJsZURvY3VtZW50b05vbkxlZ2dpYmlsZUVycm9yLFxyXG4gIFZ1bG5lcmFibGVEb2N1bWVudG9Ob25SaWNvbm9zY2l1dG9FcnJvcixcclxuICBWdWxuZXJhYmxlRG9jdW1lbnRvU2NhZHV0b0Vycm9yLFxyXG4gIFZ1bG5lcmFibGVEb2N1bWVudG9UZWNuaWNvRXJyb3IsXHJcbn0gZnJvbSAnLi4vLi4vZXJyb3JzJztcclxuaW1wb3J0IHsgYXRvbVdpdGhNdXRhdGlvbiB9IGZyb20gJ2pvdGFpLXRhbnN0YWNrLXF1ZXJ5JztcclxuaW1wb3J0IHsgY3VycmVudENvbnRyYWN0SW5mb0F0b20gfSBmcm9tICcuLi8uLi9hdG9tcy9jdXJyZW50LWNvbnRyYWN0LWluZm8tYXRvbXMnO1xyXG5pbXBvcnQgeyBmYW1pbHlOYW1lQXRvbSwgZ2l2ZW5OYW1lQXRvbSB9IGZyb20gJy4uLy4uL2F0b21zL3Byb2ZpbGUtYXRvbXMnO1xyXG5pbXBvcnQgeyBPcGVyYXRpdmVNb2RlIH0gZnJvbSAnLi4vLi4vdHJvdWJsZXNob290aW5nL3R5cGVzJztcclxuaW1wb3J0IHsgb3BlcmF0aXZlTW9kZUF0b20gfSBmcm9tICcuLi8uLi90cm91Ymxlc2hvb3RpbmcvYXRvbXMnO1xyXG5pbXBvcnQge1xyXG4gIFZ1bG5lcmFiaWxpdHlGbGFnLFxyXG4gIHZ1bG5lcmFiaWxpdHlTZWxmQ2VydGlmaWNhdGlvbkZsYWdzJCxcclxufSBmcm9tICcuLi8uLi9hdG9tcy92dWxuZXJhYmlsaXR5L3Z1bG5lcmFiaWxpdHknO1xyXG5cclxubGV0IGF0dGVtcHRzID0gMTtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpZGVudGl0eU9jclVwbG9hZChwYXlsb2FkOiB7XHJcbiAgcGxpY29Db2RlOiBzdHJpbmc7XHJcbiAgZnJvbnQ6IEJsb2I7XHJcbiAgYmFjazogQmxvYjtcclxuICB0eXBlPzogSWRlbnRpdHlPY3JVcGxvYWRUeXBlO1xyXG4gIG5vbWU6IHN0cmluZztcclxuICBjb2dub21lOiBzdHJpbmc7XHJcbiAgc2FsZXNQcm9jZXNzOiAnQVRUSVZBWklPTkknIHwgJ1NXSVRDSF9JTicgfCAnQ0FNQklPX1BST0RPVFRPJztcclxufSkge1xyXG4gIGNvbnN0IGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcclxuICBmb3JtLmFwcGVuZCgnY29udHJhY3RDb2RlJywgcGF5bG9hZC5wbGljb0NvZGUpO1xyXG4gIGZvcm0uYXBwZW5kKCdmcm9udCcsIHBheWxvYWQuZnJvbnQsIGdldEZpbGVOYW1lKCdmcm9udGUnLCBwYXlsb2FkLmZyb250KSk7XHJcbiAgZm9ybS5hcHBlbmQoJ2JhY2snLCBwYXlsb2FkLmJhY2ssIGdldEZpbGVOYW1lKCdyZXRybycsIHBheWxvYWQuYmFjaykpO1xyXG4gIGlmIChwYXlsb2FkLnR5cGUpIHtcclxuICAgIGZvcm0uYXBwZW5kKCdpZGVudGl0eU9jclVwbG9hZFR5cGUnLCBwYXlsb2FkLnR5cGUpO1xyXG4gIH1cclxuICBmb3JtLmFwcGVuZCgnbmFtZScsIHBheWxvYWQubm9tZSk7XHJcbiAgZm9ybS5hcHBlbmQoJ3N1cm5hbWUnLCBwYXlsb2FkLmNvZ25vbWUpO1xyXG4gIGlmIChwYXlsb2FkLnNhbGVzUHJvY2VzcyAhPT0gJ0NBTUJJT19QUk9ET1RUTycpIHtcclxuICAgIGZvcm0uYXBwZW5kKCdzYWxlc1Byb2Nlc3NGb3JMb2cnLCBwYXlsb2FkLnNhbGVzUHJvY2Vzcyk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBsb2dIYXNoID0gZ2VuZXJhdGVPcGVyYXRpb25JRCgpO1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXHJcbiAgICBgJHtBUEl9L3dlYk9yZGVyQ29tbW9uU2VydmljZXMvZmlsZS9pZGVudGl0eU9jclVwbG9hZGAsXHJcbiAgICB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgLy8gJ0NvbnRlbnQtVHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJyxcclxuICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICB0cmFuc2FjdGlvbklkOiBsb2dIYXNoLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBmb3JtLFxyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xyXG4gICAgdGhyb3cgbmV3IFNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQsIGxvZ0hhc2gpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICBpZiAoZGF0YS5vdXRjb21lID09PSAnT0snKSB7XHJcbiAgICByZXR1cm4gT0s7XHJcbiAgfVxyXG5cclxuICBpZiAoZGF0YS5jb2RlKSB7XHJcbiAgICBpZiAoYXR0ZW1wdHMtLSA8PSAwKSB7XHJcbiAgICAgIC8vIEZpbml0aSBpIHRlbnRhdGl2aSBiaXNvZ25hIGZhciBhbmRhcmUgYXZhbnRpIGNvbXVucXVlLlxyXG4gICAgICByZXR1cm4gT0s7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGRhdGEudHlwZSAhPT0gJ1NlcnZpY2VFcnJvcicpIHtcclxuICAgICAgdGhyb3cgbmV3IFZ1bG5lcmFibGVEb2N1bWVudG9UZWNuaWNvRXJyb3IoZGF0YS5jb2RlLCBsb2dIYXNoKTtcclxuICAgIH1cclxuXHJcbiAgICBzd2l0Y2ggKGRhdGEuY29kZSkge1xyXG4gICAgICBjYXNlIElkZW50aXR5QWNxdWlzaXRpb25FcnJvckNvZGUuRG9jdW1lbnRvU2NhZHV0bzpcclxuICAgICAgICB0aHJvdyBuZXcgVnVsbmVyYWJsZURvY3VtZW50b1NjYWR1dG9FcnJvcihkYXRhLmNvZGUsIGxvZ0hhc2gpO1xyXG4gICAgICBjYXNlIElkZW50aXR5QWNxdWlzaXRpb25FcnJvckNvZGUuRG9jdW1lbnRvTm9uTGVnZ2liaWxlOlxyXG4gICAgICAgIHRocm93IG5ldyBWdWxuZXJhYmxlRG9jdW1lbnRvTm9uTGVnZ2liaWxlRXJyb3IoZGF0YS5jb2RlLCBsb2dIYXNoKTtcclxuICAgICAgY2FzZSBJZGVudGl0eUFjcXVpc2l0aW9uRXJyb3JDb2RlLkRvY3VtZW50b05vblJpY29ub3NjaXV0bzpcclxuICAgICAgICB0aHJvdyBuZXcgVnVsbmVyYWJsZURvY3VtZW50b05vblJpY29ub3NjaXV0b0Vycm9yKGRhdGEuY29kZSwgbG9nSGFzaCk7XHJcbiAgICAgIGNhc2UgSWRlbnRpdHlBY3F1aXNpdGlvbkVycm9yQ29kZS5Eb2N1bWVudG9Ob25Db21wbGV0bzpcclxuICAgICAgICB0aHJvdyBuZXcgVnVsbmVyYWJsZURvY3VtZW50b05vbkNvbXBsZXRvRXJyb3IoZGF0YS5jb2RlLCBsb2dIYXNoKTtcclxuICAgICAgY2FzZSBJZGVudGl0eUFjcXVpc2l0aW9uRXJyb3JDb2RlLkRvY3VtZW50b0RhdGlBbmFncmFmaWNpOlxyXG4gICAgICAgIHRocm93IG5ldyBWdWxuZXJhYmxlRG9jdW1lbnRvRGF0aUFuYWdyYWZpY2lFcnJvcihkYXRhLmNvZGUsIGxvZ0hhc2gpO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBWdWxuZXJhYmxlRG9jdW1lbnRvVGVjbmljb0Vycm9yKGRhdGEuY29kZSwgbG9nSGFzaCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBleHRlbnNpb25Gb3JGaWxlTmFtZTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcclxuICAnYXBwbGljYXRpb24vcGRmJzogJ3BkZicsXHJcbiAgJ2ltYWdlL3BuZyc6ICdwbmcnLFxyXG4gICdpbWFnZS9qcGVnJzogJ2pwZycsXHJcbn07XHJcblxyXG5mdW5jdGlvbiBnZXRGaWxlTmFtZShwYXJ0OiAnZnJvbnRlJyB8ICdyZXRybycsIGZpbGU6IEJsb2IpIHtcclxuICBjb25zdCBiID0gZXh0ZW5zaW9uRm9yRmlsZU5hbWVbZmlsZS50eXBlXTtcclxuICBpZiAoIWIpIHtcclxuICAgIHRocm93IEVycm9yKGBUaXBvIG1pbWUgJHtmaWxlLnR5cGV9IG5vbiB2YWxpZG8gbyBub24gYWJpbGl0YXRvLmApO1xyXG4gIH1cclxuICByZXR1cm4gYCR7cGFydH0uJHtifWA7XHJcbn1cclxuXHJcbnR5cGUgSWRlbnRpdHlPY3JVcGxvYWRUeXBlID0gJ0NhcnRhSWRlbnRpdGEnIHwgJ1Bhc3NhcG9ydG8nIHwgJ1BhdGVudGUnO1xyXG5cclxudHlwZSBJZGVudGl0eUFjcXVpc2l0aW9uRXJyb3IgPSB7XHJcbiAgdHlwZTogJ1NlcnZpY2VFcnJvcic7XHJcbiAgY29kZTogSWRlbnRpdHlBY3F1aXNpdGlvbkVycm9yQ29kZTtcclxuICBhdHRlbXB0czogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IGVudW0gSWRlbnRpdHlBY3F1aXNpdGlvbkVycm9yQ29kZSB7XHJcbiAgLy8gZm9ybWF0byBub24gY29ycmV0dG9cdElsIGZpbGUgY2hlIGhhaSBjYXJpY2F0byBub24gw6ggc3VwcG9ydGF0by4gSSBmb3JtYXRpIHN1cHBvcnRhdGkgc29ubyBKUEcsIFBERiBvIFBOR1xyXG4gIEZvcm1hdG9Ob25Db3JyZXR0byA9ICdFMDAxJyxcclxuICAvLyBQZXNvIE1hc3NpbW8gZmlsZVx0SWwgcGVzbyBtYXNzaW1vIGRlbCBmaWxlIGRldmUgZXNzZXJlIDJNYlxyXG4gIFBlc29NYXNzaW1vID0gJ0UwMDInLFxyXG4gIC8vIERvY3VtZW50byBzY2FkdXRvXHRBc3NpY3VyYXRpIGNoZSBpbCBkb2N1bWVudG8gY2FyaWNhdG8gc2lhIGluIGNvcnNvIGRpIHZhbGlkaXTDoFxyXG4gIERvY3VtZW50b1NjYWR1dG8gPSAnRTAwMycsXHJcbiAgLy8gSW5mb3JtYXppb25pIG5vbiBsZWdnaWJpbGlcdEFzc2ljdXJhdGkgY2hlIGxlIGluZm9ybWF6aW9uaSBkZWwgZG9jdW1lbnRvIGNhcmljYXRvIHNpYW5vIGxlZ2dpYmlsaVxyXG4gIERvY3VtZW50b05vbkxlZ2dpYmlsZSA9ICdFMDA0JyxcclxuICAvLyBEb2N1bWVudG8gbm9uIHJpY29ub3NjaXV0b1x0QXNzaWN1cmF0aSBjaGUgbGUgaW5mb3JtYXppb25pIGRlbCBkb2N1bWVudG8gY2FyaWNhdG8gc2lhbm8gbGVnZ2liaWxpXHJcbiAgRG9jdW1lbnRvTm9uUmljb25vc2NpdXRvID0gJ0UwMDUnLFxyXG4gIC8vIERvY3VtZW50byBub24gY29tcGxldG9cdEFzc2ljdXJhdGkgZGkgYXZlciBjYXJpY2F0byBmcm9udGUgZSByZXRybyBkZWwgZG9jdW1lbnRvIGRpIGlkZW50aWZpY2F6aW9uZVxyXG4gIERvY3VtZW50b05vbkNvbXBsZXRvID0gJ0UwMDYnLFxyXG4gIC8vIERhdGkgYW5hZ3JhZmljaSBub24gY29pbmNpZG9ubyBjb24gaWwgZG9jdW1lbnRvXHRBc3NpY3VyYXRpIGNoZSBsZSBpbmZvcm1hemlvbmkgZGVsIGRvY3VtZW50byBjYXJpY2F0byBzaWFubyBsZWdnaWJpbGlcclxuICBEb2N1bWVudG9EYXRpQW5hZ3JhZmljaSA9ICdFMDA3JyxcclxufVxyXG5cclxudHlwZSBBcmdzID0ge1xyXG4gIGZyb250OiBGaWxlO1xyXG4gIGJhY2s6IEZpbGU7XHJcbiAgZmxhZ3M6IFZ1bG5lcmFiaWxpdHlGbGFnW107XHJcbn07XHJcblxyXG5leHBvcnQgeyBWdWxuZXJhYmlsaXR5RmxhZyB9O1xyXG5cclxuZXhwb3J0IGNvbnN0IHZ1bG5lcmFiaWxpdHlTZWxmQ2VydGlmaWNhdGlvbiQgPSBhdG9tQWN0aW9uKFxyXG4gIGFzeW5jIChnZXQsIHNldCwgYXJnczogQXJncykgPT4ge1xyXG4gICAgc2V0KHZ1bG5lcmFiaWxpdHlTZWxmQ2VydGlmaWNhdGlvbkZsYWdzJCwgYXJncy5mbGFncyk7XHJcblxyXG4gICAgY29uc3QgY29udHJhY3QgPSBnZXQoY3VycmVudENvbnRyYWN0SW5mb0F0b20pO1xyXG4gICAgY29uc3QgcGxpY29Db2RlID0gYXdhaXQgY29udHJhY3QucGxpY29Db2RlO1xyXG4gICAgY29uc3Qgb3BlcmF0aXZlTW9kZSA9IGF3YWl0IGdldChvcGVyYXRpdmVNb2RlQXRvbSk7XHJcbiAgICBjb25zdCBub21lID0gYXdhaXQgZ2V0KGdpdmVuTmFtZUF0b20pO1xyXG4gICAgY29uc3QgY29nbm9tZSA9IGF3YWl0IGdldChmYW1pbHlOYW1lQXRvbSk7XHJcblxyXG4gICAgY29uc3QgbXV0YXRpb24kID0gYXRvbVdpdGhNdXRhdGlvbigoKSA9PiB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbXV0YXRpb25LZXk6IFsnaWRlbnRpdHlPY3JVcGxvYWQnXSxcclxuICAgICAgICBtdXRhdGlvbkZuOiAoeyBmcm9udCwgYmFjayB9OiBBcmdzKSA9PlxyXG4gICAgICAgICAgaWRlbnRpdHlPY3JVcGxvYWQoe1xyXG4gICAgICAgICAgICBwbGljb0NvZGU6IHBsaWNvQ29kZSxcclxuICAgICAgICAgICAgZnJvbnQ6IGZyb250LFxyXG4gICAgICAgICAgICBiYWNrOiBiYWNrLFxyXG4gICAgICAgICAgICBub21lOiBub21lISxcclxuICAgICAgICAgICAgY29nbm9tZTogY29nbm9tZSEsXHJcbiAgICAgICAgICAgIHNhbGVzUHJvY2VzczogZ2V0U2FsZXNQcm9jZXNzKG9wZXJhdGl2ZU1vZGUpISxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGdldChtdXRhdGlvbiQpLm11dGF0ZUFzeW5jKGFyZ3MpO1xyXG4gIH1cclxuKTtcclxuXHJcbmZ1bmN0aW9uIGdldFNhbGVzUHJvY2VzcyhvcGVyYXRpdmVNb2RlOiBPcGVyYXRpdmVNb2RlIHwgdW5kZWZpbmVkKSB7XHJcbiAgc3dpdGNoIChvcGVyYXRpdmVNb2RlKSB7XHJcbiAgICBjYXNlIE9wZXJhdGl2ZU1vZGUuU1dJVENIX0lOOlxyXG4gICAgICByZXR1cm4gJ1NXSVRDSF9JTic7XHJcbiAgICBjYXNlIE9wZXJhdGl2ZU1vZGUuTkVXX0FDVElWQVRJT046XHJcbiAgICAgIHJldHVybiAnQVRUSVZBWklPTkknO1xyXG4gICAgY2FzZSBPcGVyYXRpdmVNb2RlLkNIQU5HRV9PRkZFUjpcclxuICAgICAgcmV0dXJuICdDQU1CSU9fUFJPRE9UVE8nO1xyXG4gIH1cclxufVxyXG4iXSwiZmlsZSI6IkM6L1VzZXJzL2FpbnRyb25hL0Rlc2t0b3AvQXBwL3JlYWN0L25hai9saWJzL2RhdGEtYWNjZXNzL3NyYy9saWIvYXBpL3dlYm9yZGVyL29jci12dWxuZXJhYmlsaS50cyJ9