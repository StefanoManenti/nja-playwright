globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { fromSiNo, fromYN, toSiNo, toYN } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { atom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/node_modules/.vite/apps/naj/deps/jotai.js?v=0189a8d1";
import { EgonAddress } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/egon/types.ts";
import { ImmediateEffect } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/effective-dates/types.ts";
import { workingOnBroadbandAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/troubleshooting/troubleshooting.ts";
import { broadband$ } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/broadband/broadband.ts";
export const bulkOrderBroadband$ = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\atoms\\contract\\helpers\\broadband.ts/bulkOrderBroadband$", atom(async (get) => {
  const enabled = get(workingOnBroadbandAtom);
  if (!enabled) {
    return {};
  }
  const broadband = await get(broadband$);
  const phone = get(broadband.phone$);
  const address = await get(broadband.address$);
  const migrationCode = await get(broadband.migrationCode$);
  const effectiveDate = await get(broadband.effectiveDate$);
  const contactPhone = await get(broadband.contactPhone$);
  const customerModem = get(broadband.customerModem$);
  const salesProcess = get(broadband.salesProcess$);
  const broadbandData = {
    contactPhone: contactPhone?.full ?? "",
    // TODO REMOVE productId HARDCODED
    productId: "SKU_PLNBB_PERNOI_202507",
    // TODO REMOVE customerType HARDCODED
    customerType: "Dipendente",
    voiceService: toSiNo(phone?.hasPhone),
    lineNumber: phone?.hasPhone ? phone?.phoneNumber : "",
    immediateEffect: get(broadband.immediateEffect$) === ImmediateEffect.PRIORITY,
    effectiveDate: effectiveDate?.toISOString(),
    provider: address?.provider,
    technology: address?.technology,
    cluster: address?.cluster,
    coverageState: address?.coverageState,
    speedProfile: address?.profile,
    scenario: address?.scenario,
    internet: migrationCode?.hasInternet,
    migrationCode: migrationCode?.migrationCode,
    modemSupply: toYN(!customerModem),
    salesProcess
  };
  const toReturn = {
    broadband: broadbandData,
    fornitureData: address?.address.asLeadFormat(),
    salesProcess
  };
  return toReturn;
}, async (get, set, lead) => {
  const bData = lead.broadband;
  const address = EgonAddress.fromLeadFormat(lead.fornitureData);
  const broadband = await get(broadband$);
  if (bData?.voiceService != null) {
    const hasPhone = fromSiNo(bData.voiceService);
    if (hasPhone && bData.lineNumber) {
      set(broadband.phone$, {
        hasPhone: true,
        phoneNumber: bData.lineNumber
      });
    } else if (!hasPhone) {
      set(broadband.phone$, {
        hasPhone: false
      });
    }
  }
  if (bData?.internet != null) {
    if (bData?.internet) {
      await set(broadband.migrationCode$, {
        hasInternet: true,
        migrationCode: bData?.migrationCode
      });
    } else {
      await set(broadband.migrationCode$, {
        hasInternet: false
      });
    }
  }
  if (bData?.modemSupply != null) {
    set(broadband.customerModem$, !fromYN(bData?.modemSupply));
  }
  if (address) {
    await set(broadband.address$, address);
  }
  if (lead.broadband?.contactPhone) {
    set(broadband.contactPhone$, lead.broadband?.contactPhone);
  }
  if (bData?.immediateEffect != null) {
    set(broadband.immediateEffect$, bData.immediateEffect ? ImmediateEffect.PRIORITY : ImmediateEffect.STANDARD);
  }
}));
bulkOrderBroadband$.debugLabel = "bulkOrderBroadband$";

//# sourceMappingURL=data:application/json;base64,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QUFPckM7QUFBQUEsTUFDeEIsQ0FBQztBQUFBLElBQ0gsT0FBTztBQUNMLFlBQU1tQyxJQUFJeEMsVUFBVU0sZ0JBQWdCO0FBQUEsUUFDbEM2QixhQUFhO0FBQUEsTUFDZixDQUFDO0FBQUEsSUFDSDtBQUFBLEVBQ0Y7QUFFQSxNQUFJTyxPQUFPTixlQUFlLE1BQU07QUFDOUJJLFFBQUl4QyxVQUFVWSxnQkFBZ0IsQ0FBQ3pCLE9BQU91RCxPQUFPTixXQUFXLENBQUM7QUFBQSxFQUMzRDtBQUVBLE1BQUlqQyxTQUFTO0FBQ1gsVUFBTXFDLElBQUl4QyxVQUFVSSxVQUFVRCxPQUFPO0FBQUEsRUFDdkM7QUFFQSxNQUFJc0MsS0FBS3pDLFdBQVdTLGNBQWM7QUFDaEMrQixRQUFJeEMsVUFBVVUsZUFBZStCLEtBQUt6QyxXQUFXUyxZQUFZO0FBQUEsRUFDM0Q7QUFFQSxNQUFJaUMsT0FBT25CLG1CQUFtQixNQUFNO0FBQ2xDaUIsUUFDRXhDLFVBQVV3QixrQkFDVmtCLE1BQU1uQixrQkFDRi9CLGdCQUFnQmlDLFdBQ2hCakMsZ0JBQWdCb0QsUUFDdEI7QUFBQSxFQUNGO0FBQ0YsQ0FDRixDQUFDO0FBQUNqRCxvQkFBQWtELGFBQUEiLCJuYW1lcyI6WyJmcm9tU2lObyIsImZyb21ZTiIsInRvU2lObyIsInRvWU4iLCJhdG9tIiwiRWdvbkFkZHJlc3MiLCJJbW1lZGlhdGVFZmZlY3QiLCJ3b3JraW5nT25Ccm9hZGJhbmRBdG9tIiwiYnJvYWRiYW5kJCIsImJ1bGtPcmRlckJyb2FkYmFuZCQiLCJnbG9iYWxUaGlzIiwiam90YWlBdG9tQ2FjaGUiLCJnZXQiLCJlbmFibGVkIiwiYnJvYWRiYW5kIiwicGhvbmUiLCJwaG9uZSQiLCJhZGRyZXNzIiwiYWRkcmVzcyQiLCJtaWdyYXRpb25Db2RlIiwibWlncmF0aW9uQ29kZSQiLCJlZmZlY3RpdmVEYXRlIiwiZWZmZWN0aXZlRGF0ZSQiLCJjb250YWN0UGhvbmUiLCJjb250YWN0UGhvbmUkIiwiY3VzdG9tZXJNb2RlbSIsImN1c3RvbWVyTW9kZW0kIiwic2FsZXNQcm9jZXNzIiwic2FsZXNQcm9jZXNzJCIsImJyb2FkYmFuZERhdGEiLCJmdWxsIiwicHJvZHVjdElkIiwiY3VzdG9tZXJUeXBlIiwidm9pY2VTZXJ2aWNlIiwiaGFzUGhvbmUiLCJsaW5lTnVtYmVyIiwicGhvbmVOdW1iZXIiLCJpbW1lZGlhdGVFZmZlY3QiLCJpbW1lZGlhdGVFZmZlY3QkIiwiUFJJT1JJVFkiLCJ0b0lTT1N0cmluZyIsInByb3ZpZGVyIiwidGVjaG5vbG9neSIsImNsdXN0ZXIiLCJjb3ZlcmFnZVN0YXRlIiwic3BlZWRQcm9maWxlIiwicHJvZmlsZSIsInNjZW5hcmlvIiwiaW50ZXJuZXQiLCJoYXNJbnRlcm5ldCIsIm1vZGVtU3VwcGx5IiwidG9SZXR1cm4iLCJmb3JuaXR1cmVEYXRhIiwiYXNMZWFkRm9ybWF0Iiwic2V0IiwibGVhZCIsImJEYXRhIiwiZnJvbUxlYWRGb3JtYXQiLCJTVEFOREFSRCIsImRlYnVnTGFiZWwiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiYnJvYWRiYW5kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZyb21TaU5vLCBmcm9tWU4sIHRvU2lObywgdG9ZTiB9IGZyb20gJ0BuYWotd28vdXRpbCc7XHJcbmltcG9ydCB7IGF0b20gfSBmcm9tICdqb3RhaSc7XHJcbmltcG9ydCB7IEVnb25BZGRyZXNzIH0gZnJvbSAnLi4vLi4vLi4vYXBpL2Vnb24vdHlwZXMnO1xyXG5pbXBvcnQgdHlwZSB7XHJcbiAgQnJvYWRiYW5kRGF0YSxcclxuICBMZWFkQWRkcmVzcyxcclxuICBNb25nb0xlYWQsXHJcbn0gZnJvbSAnLi4vLi4vLi4vYXBpL2xlYWQvX3R5cGVzJztcclxuaW1wb3J0IHsgSW1tZWRpYXRlRWZmZWN0IH0gZnJvbSAnLi4vLi4vLi4vZWZmZWN0aXZlLWRhdGVzL3R5cGVzJztcclxuaW1wb3J0IHsgd29ya2luZ09uQnJvYWRiYW5kQXRvbSB9IGZyb20gJy4uLy4uLy4uL3Ryb3VibGVzaG9vdGluZy90cm91Ymxlc2hvb3RpbmcnO1xyXG5pbXBvcnQgeyBicm9hZGJhbmQkIH0gZnJvbSAnLi4vLi4vYnJvYWRiYW5kL2Jyb2FkYmFuZCc7XHJcbmltcG9ydCB0eXBlIHsgQnJvYWRiYW5kIH0gZnJvbSAnLi4vLi4vYnJvYWRiYW5kL0Jyb2FkYmFuZEF0b21zJztcclxuaW1wb3J0IHsgQXN5bmNCdWxrT3JkZXJIZWxwZXJBdG9tIH0gZnJvbSAnLi90eXBlcyc7XHJcblxyXG50eXBlIERhdGEgPSBQYXJ0aWFsPFxyXG4gIFBpY2s8TW9uZ29MZWFkLCAnYnJvYWRiYW5kJyB8ICdzYWxlc1Byb2Nlc3MnPiAmIHtcclxuICAgIGZvcm5pdHVyZURhdGE/OiBMZWFkQWRkcmVzcztcclxuICB9XHJcbj47XHJcblxyXG5leHBvcnQgY29uc3QgYnVsa09yZGVyQnJvYWRiYW5kJDogQXN5bmNCdWxrT3JkZXJIZWxwZXJBdG9tPERhdGE+ID0gYXRvbShcclxuICBhc3luYyAoZ2V0KSA9PiB7XHJcbiAgICBjb25zdCBlbmFibGVkID0gZ2V0KHdvcmtpbmdPbkJyb2FkYmFuZEF0b20pO1xyXG4gICAgaWYgKCFlbmFibGVkKSB7XHJcbiAgICAgIHJldHVybiB7fTtcclxuICAgIH1cclxuICAgIGNvbnN0IGJyb2FkYmFuZCA9IGF3YWl0IGdldChicm9hZGJhbmQkKTtcclxuICAgIGNvbnN0IHBob25lID0gZ2V0KGJyb2FkYmFuZC5waG9uZSQpO1xyXG4gICAgY29uc3QgYWRkcmVzcyA9IGF3YWl0IGdldChicm9hZGJhbmQuYWRkcmVzcyQpO1xyXG4gICAgY29uc3QgbWlncmF0aW9uQ29kZSA9IGF3YWl0IGdldChicm9hZGJhbmQubWlncmF0aW9uQ29kZSQpO1xyXG4gICAgY29uc3QgZWZmZWN0aXZlRGF0ZSA9IGF3YWl0IGdldChicm9hZGJhbmQuZWZmZWN0aXZlRGF0ZSQpO1xyXG4gICAgY29uc3QgY29udGFjdFBob25lID0gYXdhaXQgZ2V0KGJyb2FkYmFuZC5jb250YWN0UGhvbmUkKTtcclxuICAgIGNvbnN0IGN1c3RvbWVyTW9kZW0gPSBnZXQoYnJvYWRiYW5kLmN1c3RvbWVyTW9kZW0kKTtcclxuICAgIGNvbnN0IHNhbGVzUHJvY2VzcyA9IGdldChicm9hZGJhbmQuc2FsZXNQcm9jZXNzJCk7XHJcblxyXG4gICAgY29uc3QgYnJvYWRiYW5kRGF0YTogQnJvYWRiYW5kRGF0YSA9IHtcclxuICAgICAgY29udGFjdFBob25lOiBjb250YWN0UGhvbmU/LmZ1bGwgPz8gJycsXHJcbiAgICAgIC8vIFRPRE8gUkVNT1ZFIHByb2R1Y3RJZCBIQVJEQ09ERURcclxuICAgICAgcHJvZHVjdElkOiAnU0tVX1BMTkJCX1BFUk5PSV8yMDI1MDcnLFxyXG4gICAgICAvLyBUT0RPIFJFTU9WRSBjdXN0b21lclR5cGUgSEFSRENPREVEXHJcbiAgICAgIGN1c3RvbWVyVHlwZTogJ0RpcGVuZGVudGUnLFxyXG4gICAgICB2b2ljZVNlcnZpY2U6IHRvU2lObyhwaG9uZT8uaGFzUGhvbmUpLFxyXG4gICAgICBsaW5lTnVtYmVyOiBwaG9uZT8uaGFzUGhvbmUgPyBwaG9uZT8ucGhvbmVOdW1iZXIgOiAnJyxcclxuICAgICAgaW1tZWRpYXRlRWZmZWN0OlxyXG4gICAgICAgIGdldChicm9hZGJhbmQuaW1tZWRpYXRlRWZmZWN0JCkgPT09IEltbWVkaWF0ZUVmZmVjdC5QUklPUklUWSxcclxuICAgICAgZWZmZWN0aXZlRGF0ZTogZWZmZWN0aXZlRGF0ZT8udG9JU09TdHJpbmcoKSxcclxuICAgICAgcHJvdmlkZXI6IGFkZHJlc3M/LnByb3ZpZGVyLFxyXG4gICAgICB0ZWNobm9sb2d5OiBhZGRyZXNzPy50ZWNobm9sb2d5LFxyXG4gICAgICBjbHVzdGVyOiBhZGRyZXNzPy5jbHVzdGVyLFxyXG4gICAgICBjb3ZlcmFnZVN0YXRlOiBhZGRyZXNzPy5jb3ZlcmFnZVN0YXRlLFxyXG4gICAgICBzcGVlZFByb2ZpbGU6IGFkZHJlc3M/LnByb2ZpbGUsXHJcbiAgICAgIHNjZW5hcmlvOiBhZGRyZXNzPy5zY2VuYXJpbyxcclxuICAgICAgaW50ZXJuZXQ6IG1pZ3JhdGlvbkNvZGU/Lmhhc0ludGVybmV0LFxyXG4gICAgICBtaWdyYXRpb25Db2RlOiBtaWdyYXRpb25Db2RlPy5taWdyYXRpb25Db2RlLFxyXG4gICAgICBtb2RlbVN1cHBseTogdG9ZTighY3VzdG9tZXJNb2RlbSksXHJcbiAgICAgIHNhbGVzUHJvY2Vzczogc2FsZXNQcm9jZXNzLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB0b1JldHVybjogRGF0YSA9IHtcclxuICAgICAgYnJvYWRiYW5kOiBicm9hZGJhbmREYXRhLFxyXG4gICAgICBmb3JuaXR1cmVEYXRhOiBhZGRyZXNzPy5hZGRyZXNzLmFzTGVhZEZvcm1hdCgpLFxyXG4gICAgICBzYWxlc1Byb2Nlc3M6IHNhbGVzUHJvY2VzcyxcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHRvUmV0dXJuO1xyXG4gIH0sXHJcbiAgYXN5bmMgKGdldCwgc2V0LCBsZWFkKSA9PiB7XHJcbiAgICBjb25zdCBiRGF0YSA9IGxlYWQuYnJvYWRiYW5kO1xyXG4gICAgY29uc3QgYWRkcmVzcyA9IEVnb25BZGRyZXNzLmZyb21MZWFkRm9ybWF0KGxlYWQuZm9ybml0dXJlRGF0YSk7XHJcbiAgICBjb25zdCBicm9hZGJhbmQgPSAoYXdhaXQgZ2V0KGJyb2FkYmFuZCQpKSBhcyB1bmtub3duIGFzIEJyb2FkYmFuZDtcclxuXHJcbiAgICBpZiAoYkRhdGE/LnZvaWNlU2VydmljZSAhPSBudWxsKSB7XHJcbiAgICAgIGNvbnN0IGhhc1Bob25lID0gZnJvbVNpTm8oYkRhdGEudm9pY2VTZXJ2aWNlKTtcclxuICAgICAgaWYgKGhhc1Bob25lICYmIGJEYXRhLmxpbmVOdW1iZXIpIHtcclxuICAgICAgICBzZXQoYnJvYWRiYW5kLnBob25lJCwge1xyXG4gICAgICAgICAgaGFzUGhvbmU6IHRydWUsXHJcbiAgICAgICAgICBwaG9uZU51bWJlcjogYkRhdGEubGluZU51bWJlcixcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmICghaGFzUGhvbmUpIHtcclxuICAgICAgICBzZXQoYnJvYWRiYW5kLnBob25lJCwgeyBoYXNQaG9uZTogZmFsc2UgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoYkRhdGE/LmludGVybmV0ICE9IG51bGwpIHtcclxuICAgICAgaWYgKGJEYXRhPy5pbnRlcm5ldCkge1xyXG4gICAgICAgIGF3YWl0IHNldChicm9hZGJhbmQubWlncmF0aW9uQ29kZSQsIHtcclxuICAgICAgICAgIGhhc0ludGVybmV0OiB0cnVlLFxyXG4gICAgICAgICAgbWlncmF0aW9uQ29kZTogYkRhdGE/Lm1pZ3JhdGlvbkNvZGUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYXdhaXQgc2V0KGJyb2FkYmFuZC5taWdyYXRpb25Db2RlJCwge1xyXG4gICAgICAgICAgaGFzSW50ZXJuZXQ6IGZhbHNlLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGJEYXRhPy5tb2RlbVN1cHBseSAhPSBudWxsKSB7XHJcbiAgICAgIHNldChicm9hZGJhbmQuY3VzdG9tZXJNb2RlbSQsICFmcm9tWU4oYkRhdGE/Lm1vZGVtU3VwcGx5KSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFkZHJlc3MpIHtcclxuICAgICAgYXdhaXQgc2V0KGJyb2FkYmFuZC5hZGRyZXNzJCwgYWRkcmVzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGxlYWQuYnJvYWRiYW5kPy5jb250YWN0UGhvbmUpIHtcclxuICAgICAgc2V0KGJyb2FkYmFuZC5jb250YWN0UGhvbmUkLCBsZWFkLmJyb2FkYmFuZD8uY29udGFjdFBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYkRhdGE/LmltbWVkaWF0ZUVmZmVjdCAhPSBudWxsKSB7XHJcbiAgICAgIHNldChcclxuICAgICAgICBicm9hZGJhbmQuaW1tZWRpYXRlRWZmZWN0JCxcclxuICAgICAgICBiRGF0YS5pbW1lZGlhdGVFZmZlY3RcclxuICAgICAgICAgID8gSW1tZWRpYXRlRWZmZWN0LlBSSU9SSVRZXHJcbiAgICAgICAgICA6IEltbWVkaWF0ZUVmZmVjdC5TVEFOREFSRFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuKTtcclxuIl0sImZpbGUiOiJDOi9Vc2Vycy9haW50cm9uYS9EZXNrdG9wL0FwcC9yZWFjdC9uYWovbGlicy9kYXRhLWFjY2Vzcy9zcmMvbGliL2F0b21zL2NvbnRyYWN0L2hlbHBlcnMvYnJvYWRiYW5kLnRzIn0=