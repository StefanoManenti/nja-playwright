globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { atom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/node_modules/.vite/apps/naj/deps/jotai.js?v=0189a8d1";
import { fetchFornitureCambioProdotto } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/cambio-prodotto/forniture.ts";
import { EgonAddress } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/egon/types.ts";
import { atomWithCheckD365 } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/checkD365.ts";
import { atomWithAddressAsString } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms-generators/atomWithAddressAsString.ts";
import { ChangeOfferAccount } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms-generators/ChangeOfferAccount.ts";
import { workingProductAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/troubleshooting/troubleshooting.ts";
import { atomWithErrorReset } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/atomWithRetryableQuery.ts";
import { writableAtomFromService } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/writableAtomFromService.ts";
import { atomWithPhone } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/customer/phone-atoms.ts";
import { Segment } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/enums.ts";
export class ChangeOfferCustomer {
  constructor(user) {
    this.user = user;
    this.type = atom("D365");
    const segment = user.partitaIVA ? Segment.SMALL : Segment.RESID;
    this.segment = atom(segment);
    this.customerCode = atom(user.userId);
    const d365$ = atomWithCheckD365({
      saltaCreditCheck: true,
      segmento: segment,
      nome: user.nome,
      cognome: user.cognomeRagSoc,
      email: user.emailRecapito,
      codiceFiscale: user.codiceFiscale,
      partitaIva: user.partitaIVA
    });
    function atomWithProfile(key) {
      return writableAtomFromService(d365$, (data) => data[key] ?? void 0);
    }
    function atomWithUser(k) {
      return atom(user[k]);
    }
    const residentialAddress$ = writableAtomFromService(d365$, (data) => EgonAddress.fromCheckD365Format(data.indirizzo) ?? void 0);
    const telephone$ = atomWithUser("cellulare");
    const email$ = atomWithUser("emailRecapito");
    const familyName$ = atomWithUser("cognomeRagSoc");
    const givenName$ = atomWithUser("nome");
    const vatNumber$ = atomWithProfile("partitaIva");
    const taxId$ = atomWithUser("codiceFiscale");
    const legalForm$ = atomWithProfile("formaGiuridica");
    this.profile = {
      businessName$: familyName$,
      email$,
      emailCrypt$: atom(),
      familyName$,
      hasActiveCommodities$: writableAtomFromService(d365$, (data) => data.hasAtLeast1ActiveCommodities),
      legalForm$,
      legalRepresentative$: writableAtomFromService(d365$, (response) => {
        if (response.nomeRapprLeg && response.cognomeRapprLeg && response.codFiscRapprLeg) {
          return {
            type: "individual",
            givenName: response.nomeRapprLeg || "",
            familyName: response.cognomeRapprLeg || "",
            taxId: response.codFiscRapprLeg || ""
          };
        }
      }),
      privacy$: writableAtomFromService(d365$, (response) => ({
        promoPlenitude: isConcessa(response.privacy?.privacyPromozionaleEni),
        marketResearch: isConcessa(response.privacy?.privacyAnalisiRicercaMercato),
        promoThirdParties: isConcessa(response.privacy?.privacyPromozionaleAltreImprese)
      })),
      address$: residentialAddress$,
      addressAsString$: atomWithAddressAsString(residentialAddress$),
      taxId$,
      telephone$,
      telephoneWithCountryCode$: atomWithPhone({
        email$,
        familyName$,
        givenName$,
        telephone$
      }),
      vatNumber$,
      vulnerable$: writableAtomFromService(d365$, (data) => !!data.vulnerabile),
      givenName$
    };
    this.accounts = atomWithErrorReset(async (get) => {
      const wp = get(workingProductAtom);
      const commodity = wp?.commodity?.toString();
      const forniture = await fetchFornitureCambioProdotto({
        commodity: commodity || "DUAL",
        codiceFiscale: this.user.codiceFiscale,
        partitaIva: this.user.partitaIVA
      });
      const map = /* @__PURE__ */ new Map();
      for (const fornitura of forniture) {
        if (fornitura.commodity) {
          map.set(fornitura.codiceConto, new ChangeOfferAccount(fornitura, this));
        }
      }
      return map;
    });
  }
}
function isConcessa(x) {
  return x === "CONCESSA";
}

//# sourceMappingURL=data:application/json;base64,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QUFBLFFBQ0FDO0FBQUFBLFFBQ0FIO0FBQUFBLE1BQ0YsQ0FBQztBQUFBLE1BQ0RJO0FBQUFBLE1BQ0E0QixhQUFhaEUsd0JBQXdCYSxPQUFRWSxVQUFTLENBQUMsQ0FBQ0EsS0FBS3dDLFdBQVc7QUFBQSxNQUN4RTlCO0FBQUFBLElBQ0Y7QUFFQSxTQUFLK0IsV0FBV25FLG1CQUFtQixPQUFPb0UsUUFBUTtBQUNoRCxZQUFNQyxLQUFLRCxJQUFJckUsa0JBQWtCO0FBQ2pDLFlBQU11RSxZQUFZRCxJQUFJQyxXQUFXQyxTQUFTO0FBQzFDLFlBQU1DLFlBQVksTUFBTTlFLDZCQUE2QjtBQUFBLFFBQ25ENEUsV0FBV0EsYUFBYTtBQUFBLFFBQ3hCaEQsZUFBZSxLQUFLaEIsS0FBS2dCO0FBQUFBLFFBQ3pCQyxZQUFZLEtBQUtqQixLQUFLRztBQUFBQSxNQUN4QixDQUFDO0FBQ0QsWUFBTWdFLE1BQU0sb0JBQUlDLElBQXFCO0FBQ3JDLGlCQUFXQyxhQUFhSCxXQUFXO0FBQ2pDLFlBQUlHLFVBQVVMLFdBQVc7QUFDdkJHLGNBQUlHLElBQ0ZELFVBQVVFLGFBQ1YsSUFBSS9FLG1CQUFtQjZFLFdBQVcsSUFBSSxDQUN4QztBQUFBLFFBQ0Y7QUFBQSxNQUNGO0FBQ0EsYUFBT0Y7QUFBQUEsSUFDVCxDQUFDO0FBQUEsRUFDSDtBQUNGO0FBRUEsU0FBU2xCLFdBQVd1QixHQUE0QztBQUM5RCxTQUFPQSxNQUFNO0FBQ2YiLCJuYW1lcyI6WyJhdG9tIiwiZmV0Y2hGb3JuaXR1cmVDYW1iaW9Qcm9kb3R0byIsIkVnb25BZGRyZXNzIiwiYXRvbVdpdGhDaGVja0QzNjUiLCJhdG9tV2l0aEFkZHJlc3NBc1N0cmluZyIsIkNoYW5nZU9mZmVyQWNjb3VudCIsIndvcmtpbmdQcm9kdWN0QXRvbSIsImF0b21XaXRoRXJyb3JSZXNldCIsIndyaXRhYmxlQXRvbUZyb21TZXJ2aWNlIiwiYXRvbVdpdGhQaG9uZSIsIlNlZ21lbnQiLCJDaGFuZ2VPZmZlckN1c3RvbWVyIiwiY29uc3RydWN0b3IiLCJ1c2VyIiwidHlwZSIsInNlZ21lbnQiLCJwYXJ0aXRhSVZBIiwiU01BTEwiLCJSRVNJRCIsImN1c3RvbWVyQ29kZSIsInVzZXJJZCIsImQzNjUkIiwic2FsdGFDcmVkaXRDaGVjayIsInNlZ21lbnRvIiwibm9tZSIsImNvZ25vbWUiLCJjb2dub21lUmFnU29jIiwiZW1haWwiLCJlbWFpbFJlY2FwaXRvIiwiY29kaWNlRmlzY2FsZSIsInBhcnRpdGFJdmEiLCJhdG9tV2l0aFByb2ZpbGUiLCJrZXkiLCJkYXRhIiwidW5kZWZpbmVkIiwiYXRvbVdpdGhVc2VyIiwiayIsInJlc2lkZW50aWFsQWRkcmVzcyQiLCJmcm9tQ2hlY2tEMzY1Rm9ybWF0IiwiaW5kaXJpenpvIiwidGVsZXBob25lJCIsImVtYWlsJCIsImZhbWlseU5hbWUkIiwiZ2l2ZW5OYW1lJCIsInZhdE51bWJlciQiLCJ0YXhJZCQiLCJsZWdhbEZvcm0kIiwicHJvZmlsZSIsImJ1c2luZXNzTmFtZSQiLCJlbWFpbENyeXB0JCIsImhhc0FjdGl2ZUNvbW1vZGl0aWVzJCIsImhhc0F0TGVhc3QxQWN0aXZlQ29tbW9kaXRpZXMiLCJsZWdhbFJlcHJlc2VudGF0aXZlJCIsInJlc3BvbnNlIiwibm9tZVJhcHByTGVnIiwiY29nbm9tZVJhcHByTGVnIiwiY29kRmlzY1JhcHByTGVnIiwiZ2l2ZW5OYW1lIiwiZmFtaWx5TmFtZSIsInRheElkIiwicHJpdmFjeSQiLCJwcm9tb1BsZW5pdHVkZSIsImlzQ29uY2Vzc2EiLCJwcml2YWN5IiwicHJpdmFjeVByb21vemlvbmFsZUVuaSIsIm1hcmtldFJlc2VhcmNoIiwicHJpdmFjeUFuYWxpc2lSaWNlcmNhTWVyY2F0byIsInByb21vVGhpcmRQYXJ0aWVzIiwicHJpdmFjeVByb21vemlvbmFsZUFsdHJlSW1wcmVzZSIsImFkZHJlc3MkIiwiYWRkcmVzc0FzU3RyaW5nJCIsInRlbGVwaG9uZVdpdGhDb3VudHJ5Q29kZSQiLCJ2dWxuZXJhYmxlJCIsInZ1bG5lcmFiaWxlIiwiYWNjb3VudHMiLCJnZXQiLCJ3cCIsImNvbW1vZGl0eSIsInRvU3RyaW5nIiwiZm9ybml0dXJlIiwibWFwIiwiTWFwIiwiZm9ybml0dXJhIiwic2V0IiwiY29kaWNlQ29udG8iLCJ4Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbIkNoYW5nZU9mZmVyQ3VzdG9tZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXRvbSwgUHJpbWl0aXZlQXRvbSB9IGZyb20gJ2pvdGFpJztcclxuaW1wb3J0IHsgZmV0Y2hGb3JuaXR1cmVDYW1iaW9Qcm9kb3R0byB9IGZyb20gJy4uLy4uL2FwaS9jYW1iaW8tcHJvZG90dG8vZm9ybml0dXJlJztcclxuaW1wb3J0IHsgVXRlbnRlTG9nZ2F0byB9IGZyb20gJy4uLy4uL2FwaS9jdXN0b21lci9nZXQtaW5mby11dGVudGUnO1xyXG5pbXBvcnQgeyBFZ29uQWRkcmVzcyB9IGZyb20gJy4uLy4uL2FwaS9lZ29uL3R5cGVzJztcclxuaW1wb3J0IHsgYXRvbVdpdGhDaGVja0QzNjUgfSBmcm9tICcuLi8uLi9hcGkvd2Vib3JkZXIvY2hlY2tEMzY1JztcclxuaW1wb3J0IHsgQ2hlY2tEMzY1UmVzcG9uc2UgfSBmcm9tICcuLi8uLi9hcGkvd2Vib3JkZXIvdHlwZXMnO1xyXG5pbXBvcnQgeyBhdG9tV2l0aEFkZHJlc3NBc1N0cmluZyB9IGZyb20gJy4uLy4uL2F0b21zLWdlbmVyYXRvcnMvYXRvbVdpdGhBZGRyZXNzQXNTdHJpbmcnO1xyXG5pbXBvcnQgeyBDaGFuZ2VPZmZlckFjY291bnQgfSBmcm9tICcuLi8uLi9hdG9tcy1nZW5lcmF0b3JzL0NoYW5nZU9mZmVyQWNjb3VudCc7XHJcbmltcG9ydCB7IHdvcmtpbmdQcm9kdWN0QXRvbSB9IGZyb20gJy4uLy4uL3Ryb3VibGVzaG9vdGluZy90cm91Ymxlc2hvb3RpbmcnO1xyXG5pbXBvcnQgeyBhdG9tV2l0aEVycm9yUmVzZXQgfSBmcm9tICcuLi8uLi91dGlscy9hdG9tV2l0aFJldHJ5YWJsZVF1ZXJ5JztcclxuaW1wb3J0IHsgd3JpdGFibGVBdG9tRnJvbVNlcnZpY2UgfSBmcm9tICcuLi8uLi91dGlscy93cml0YWJsZUF0b21Gcm9tU2VydmljZSc7XHJcbmltcG9ydCB7IEFjY291bnQsIHR5cGUgQXN5bmNBdG9tLCBDdXN0b21lciwgdHlwZSBQcm9maWxlIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBhdG9tV2l0aFBob25lIH0gZnJvbSAnLi9waG9uZS1hdG9tcyc7XHJcbmltcG9ydCB7IFNlZ21lbnQgfSBmcm9tICcuLi9lbnVtcyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQ2hhbmdlT2ZmZXJDdXN0b21lciBpbXBsZW1lbnRzIEN1c3RvbWVyIHtcclxuICByZWFkb25seSB0eXBlID0gYXRvbTwnUHJvc3BlY3QnIHwgJ0QzNjUnIHwgdW5kZWZpbmVkPignRDM2NScpO1xyXG4gIHJlYWRvbmx5IGN1c3RvbWVyQ29kZTogUHJpbWl0aXZlQXRvbTxzdHJpbmcgfCB1bmRlZmluZWQ+O1xyXG4gIHJlYWRvbmx5IHNlZ21lbnQ6IEFzeW5jQXRvbTxTZWdtZW50PjtcclxuICByZWFkb25seSBwcm9maWxlOiBQcm9maWxlO1xyXG4gIHJlYWRvbmx5IGFjY291bnRzOiBBc3luY0F0b208TWFwPHN0cmluZywgQWNjb3VudD4+O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHVzZXI6IFV0ZW50ZUxvZ2dhdG8pIHtcclxuICAgIGNvbnN0IHNlZ21lbnQgPSB1c2VyLnBhcnRpdGFJVkEgPyBTZWdtZW50LlNNQUxMIDogU2VnbWVudC5SRVNJRDtcclxuICAgIHRoaXMuc2VnbWVudCA9IGF0b208U2VnbWVudD4oc2VnbWVudCk7XHJcbiAgICB0aGlzLmN1c3RvbWVyQ29kZSA9IGF0b208c3RyaW5nIHwgdW5kZWZpbmVkPih1c2VyLnVzZXJJZCk7XHJcblxyXG4gICAgY29uc3QgZDM2NSQgPSBhdG9tV2l0aENoZWNrRDM2NSh7XHJcbiAgICAgIHNhbHRhQ3JlZGl0Q2hlY2s6IHRydWUsXHJcbiAgICAgIHNlZ21lbnRvOiBzZWdtZW50LFxyXG4gICAgICBub21lOiB1c2VyLm5vbWUsXHJcbiAgICAgIGNvZ25vbWU6IHVzZXIuY29nbm9tZVJhZ1NvYyxcclxuICAgICAgZW1haWw6IHVzZXIuZW1haWxSZWNhcGl0byxcclxuICAgICAgY29kaWNlRmlzY2FsZTogdXNlci5jb2RpY2VGaXNjYWxlLFxyXG4gICAgICBwYXJ0aXRhSXZhOiB1c2VyLnBhcnRpdGFJVkEsXHJcbiAgICB9KTtcclxuXHJcbiAgICBmdW5jdGlvbiBhdG9tV2l0aFByb2ZpbGU8SyBleHRlbmRzIGtleW9mIENoZWNrRDM2NVJlc3BvbnNlPihrZXk6IEspIHtcclxuICAgICAgcmV0dXJuIHdyaXRhYmxlQXRvbUZyb21TZXJ2aWNlKGQzNjUkLCAoZGF0YSkgPT4gZGF0YVtrZXldID8/IHVuZGVmaW5lZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYXRvbVdpdGhVc2VyPEsgZXh0ZW5kcyBrZXlvZiBVdGVudGVMb2dnYXRvPihrOiBLKSB7XHJcbiAgICAgIHJldHVybiBhdG9tPFV0ZW50ZUxvZ2dhdG9bS10gfCB1bmRlZmluZWQ+KHVzZXJba10pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlc2lkZW50aWFsQWRkcmVzcyQ6IFByb2ZpbGVbJ2FkZHJlc3MkJ10gPSB3cml0YWJsZUF0b21Gcm9tU2VydmljZTxcclxuICAgICAgRWdvbkFkZHJlc3MgfCB1bmRlZmluZWQsXHJcbiAgICAgIENoZWNrRDM2NVJlc3BvbnNlXHJcbiAgICA+KFxyXG4gICAgICBkMzY1JCxcclxuICAgICAgKGRhdGEpID0+IEVnb25BZGRyZXNzLmZyb21DaGVja0QzNjVGb3JtYXQoZGF0YS5pbmRpcml6em8pID8/IHVuZGVmaW5lZFxyXG4gICAgKTtcclxuICAgIGNvbnN0IHRlbGVwaG9uZSQgPSBhdG9tV2l0aFVzZXIoJ2NlbGx1bGFyZScpO1xyXG5cclxuICAgIGNvbnN0IGVtYWlsJCA9IGF0b21XaXRoVXNlcignZW1haWxSZWNhcGl0bycpO1xyXG4gICAgY29uc3QgZmFtaWx5TmFtZSQgPSBhdG9tV2l0aFVzZXIoJ2NvZ25vbWVSYWdTb2MnKTtcclxuXHJcbiAgICBjb25zdCBnaXZlbk5hbWUkID0gYXRvbVdpdGhVc2VyKCdub21lJyk7XHJcbiAgICBjb25zdCB2YXROdW1iZXIkID0gYXRvbVdpdGhQcm9maWxlKCdwYXJ0aXRhSXZhJyk7XHJcbiAgICBjb25zdCB0YXhJZCQgPSBhdG9tV2l0aFVzZXIoJ2NvZGljZUZpc2NhbGUnKTtcclxuICAgIGNvbnN0IGxlZ2FsRm9ybSQgPSBhdG9tV2l0aFByb2ZpbGUoJ2Zvcm1hR2l1cmlkaWNhJyk7XHJcbiAgICB0aGlzLnByb2ZpbGUgPSB7XHJcbiAgICAgIGJ1c2luZXNzTmFtZSQ6IGZhbWlseU5hbWUkLFxyXG4gICAgICBlbWFpbCQ6IGVtYWlsJCxcclxuICAgICAgZW1haWxDcnlwdCQ6IGF0b20oKSxcclxuICAgICAgZmFtaWx5TmFtZSQ6IGZhbWlseU5hbWUkLFxyXG4gICAgICBoYXNBY3RpdmVDb21tb2RpdGllcyQ6IHdyaXRhYmxlQXRvbUZyb21TZXJ2aWNlKFxyXG4gICAgICAgIGQzNjUkLFxyXG4gICAgICAgIChkYXRhKSA9PiBkYXRhLmhhc0F0TGVhc3QxQWN0aXZlQ29tbW9kaXRpZXNcclxuICAgICAgKSxcclxuICAgICAgbGVnYWxGb3JtJDogbGVnYWxGb3JtJCxcclxuICAgICAgbGVnYWxSZXByZXNlbnRhdGl2ZSQ6IHdyaXRhYmxlQXRvbUZyb21TZXJ2aWNlKGQzNjUkLCAocmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICByZXNwb25zZS5ub21lUmFwcHJMZWcgJiZcclxuICAgICAgICAgIHJlc3BvbnNlLmNvZ25vbWVSYXBwckxlZyAmJlxyXG4gICAgICAgICAgcmVzcG9uc2UuY29kRmlzY1JhcHByTGVnXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlOiAnaW5kaXZpZHVhbCcsXHJcbiAgICAgICAgICAgIGdpdmVuTmFtZTogcmVzcG9uc2Uubm9tZVJhcHByTGVnIHx8ICcnLFxyXG4gICAgICAgICAgICBmYW1pbHlOYW1lOiByZXNwb25zZS5jb2dub21lUmFwcHJMZWcgfHwgJycsXHJcbiAgICAgICAgICAgIHRheElkOiByZXNwb25zZS5jb2RGaXNjUmFwcHJMZWcgfHwgJycsXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcbiAgICAgIHByaXZhY3kkOiB3cml0YWJsZUF0b21Gcm9tU2VydmljZShkMzY1JCwgKHJlc3BvbnNlKSA9PiAoe1xyXG4gICAgICAgIHByb21vUGxlbml0dWRlOiBpc0NvbmNlc3NhKHJlc3BvbnNlLnByaXZhY3k/LnByaXZhY3lQcm9tb3ppb25hbGVFbmkpLFxyXG4gICAgICAgIG1hcmtldFJlc2VhcmNoOiBpc0NvbmNlc3NhKFxyXG4gICAgICAgICAgcmVzcG9uc2UucHJpdmFjeT8ucHJpdmFjeUFuYWxpc2lSaWNlcmNhTWVyY2F0b1xyXG4gICAgICAgICksXHJcbiAgICAgICAgcHJvbW9UaGlyZFBhcnRpZXM6IGlzQ29uY2Vzc2EoXHJcbiAgICAgICAgICByZXNwb25zZS5wcml2YWN5Py5wcml2YWN5UHJvbW96aW9uYWxlQWx0cmVJbXByZXNlXHJcbiAgICAgICAgKSxcclxuICAgICAgfSkpLFxyXG4gICAgICBhZGRyZXNzJDogcmVzaWRlbnRpYWxBZGRyZXNzJCxcclxuICAgICAgYWRkcmVzc0FzU3RyaW5nJDogYXRvbVdpdGhBZGRyZXNzQXNTdHJpbmcocmVzaWRlbnRpYWxBZGRyZXNzJCksXHJcbiAgICAgIHRheElkJDogdGF4SWQkLFxyXG4gICAgICB0ZWxlcGhvbmUkOiB0ZWxlcGhvbmUkLFxyXG4gICAgICB0ZWxlcGhvbmVXaXRoQ291bnRyeUNvZGUkOiBhdG9tV2l0aFBob25lKHtcclxuICAgICAgICBlbWFpbCQ6IGVtYWlsJCxcclxuICAgICAgICBmYW1pbHlOYW1lJDogZmFtaWx5TmFtZSQsXHJcbiAgICAgICAgZ2l2ZW5OYW1lJDogZ2l2ZW5OYW1lJCxcclxuICAgICAgICB0ZWxlcGhvbmUkOiB0ZWxlcGhvbmUkLFxyXG4gICAgICB9KSxcclxuICAgICAgdmF0TnVtYmVyJDogdmF0TnVtYmVyJCxcclxuICAgICAgdnVsbmVyYWJsZSQ6IHdyaXRhYmxlQXRvbUZyb21TZXJ2aWNlKGQzNjUkLCAoZGF0YSkgPT4gISFkYXRhLnZ1bG5lcmFiaWxlKSxcclxuICAgICAgZ2l2ZW5OYW1lJDogZ2l2ZW5OYW1lJCxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5hY2NvdW50cyA9IGF0b21XaXRoRXJyb3JSZXNldChhc3luYyAoZ2V0KSA9PiB7XHJcbiAgICAgIGNvbnN0IHdwID0gZ2V0KHdvcmtpbmdQcm9kdWN0QXRvbSk7XHJcbiAgICAgIGNvbnN0IGNvbW1vZGl0eSA9IHdwPy5jb21tb2RpdHk/LnRvU3RyaW5nKCk7XHJcbiAgICAgIGNvbnN0IGZvcm5pdHVyZSA9IGF3YWl0IGZldGNoRm9ybml0dXJlQ2FtYmlvUHJvZG90dG8oe1xyXG4gICAgICAgIGNvbW1vZGl0eTogY29tbW9kaXR5IHx8ICdEVUFMJyxcclxuICAgICAgICBjb2RpY2VGaXNjYWxlOiB0aGlzLnVzZXIuY29kaWNlRmlzY2FsZSxcclxuICAgICAgICBwYXJ0aXRhSXZhOiB0aGlzLnVzZXIucGFydGl0YUlWQSxcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IG1hcCA9IG5ldyBNYXA8c3RyaW5nLCBBY2NvdW50PigpO1xyXG4gICAgICBmb3IgKGNvbnN0IGZvcm5pdHVyYSBvZiBmb3JuaXR1cmUpIHtcclxuICAgICAgICBpZiAoZm9ybml0dXJhLmNvbW1vZGl0eSkge1xyXG4gICAgICAgICAgbWFwLnNldChcclxuICAgICAgICAgICAgZm9ybml0dXJhLmNvZGljZUNvbnRvLFxyXG4gICAgICAgICAgICBuZXcgQ2hhbmdlT2ZmZXJBY2NvdW50KGZvcm5pdHVyYSwgdGhpcylcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBtYXA7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzQ29uY2Vzc2EoeDogJ0NPTkNFU1NBJyB8ICdOT04gQ09OQ0VTU0EnIHwgdW5kZWZpbmVkKSB7XHJcbiAgcmV0dXJuIHggPT09ICdDT05DRVNTQSc7XHJcbn1cclxuIl0sImZpbGUiOiJDOi9Vc2Vycy9haW50cm9uYS9EZXNrdG9wL0FwcC9yZWFjdC9uYWovbGlicy9kYXRhLWFjY2Vzcy9zcmMvbGliL2F0b21zL2N1c3RvbWVyL0NoYW5nZU9mZmVyQ3VzdG9tZXIudHMifQ==