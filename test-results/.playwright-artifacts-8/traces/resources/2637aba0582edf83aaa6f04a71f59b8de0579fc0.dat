globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { BadInputError, equals } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { atom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/node_modules/.vite/apps/naj/deps/jotai.js?v=0189a8d1";
import { atomWithLazy } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/node_modules/.vite/apps/naj/deps/jotai_utils.js?v=0189a8d1";
import { infoUtenteAtom, isLoggedAtom, mustBeLogged$, useLoggedCustomer$ } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/customer/index.ts";
import { initC360ServiceAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/private-area/init-c360.ts";
import { atomWithCheckD365 } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/checkD365.ts";
import { atomWithCheckEmail } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/verificaIndirizzoEmail.ts";
import { operativeModeAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/troubleshooting/atoms.ts";
import { OperativeMode } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/troubleshooting/types.ts";
import { ChangeOfferCustomer } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/customer/ChangeOfferCustomer.ts";
import { ExistingCustomer } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/customer/ExistingCustomer.ts";
import { NewCustomer } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/customer/NewCustomer.ts";
import { updateCustomerFromD365 } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/customer/updateCustomerFromD365.ts";
import { Segment } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/enums.ts";
import { offerSegmentAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/offer-atoms.ts";
import { TransferType, transferTypeAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/transfer.ts";
import { atomWithNested } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/utils/atom-with-nested.ts";
export const newCustomerAtom = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\atoms\\customer-atoms.ts/newCustomerAtom", atomWithLazy(() => new NewCustomer(offerSegmentAtom)));
newCustomerAtom.debugLabel = "newCustomerAtom";
newCustomerAtom.debugLabel = "newCustomerAtom";
export const loggedCustomerAtom = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\atoms\\customer-atoms.ts/loggedCustomerAtom", atom(async (get) => {
  const isLogged = await get(isLoggedAtom);
  const infoUtente = await get(infoUtenteAtom);
  if (!isLogged || typeof infoUtente.data === "string") {
    return;
  }
  const operativeMode = get(operativeModeAtom);
  if (equals(operativeMode, OperativeMode.CHANGE_OFFER)) {
    return new ChangeOfferCustomer(infoUtente.data);
  }
  const initC360 = await get(initC360ServiceAtom);
  const {
    codiceCliente,
    codiceContoDefault,
    tipoUtente
  } = initC360;
  if (codiceCliente) {
    return new ExistingCustomer(codiceCliente, codiceContoDefault, tipoUtente === "PMI" ? Segment.SMALL : Segment.RESID);
  }
}));
loggedCustomerAtom.debugLabel = "loggedCustomerAtom";
function getCheckD365Request(params) {
  if (params.segment === Segment.SMALL) {
    const {
      email: email2,
      taxId: taxId2,
      vatNumber
    } = params;
    if (!(taxId2 && vatNumber && email2)) {
      throw new BadInputError("taxId && givenName && familyName && email");
    }
    return {
      segmento: Segment.SMALL,
      email: email2,
      codiceFiscale: taxId2,
      partitaIva: vatNumber
    };
  }
  const {
    givenName,
    familyName,
    email,
    taxId
  } = params;
  if (!(taxId && givenName && familyName && email)) {
    throw new BadInputError("taxId && givenName && familyName && email");
  }
  return {
    segmento: Segment.RESID,
    nome: givenName,
    cognome: familyName,
    email,
    codiceFiscale: taxId
  };
}
export const customerAtom = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\atoms\\customer-atoms.ts/customerAtom", atom(async (get) => {
  if (get(mustBeLogged$) || get(useLoggedCustomer$)) {
    const existingCustomer = await get(loggedCustomerAtom);
    if (existingCustomer) {
      return existingCustomer;
    }
  }
  return get(newCustomerAtom);
}, async (get, set, params) => {
  const request = getCheckD365Request(params);
  const response = await get(atomWithCheckD365({
    ...request,
    saltaCreditCheck: get(saltaCreditCheckAtom)
  }));
  const customer = get(newCustomerAtom);
  updateCustomerFromD365(set, customer, request, response);
  if (response.master === "Prospect" && response.email === request.email) {
    await get(atomWithCheckEmail({
      email: request.email
    }));
  }
  if (response.email !== request.email) {
    return {
      emailChanged: response.email
    };
  }
  return {};
}));
customerAtom.debugLabel = "customerAtom";
export const customerTypeAtom = atomWithNested(customerAtom, "type");
export const customerCodeAtom = atomWithNested(customerAtom, "customerCode");
export const customerSegmentAtom = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\atoms\\customer-atoms.ts/customerSegmentAtom", atom(async (get) => {
  const customer = await get(customerAtom);
  return get(customer.segment);
}));
customerSegmentAtom.debugLabel = "customerSegmentAtom";
const saltaCreditCheckAtom = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\atoms\\customer-atoms.ts/saltaCreditCheckAtom", atom((get) => {
  return get(operativeModeAtom) === OperativeMode.TRANSFER && get(transferTypeAtom) === TransferType.MORTIS_CAUSA;
}));
saltaCreditCheckAtom.debugLabel = "saltaCreditCheckAtom";

//# sourceMappingURL=data:application/json;base64,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QUN6QyxTQUNFQSxJQUFJZCxpQkFBaUIsTUFBTUMsY0FBY3FELFlBQ3pDeEMsSUFBSUwsZ0JBQWdCLE1BQU1ELGFBQWErQztBQUUzQyxDQUFDLENBQUM7QUFBQVIscUJBQUFoQyxhQUFBIiwibmFtZXMiOlsiQmFkSW5wdXRFcnJvciIsImVxdWFscyIsImF0b20iLCJhdG9tV2l0aExhenkiLCJpbmZvVXRlbnRlQXRvbSIsImlzTG9nZ2VkQXRvbSIsIm11c3RCZUxvZ2dlZCQiLCJ1c2VMb2dnZWRDdXN0b21lciQiLCJpbml0QzM2MFNlcnZpY2VBdG9tIiwiYXRvbVdpdGhDaGVja0QzNjUiLCJhdG9tV2l0aENoZWNrRW1haWwiLCJvcGVyYXRpdmVNb2RlQXRvbSIsIk9wZXJhdGl2ZU1vZGUiLCJDaGFuZ2VPZmZlckN1c3RvbWVyIiwiRXhpc3RpbmdDdXN0b21lciIsIk5ld0N1c3RvbWVyIiwidXBkYXRlQ3VzdG9tZXJGcm9tRDM2NSIsIlNlZ21lbnQiLCJvZmZlclNlZ21lbnRBdG9tIiwiVHJhbnNmZXJUeXBlIiwidHJhbnNmZXJUeXBlQXRvbSIsImF0b21XaXRoTmVzdGVkIiwibmV3Q3VzdG9tZXJBdG9tIiwiZ2xvYmFsVGhpcyIsImpvdGFpQXRvbUNhY2hlIiwiZ2V0IiwiZGVidWdMYWJlbCIsImxvZ2dlZEN1c3RvbWVyQXRvbSIsImlzTG9nZ2VkIiwiaW5mb1V0ZW50ZSIsImRhdGEiLCJvcGVyYXRpdmVNb2RlIiwiQ0hBTkdFX09GRkVSIiwiaW5pdEMzNjAiLCJjb2RpY2VDbGllbnRlIiwiY29kaWNlQ29udG9EZWZhdWx0IiwidGlwb1V0ZW50ZSIsIlNNQUxMIiwiUkVTSUQiLCJnZXRDaGVja0QzNjVSZXF1ZXN0IiwicGFyYW1zIiwic2VnbWVudCIsImVtYWlsIiwidGF4SWQiLCJ2YXROdW1iZXIiLCJzZWdtZW50byIsImNvZGljZUZpc2NhbGUiLCJwYXJ0aXRhSXZhIiwiZ2l2ZW5OYW1lIiwiZmFtaWx5TmFtZSIsIm5vbWUiLCJjb2dub21lIiwiY3VzdG9tZXJBdG9tIiwiZXhpc3RpbmdDdXN0b21lciIsInNldCIsInJlcXVlc3QiLCJyZXNwb25zZSIsInNhbHRhQ3JlZGl0Q2hlY2siLCJzYWx0YUNyZWRpdENoZWNrQXRvbSIsImN1c3RvbWVyIiwibWFzdGVyIiwiZW1haWxDaGFuZ2VkIiwiY3VzdG9tZXJUeXBlQXRvbSIsImN1c3RvbWVyQ29kZUF0b20iLCJjdXN0b21lclNlZ21lbnRBdG9tIiwiVFJBTlNGRVIiLCJNT1JUSVNfQ0FVU0EiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiY3VzdG9tZXItYXRvbXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFkSW5wdXRFcnJvciwgZXF1YWxzIH0gZnJvbSAnQG5hai13by91dGlsJztcclxuaW1wb3J0IHsgYXRvbSB9IGZyb20gJ2pvdGFpJztcclxuaW1wb3J0IHsgYXRvbVdpdGhMYXp5IH0gZnJvbSAnam90YWkvdXRpbHMnO1xyXG5pbXBvcnQge1xyXG4gIGluZm9VdGVudGVBdG9tLFxyXG4gIGlzTG9nZ2VkQXRvbSxcclxuICBtdXN0QmVMb2dnZWQkLFxyXG4gIHVzZUxvZ2dlZEN1c3RvbWVyJCxcclxufSBmcm9tICcuLi9hcGkvY3VzdG9tZXInO1xyXG5pbXBvcnQgeyBpbml0QzM2MFNlcnZpY2VBdG9tIH0gZnJvbSAnLi4vYXBpL3ByaXZhdGUtYXJlYS9pbml0LWMzNjAnO1xyXG5pbXBvcnQgeyBhdG9tV2l0aENoZWNrRDM2NSB9IGZyb20gJy4uL2FwaS93ZWJvcmRlci9jaGVja0QzNjUnO1xyXG5pbXBvcnQgeyBDaGVja0QzNjVSZXF1ZXN0UGljayB9IGZyb20gJy4uL2FwaS93ZWJvcmRlci90eXBlcyc7XHJcbmltcG9ydCB7IGF0b21XaXRoQ2hlY2tFbWFpbCB9IGZyb20gJy4uL2FwaS93ZWJvcmRlci92ZXJpZmljYUluZGlyaXp6b0VtYWlsJztcclxuaW1wb3J0IHsgb3BlcmF0aXZlTW9kZUF0b20gfSBmcm9tICcuLi90cm91Ymxlc2hvb3RpbmcvYXRvbXMnO1xyXG5pbXBvcnQgeyBPcGVyYXRpdmVNb2RlIH0gZnJvbSAnLi4vdHJvdWJsZXNob290aW5nL3R5cGVzJztcclxuaW1wb3J0IHsgQ2hhbmdlT2ZmZXJDdXN0b21lciB9IGZyb20gJy4vY3VzdG9tZXIvQ2hhbmdlT2ZmZXJDdXN0b21lcic7XHJcbmltcG9ydCB7IEV4aXN0aW5nQ3VzdG9tZXIgfSBmcm9tICcuL2N1c3RvbWVyL0V4aXN0aW5nQ3VzdG9tZXInO1xyXG5pbXBvcnQgeyBOZXdDdXN0b21lciB9IGZyb20gJy4vY3VzdG9tZXIvTmV3Q3VzdG9tZXInO1xyXG5pbXBvcnQgeyB1cGRhdGVDdXN0b21lckZyb21EMzY1IH0gZnJvbSAnLi9jdXN0b21lci91cGRhdGVDdXN0b21lckZyb21EMzY1JztcclxuaW1wb3J0IHsgU2VnbWVudCB9IGZyb20gJy4vZW51bXMnO1xyXG5pbXBvcnQgeyBvZmZlclNlZ21lbnRBdG9tIH0gZnJvbSAnLi9vZmZlci1hdG9tcyc7XHJcbmltcG9ydCB7IFRyYW5zZmVyVHlwZSwgdHJhbnNmZXJUeXBlQXRvbSB9IGZyb20gJy4vdHJhbnNmZXInO1xyXG5pbXBvcnQgeyBDdXN0b21lciB9IGZyb20gJy4vdHlwZXMnO1xyXG5pbXBvcnQgeyBhdG9tV2l0aE5lc3RlZCB9IGZyb20gJy4vdXRpbHMvYXRvbS13aXRoLW5lc3RlZCc7XHJcblxyXG5leHBvcnQgY29uc3QgbmV3Q3VzdG9tZXJBdG9tID0gYXRvbVdpdGhMYXp5PEN1c3RvbWVyPihcclxuICAoKSA9PiBuZXcgTmV3Q3VzdG9tZXIob2ZmZXJTZWdtZW50QXRvbSlcclxuKTtcclxubmV3Q3VzdG9tZXJBdG9tLmRlYnVnTGFiZWwgPSAnbmV3Q3VzdG9tZXJBdG9tJztcclxuXHJcbmV4cG9ydCBjb25zdCBsb2dnZWRDdXN0b21lckF0b20gPSBhdG9tKGFzeW5jIChnZXQpID0+IHtcclxuICBjb25zdCBpc0xvZ2dlZCA9IGF3YWl0IGdldChpc0xvZ2dlZEF0b20pO1xyXG4gIGNvbnN0IGluZm9VdGVudGUgPSBhd2FpdCBnZXQoaW5mb1V0ZW50ZUF0b20pO1xyXG5cclxuICBpZiAoIWlzTG9nZ2VkIHx8IHR5cGVvZiBpbmZvVXRlbnRlLmRhdGEgPT09ICdzdHJpbmcnKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBjb25zdCBvcGVyYXRpdmVNb2RlID0gZ2V0KG9wZXJhdGl2ZU1vZGVBdG9tKTtcclxuICBpZiAoZXF1YWxzKG9wZXJhdGl2ZU1vZGUsIE9wZXJhdGl2ZU1vZGUuQ0hBTkdFX09GRkVSKSkge1xyXG4gICAgLy8gVE9ETyBjaGVjayBpZiBvZmZlciBzZWdtZW50IGlzIGVxdWFsXHJcbiAgICByZXR1cm4gbmV3IENoYW5nZU9mZmVyQ3VzdG9tZXIoaW5mb1V0ZW50ZS5kYXRhKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGluaXRDMzYwID0gYXdhaXQgZ2V0KGluaXRDMzYwU2VydmljZUF0b20pO1xyXG4gIGNvbnN0IHsgY29kaWNlQ2xpZW50ZSwgY29kaWNlQ29udG9EZWZhdWx0LCB0aXBvVXRlbnRlIH0gPSBpbml0QzM2MDtcclxuICBpZiAoY29kaWNlQ2xpZW50ZSkge1xyXG4gICAgcmV0dXJuIG5ldyBFeGlzdGluZ0N1c3RvbWVyKFxyXG4gICAgICBjb2RpY2VDbGllbnRlLFxyXG4gICAgICBjb2RpY2VDb250b0RlZmF1bHQsXHJcbiAgICAgIHRpcG9VdGVudGUgPT09ICdQTUknID8gU2VnbWVudC5TTUFMTCA6IFNlZ21lbnQuUkVTSURcclxuICAgICk7XHJcbiAgfVxyXG59KTtcclxuXHJcbnR5cGUgTmV3Q3VzdG9tZXJQYXJhbXMgPVxyXG4gIHwge1xyXG4gICAgICBzZWdtZW50OiBTZWdtZW50LlJFU0lEO1xyXG4gICAgICBnaXZlbk5hbWU6IHN0cmluZztcclxuICAgICAgZmFtaWx5TmFtZTogc3RyaW5nO1xyXG4gICAgICBlbWFpbDogc3RyaW5nO1xyXG4gICAgICB0YXhJZDogc3RyaW5nO1xyXG4gICAgfVxyXG4gIHwge1xyXG4gICAgICBzZWdtZW50OiBTZWdtZW50LlNNQUxMO1xyXG4gICAgICBlbWFpbDogc3RyaW5nO1xyXG4gICAgICB0YXhJZDogc3RyaW5nO1xyXG4gICAgICB2YXROdW1iZXI6IHN0cmluZztcclxuICAgIH07XHJcblxyXG5mdW5jdGlvbiBnZXRDaGVja0QzNjVSZXF1ZXN0KFxyXG4gIHBhcmFtczogTmV3Q3VzdG9tZXJQYXJhbXNcclxuKTogQ2hlY2tEMzY1UmVxdWVzdFBpY2sgJiB7IGVtYWlsOiBzdHJpbmcgfSB7XHJcbiAgaWYgKHBhcmFtcy5zZWdtZW50ID09PSBTZWdtZW50LlNNQUxMKSB7XHJcbiAgICBjb25zdCB7IGVtYWlsLCB0YXhJZCwgdmF0TnVtYmVyIH0gPSBwYXJhbXM7XHJcbiAgICBpZiAoISh0YXhJZCAmJiB2YXROdW1iZXIgJiYgZW1haWwpKSB7XHJcbiAgICAgIHRocm93IG5ldyBCYWRJbnB1dEVycm9yKCd0YXhJZCAmJiBnaXZlbk5hbWUgJiYgZmFtaWx5TmFtZSAmJiBlbWFpbCcpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc2VnbWVudG86IFNlZ21lbnQuU01BTEwsXHJcbiAgICAgIGVtYWlsOiBlbWFpbCxcclxuICAgICAgY29kaWNlRmlzY2FsZTogdGF4SWQsXHJcbiAgICAgIHBhcnRpdGFJdmE6IHZhdE51bWJlcixcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBjb25zdCB7IGdpdmVuTmFtZSwgZmFtaWx5TmFtZSwgZW1haWwsIHRheElkIH0gPSBwYXJhbXM7XHJcbiAgaWYgKCEodGF4SWQgJiYgZ2l2ZW5OYW1lICYmIGZhbWlseU5hbWUgJiYgZW1haWwpKSB7XHJcbiAgICB0aHJvdyBuZXcgQmFkSW5wdXRFcnJvcigndGF4SWQgJiYgZ2l2ZW5OYW1lICYmIGZhbWlseU5hbWUgJiYgZW1haWwnKTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIHNlZ21lbnRvOiBTZWdtZW50LlJFU0lELFxyXG4gICAgbm9tZTogZ2l2ZW5OYW1lLFxyXG4gICAgY29nbm9tZTogZmFtaWx5TmFtZSxcclxuICAgIGVtYWlsOiBlbWFpbCxcclxuICAgIGNvZGljZUZpc2NhbGU6IHRheElkLFxyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjdXN0b21lckF0b20gPSBhdG9tKFxyXG4gIGFzeW5jIChnZXQpID0+IHtcclxuICAgIGlmIChnZXQobXVzdEJlTG9nZ2VkJCkgfHwgZ2V0KHVzZUxvZ2dlZEN1c3RvbWVyJCkpIHtcclxuICAgICAgY29uc3QgZXhpc3RpbmdDdXN0b21lciA9IGF3YWl0IGdldChsb2dnZWRDdXN0b21lckF0b20pO1xyXG4gICAgICBpZiAoZXhpc3RpbmdDdXN0b21lcikge1xyXG4gICAgICAgIHJldHVybiBleGlzdGluZ0N1c3RvbWVyO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZ2V0KG5ld0N1c3RvbWVyQXRvbSk7XHJcbiAgfSxcclxuICBhc3luYyAoZ2V0LCBzZXQsIHBhcmFtczogTmV3Q3VzdG9tZXJQYXJhbXMpID0+IHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBnZXRDaGVja0QzNjVSZXF1ZXN0KHBhcmFtcyk7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldChcclxuICAgICAgYXRvbVdpdGhDaGVja0QzNjUoe1xyXG4gICAgICAgIC4uLnJlcXVlc3QsXHJcbiAgICAgICAgc2FsdGFDcmVkaXRDaGVjazogZ2V0KHNhbHRhQ3JlZGl0Q2hlY2tBdG9tKSxcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgY3VzdG9tZXIgPSBnZXQobmV3Q3VzdG9tZXJBdG9tKTtcclxuICAgIHVwZGF0ZUN1c3RvbWVyRnJvbUQzNjUoc2V0LCBjdXN0b21lciwgcmVxdWVzdCwgcmVzcG9uc2UpO1xyXG4gICAgaWYgKHJlc3BvbnNlLm1hc3RlciA9PT0gJ1Byb3NwZWN0JyAmJiByZXNwb25zZS5lbWFpbCA9PT0gcmVxdWVzdC5lbWFpbCkge1xyXG4gICAgICBhd2FpdCBnZXQoYXRvbVdpdGhDaGVja0VtYWlsKHsgZW1haWw6IHJlcXVlc3QuZW1haWwgfSkpO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlc3BvbnNlLmVtYWlsICE9PSByZXF1ZXN0LmVtYWlsKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgZW1haWxDaGFuZ2VkOiByZXNwb25zZS5lbWFpbCxcclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIC8vIFRPRE8gcXVpIG1hbmNhIGlsIGNvbnRyb2xsbyBhIEJBQ0tFTkQgKG5vbiBjJ8OoIG5lYW5jaGUgYXMtaXMpIHNlIGwnZW1haWwgdXRpbGl6emF0YSBhcHBhcnRpZW5lIGEgdW4nYWx0cm8gQ0YuXHJcbiAgICAvLyAgICAgIFBvdGVuemlhbG1lbnRlIG5lYW5jaGUgc2VydmUgcGVyY2jDqSBzdGFubm8gaXBvdGl6emFuZG8gY2hlIHF1ZXN0byBub24gZG92cmViYmUgZXNzZXJlIHVuIHZpbmNvbG8uXHJcblxyXG4gICAgLy8gVGhlIHZ1bG5lcmFiaWxpdHkgY2hlY2sgaXMgaW4gYSBkZWRpY2F0ZWQgc3RlcC9hdG9tXHJcblxyXG4gICAgcmV0dXJuIHt9O1xyXG4gIH1cclxuKTtcclxuXHJcbmV4cG9ydCBjb25zdCBjdXN0b21lclR5cGVBdG9tID0gYXRvbVdpdGhOZXN0ZWQoY3VzdG9tZXJBdG9tLCAndHlwZScpO1xyXG5leHBvcnQgY29uc3QgY3VzdG9tZXJDb2RlQXRvbSA9IGF0b21XaXRoTmVzdGVkKGN1c3RvbWVyQXRvbSwgJ2N1c3RvbWVyQ29kZScpO1xyXG5leHBvcnQgY29uc3QgY3VzdG9tZXJTZWdtZW50QXRvbSA9IGF0b20oYXN5bmMgKGdldCkgPT4ge1xyXG4gIGNvbnN0IGN1c3RvbWVyID0gYXdhaXQgZ2V0KGN1c3RvbWVyQXRvbSk7XHJcbiAgcmV0dXJuIGdldChjdXN0b21lci5zZWdtZW50KTtcclxufSk7XHJcblxyXG5jb25zdCBzYWx0YUNyZWRpdENoZWNrQXRvbSA9IGF0b20oKGdldCkgPT4ge1xyXG4gIHJldHVybiAoXHJcbiAgICBnZXQob3BlcmF0aXZlTW9kZUF0b20pID09PSBPcGVyYXRpdmVNb2RlLlRSQU5TRkVSICYmXHJcbiAgICBnZXQodHJhbnNmZXJUeXBlQXRvbSkgPT09IFRyYW5zZmVyVHlwZS5NT1JUSVNfQ0FVU0FcclxuICApO1xyXG59KTtcclxuIl0sImZpbGUiOiJDOi9Vc2Vycy9haW50cm9uYS9EZXNrdG9wL0FwcC9yZWFjdC9uYWovbGlicy9kYXRhLWFjY2Vzcy9zcmMvbGliL2F0b21zL2N1c3RvbWVyLWF0b21zLnRzIn0=