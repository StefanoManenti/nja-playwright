globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { CheckModelloVolturaRedSignalError, CheckModelloVolturaYellowSignalError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/errors/index.ts";
import { OK, ServiceUnhandledResponseError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { currentIdLead } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/current-contract-info-atoms.ts";
import { consentPhoneContactAtom, emailAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/profile-atoms.ts";
import { API, generateOperationID, getLogHashQuery } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/index.ts";
import { atomWithErrorReset } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/atomWithRetryableQuery.ts";
import { creazioneTask } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/creazioneTask.ts";
var EsitoModelloVoltura = /* @__PURE__ */ ((EsitoModelloVoltura2) => {
  EsitoModelloVoltura2["VOLTURA_INESISTENTE"] = "VOLTURA_INESISTENTE";
  EsitoModelloVoltura2["VOLTURA_SENZA_FORNITURE"] = "VOLTURA_SENZA_FORNITURE";
  EsitoModelloVoltura2["VOLTURA_SENZA_COMMODITY"] = "VOLTURA_SENZA_COMMODITY";
  EsitoModelloVoltura2["VOLTURA_SENZA_CODICE_PLICO"] = "VOLTURA_SENZA_CODICE_PLICO";
  EsitoModelloVoltura2["VOLTURA_SENZA_CODICE_FISCALE"] = "VOLTURA_SENZA_CODICE_FISCALE";
  EsitoModelloVoltura2["VOLTURA_SENZA_DENOMINAZIONE_CLIENTE"] = "VOLTURA_SENZA_DENOMINAZIONE_CLIENTE";
  EsitoModelloVoltura2["ERRORE_IMPREVISTO"] = "ERRORE_IMPREVISTO";
  EsitoModelloVoltura2["OK"] = "OK";
  return EsitoModelloVoltura2;
})(EsitoModelloVoltura || {});
var WSOutputRifiuto = /* @__PURE__ */ ((WSOutputRifiuto2) => {
  WSOutputRifiuto2["INPUT_VUOTI"] = "INPUT_VUOTI";
  WSOutputRifiuto2["VOLTURA_INESISTENTE"] = "VOLTURA_INESISTENTE";
  WSOutputRifiuto2["VOLTURA_SENZA_CODICE_PLICO"] = "VOLTURA_SENZA_CODICE_PLICO";
  WSOutputRifiuto2["DATI_CLIENTE_VUOTI"] = "DATI_CLIENTE_VUOTI";
  WSOutputRifiuto2["DATI_FORNITURA_VUOTI"] = "DATI_FORNITURA_VUOTI";
  WSOutputRifiuto2["VOLTURA_GIA_INVIATA"] = "VOLTURA_GIA_INVIATA";
  WSOutputRifiuto2["VOLTURA_GIA_RIFIUTATA"] = "VOLTURA_GIA_RIFIUTATA";
  WSOutputRifiuto2["OK"] = "OK";
  WSOutputRifiuto2["FALLITO"] = "FALLITO";
  return WSOutputRifiuto2;
})(WSOutputRifiuto || {});
async function checkModello(params) {
  const {
    idLead,
    rifiuta,
    ...yellowSignalProps
  } = params;
  const logHash = generateOperationID();
  const query = new URLSearchParams({
    idLead,
    rifiutaVolturaSuSemaforoRosso: rifiuta ? rifiuta.toString() : "false",
    logHash
  });
  const url = `${API}/webOrderCommonServices/voltura/checkModelloVolturaLead?${query}`;
  const response = await fetch(url, {
    method: "POST",
    headers: {
      Accept: "application/json"
    }
  });
  if (response.status !== 200) {
    throw new ServiceUnhandledResponseError(response.statusText, logHash, response);
  }
  const data = await response.json();
  if (data.esito !== "OK" /* OK */) {
    throw new ServiceUnhandledResponseError(data.esito, logHash, response);
  }
  switch (data.esitoCheckSemaforico) {
    case "SEMAFORO_ROSSO": {
      const logHashRifiuto = generateOperationID();
      const urlRifiuto = `${API}/webOrderCommonServices/voltura/v1/${idLead}/refuse?${getLogHashQuery(logHashRifiuto)}`;
      const responseRifiuto = await fetch(urlRifiuto, {
        method: "POST",
        headers: {
          Accept: "application/json"
        }
      });
      if (responseRifiuto.status === 200) {
        const dataRifiuto = await response.json();
        if (dataRifiuto === "OK" /* OK */) throw new CheckModelloVolturaRedSignalError(dataRifiuto, logHash, response);
      }
      throw new ServiceUnhandledResponseError(response.statusText, logHash, response);
    }
    case "NON_DISPONIBILE":
    case "SEMAFORO_VERDE":
      return OK;
    case "SEMAFORO_GIALLO":
      throw new CheckModelloVolturaYellowSignalError(yellowSignalProps, data.esitoCheckSemaforico, logHash, response);
    default:
      throw new ServiceUnhandledResponseError(response.statusText, logHash, response);
  }
}
export const checkModelloAtom = atomWithErrorReset(async (get) => {
  const idLead = get(currentIdLead) || "";
  const email = await get(emailAtom) || "";
  const consentPhoneContact = get(consentPhoneContactAtom) || false;
  await checkModello({
    idLead,
    rifiuta: true,
    email,
    consentPhoneContact,
    onYellowSubmit: async ({
      email: email2,
      consentPhoneContact: consentPhoneContact2
    }) => {
      try {
        await creazioneTask({
          idLead,
          emailRicontatto: email2,
          consensoRicontattoTelefonico: consentPhoneContact2,
          annullaVoltura: true
        });
        return "OK";
      } catch (error) {
        console.debug(error);
        return "KO";
      }
    }
  });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLFNBQ0VBLG1DQUNBQyw0Q0FFSztBQUNQLFNBQVNDLElBQUlDLHFDQUFxQztBQUNsRCxTQUFTQyxxQkFBcUI7QUFDOUIsU0FBU0MseUJBQXlCQyxpQkFBaUI7QUFDbkQsU0FBU0MsS0FBS0MscUJBQXFCQyx1QkFBdUI7QUFDMUQsU0FBU0MsMEJBQTBCO0FBQ25DLFNBQVNDLHFCQUFxQjtBQUU5QixJQUFLQyxzQkFBTCxrQkFBS0EseUJBQUw7QUFFRUMsZ0RBQXNCO0FBRXRCQyxvREFBMEI7QUFFMUJDLG9EQUEwQjtBQUUxQkMsdURBQTZCO0FBRTdCQyx5REFBK0I7QUFFL0JDLGdFQUFzQztBQUV0Q0MsOENBQW9CO0FBRXBCakIsK0JBQUs7QUFoQkZVO0FBQUFBO0FBbUNMLElBQUtRLGtCQUFMLGtCQUFLQSxxQkFBTDtBQUNFQyxvQ0FBYztBQUNkUiw0Q0FBc0I7QUFDdEJHLG1EQUE2QjtBQUM3Qk0sMkNBQXFCO0FBQ3JCQyw2Q0FBdUI7QUFDdkJDLDRDQUFzQjtBQUN0QkMsOENBQXdCO0FBQ3hCdkIsMkJBQUs7QUFDTHdCLGdDQUFVO0FBVFBOO0FBQUFBO0FBa0JMLGVBQWVPLGFBQWFDLFFBQStDO0FBQ3pFLFFBQU07QUFBQSxJQUFFQztBQUFBQSxJQUFRQztBQUFBQSxJQUFTLEdBQUdDO0FBQUFBLEVBQWtCLElBQUlIO0FBQ2xELFFBQU1JLFVBQVV4QixvQkFBb0I7QUFDcEMsUUFBTXlCLFFBQVEsSUFBSUMsZ0JBQWdCO0FBQUEsSUFDaENMO0FBQUFBLElBQ0FNLCtCQUErQkwsVUFBVUEsUUFBUU0sU0FBUyxJQUFJO0FBQUEsSUFDOURKO0FBQUFBLEVBQ0YsQ0FBQztBQUNELFFBQU1LLE1BQU0sR0FBRzlCLEdBQUcsMkRBQTJEMEIsS0FBSztBQUNsRixRQUFNSyxXQUFXLE1BQU1DLE1BQU1GLEtBQUs7QUFBQSxJQUNoQ0csUUFBUTtBQUFBLElBQ1JDLFNBQVM7QUFBQSxNQUNQQyxRQUFRO0FBQUEsSUFDVjtBQUFBLEVBQ0YsQ0FBQztBQUNELE1BQUlKLFNBQVNLLFdBQVcsS0FBSztBQUMzQixVQUFNLElBQUl4Qyw4QkFDUm1DLFNBQVNNLFlBQ1RaLFNBQ0FNLFFBQ0Y7QUFBQSxFQUNGO0FBQ0EsUUFBTU8sT0FBUSxNQUFNUCxTQUFTUSxLQUFLO0FBQ2xDLE1BQUlELEtBQUtFLFVBQVVuQyxlQUF3QjtBQUN6QyxVQUFNLElBQUlULDhCQUE4QjBDLEtBQUtFLE9BQU9mLFNBQVNNLFFBQVE7QUFBQSxFQUN2RTtBQUVBLFVBQVFPLEtBQUtHLHNCQUFvQjtBQUFBLElBQy9CLEtBQUssa0JBQWtCO0FBRXJCLFlBQU1DLGlCQUFpQnpDLG9CQUFvQjtBQUMzQyxZQUFNMEMsYUFBYSxHQUFHM0MsR0FBRyxzQ0FBc0NzQixNQUFNLFdBQVdwQixnQkFDOUV3QyxjQUNGLENBQUM7QUFDRCxZQUFNRSxrQkFBa0IsTUFBTVosTUFBTVcsWUFBWTtBQUFBLFFBQzlDVixRQUFRO0FBQUEsUUFDUkMsU0FBUztBQUFBLFVBQ1BDLFFBQVE7QUFBQSxRQUNWO0FBQUEsTUFDRixDQUFDO0FBRUQsVUFBSVMsZ0JBQWdCUixXQUFXLEtBQUs7QUFDbEMsY0FBTVMsY0FBZSxNQUFNZCxTQUFTUSxLQUFLO0FBQ3pDLFlBQUlNLGdCQUFnQmhDLGNBQ2xCLE9BQU0sSUFBSXBCLGtDQUNSb0QsYUFDQXBCLFNBQ0FNLFFBQ0Y7QUFBQSxNQUNKO0FBQ0EsWUFBTSxJQUFJbkMsOEJBQ1JtQyxTQUFTTSxZQUNUWixTQUNBTSxRQUNGO0FBQUEsSUFDRjtBQUFBLElBQ0EsS0FBSztBQUFBLElBQ0wsS0FBSztBQUNILGFBQU9wQztBQUFBQSxJQUNULEtBQUs7QUFDSCxZQUFNLElBQUlELHFDQUNSOEIsbUJBQ0FjLEtBQUtHLHNCQUNMaEIsU0FDQU0sUUFDRjtBQUFBLElBQ0Y7QUFFRSxZQUFNLElBQUluQyw4QkFDUm1DLFNBQVNNLFlBQ1RaLFNBQ0FNLFFBQ0Y7QUFBQSxFQUNKO0FBQ0Y7QUFFTyxhQUFNZSxtQkFBbUIzQyxtQkFBbUIsT0FBTzRDLFFBQVE7QUFDaEUsUUFBTXpCLFNBQVN5QixJQUFJbEQsYUFBYSxLQUFLO0FBQ3JDLFFBQU1tRCxRQUFTLE1BQU1ELElBQUloRCxTQUFTLEtBQU07QUFDeEMsUUFBTWtELHNCQUFzQkYsSUFBSWpELHVCQUF1QixLQUFLO0FBRTVELFFBQU1zQixhQUFhO0FBQUEsSUFDakJFO0FBQUFBLElBQ0FDLFNBQVM7QUFBQSxJQUNUeUI7QUFBQUEsSUFDQUM7QUFBQUEsSUFDQUMsZ0JBQWdCLE9BQU87QUFBQSxNQUFFRjtBQUFBQSxNQUFPQztBQUFBQSxJQUFvQixNQUFNO0FBQ3hELFVBQUk7QUFDRixjQUFNN0MsY0FBYztBQUFBLFVBQ2xCa0I7QUFBQUEsVUFDQTZCLGlCQUFpQkg7QUFBQUEsVUFDakJJLDhCQUE4Qkg7QUFBQUEsVUFDOUJJLGdCQUFnQjtBQUFBLFFBQ2xCLENBQUM7QUFDRCxlQUFPO0FBQUEsTUFDVCxTQUFTQyxPQUFPO0FBQ2RDLGdCQUFRQyxNQUFNRixLQUFLO0FBQ25CLGVBQU87QUFBQSxNQUNUO0FBQUEsSUFDRjtBQUFBLEVBQ0YsQ0FBQztBQUNILENBQUMiLCJuYW1lcyI6WyJDaGVja01vZGVsbG9Wb2x0dXJhUmVkU2lnbmFsRXJyb3IiLCJDaGVja01vZGVsbG9Wb2x0dXJhWWVsbG93U2lnbmFsRXJyb3IiLCJPSyIsIlNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yIiwiY3VycmVudElkTGVhZCIsImNvbnNlbnRQaG9uZUNvbnRhY3RBdG9tIiwiZW1haWxBdG9tIiwiQVBJIiwiZ2VuZXJhdGVPcGVyYXRpb25JRCIsImdldExvZ0hhc2hRdWVyeSIsImF0b21XaXRoRXJyb3JSZXNldCIsImNyZWF6aW9uZVRhc2siLCJFc2l0b01vZGVsbG9Wb2x0dXJhIiwiVk9MVFVSQV9JTkVTSVNURU5URSIsIlZPTFRVUkFfU0VOWkFfRk9STklUVVJFIiwiVk9MVFVSQV9TRU5aQV9DT01NT0RJVFkiLCJWT0xUVVJBX1NFTlpBX0NPRElDRV9QTElDTyIsIlZPTFRVUkFfU0VOWkFfQ09ESUNFX0ZJU0NBTEUiLCJWT0xUVVJBX1NFTlpBX0RFTk9NSU5BWklPTkVfQ0xJRU5URSIsIkVSUk9SRV9JTVBSRVZJU1RPIiwiV1NPdXRwdXRSaWZpdXRvIiwiSU5QVVRfVlVPVEkiLCJEQVRJX0NMSUVOVEVfVlVPVEkiLCJEQVRJX0ZPUk5JVFVSQV9WVU9USSIsIlZPTFRVUkFfR0lBX0lOVklBVEEiLCJWT0xUVVJBX0dJQV9SSUZJVVRBVEEiLCJGQUxMSVRPIiwiY2hlY2tNb2RlbGxvIiwicGFyYW1zIiwiaWRMZWFkIiwicmlmaXV0YSIsInllbGxvd1NpZ25hbFByb3BzIiwibG9nSGFzaCIsInF1ZXJ5IiwiVVJMU2VhcmNoUGFyYW1zIiwicmlmaXV0YVZvbHR1cmFTdVNlbWFmb3JvUm9zc28iLCJ0b1N0cmluZyIsInVybCIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQWNjZXB0Iiwic3RhdHVzIiwic3RhdHVzVGV4dCIsImRhdGEiLCJqc29uIiwiZXNpdG8iLCJlc2l0b0NoZWNrU2VtYWZvcmljbyIsImxvZ0hhc2hSaWZpdXRvIiwidXJsUmlmaXV0byIsInJlc3BvbnNlUmlmaXV0byIsImRhdGFSaWZpdXRvIiwiY2hlY2tNb2RlbGxvQXRvbSIsImdldCIsImVtYWlsIiwiY29uc2VudFBob25lQ29udGFjdCIsIm9uWWVsbG93U3VibWl0IiwiZW1haWxSaWNvbnRhdHRvIiwiY29uc2Vuc29SaWNvbnRhdHRvVGVsZWZvbmljbyIsImFubnVsbGFWb2x0dXJhIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVidWciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiY2hlY2tNb2RlbGxvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ2hlY2tNb2RlbGxvVm9sdHVyYVJlZFNpZ25hbEVycm9yLFxyXG4gIENoZWNrTW9kZWxsb1ZvbHR1cmFZZWxsb3dTaWduYWxFcnJvcixcclxuICB0eXBlIE1vZGFsRXJyb3JZZWxsb3dTaWduYWxQcm9wcyxcclxufSBmcm9tICcuLi8uLi9lcnJvcnMnO1xyXG5pbXBvcnQgeyBPSywgU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IgfSBmcm9tICdAbmFqLXdvL3V0aWwnO1xyXG5pbXBvcnQgeyBjdXJyZW50SWRMZWFkIH0gZnJvbSAnLi4vLi4vYXRvbXMvY3VycmVudC1jb250cmFjdC1pbmZvLWF0b21zJztcclxuaW1wb3J0IHsgY29uc2VudFBob25lQ29udGFjdEF0b20sIGVtYWlsQXRvbSB9IGZyb20gJy4uLy4uL2F0b21zL3Byb2ZpbGUtYXRvbXMnO1xyXG5pbXBvcnQgeyBBUEksIGdlbmVyYXRlT3BlcmF0aW9uSUQsIGdldExvZ0hhc2hRdWVyeSB9IGZyb20gJy4uLy4uL3V0aWxzJztcclxuaW1wb3J0IHsgYXRvbVdpdGhFcnJvclJlc2V0IH0gZnJvbSAnLi4vLi4vdXRpbHMvYXRvbVdpdGhSZXRyeWFibGVRdWVyeSc7XHJcbmltcG9ydCB7IGNyZWF6aW9uZVRhc2sgfSBmcm9tICcuL2NyZWF6aW9uZVRhc2snO1xyXG5cclxuZW51bSBFc2l0b01vZGVsbG9Wb2x0dXJhIHtcclxuICAvKiogIGwnSUQgbm9uIGNvcnJpc3BvbmRlIGEgbmVzc3VuIGxlYWQsIG8gbm9uIMOoIHVuYSB2b2x0dXJhICovXHJcbiAgVk9MVFVSQV9JTkVTSVNURU5URSA9ICdWT0xUVVJBX0lORVNJU1RFTlRFJyxcclxuICAvKiogbmVsIGxlYWQgbWFuY2EgbCdvZ2dldHRvIFwiZm9ybml0dXJlRGF0YVwiIG8gbWFuY2FubyBnbGkgb2dnZXR0aSBcImdhc1wiIGUvbyBcInBvd2VyXCIgYWwgc3VvIGludGVybm8sIG8gUE9EIGUvbyBQRFIgYWwgbG9ybyBpbnRlcm5vIHNvbm8gdnVvdGkgKi9cclxuICBWT0xUVVJBX1NFTlpBX0ZPUk5JVFVSRSA9ICdWT0xUVVJBX1NFTlpBX0ZPUk5JVFVSRScsXHJcbiAgLyoqIG5lbCBsZWFkIG1hbmNhIGwnb2dnZXR0byBcImNvbW1vZGl0eURhdGFcIiBvIGxhIGNvbW1vZGl0eSBhbCBzdW8gaW50ZXJubyDDqCB2dW90YSAqL1xyXG4gIFZPTFRVUkFfU0VOWkFfQ09NTU9ESVRZID0gJ1ZPTFRVUkFfU0VOWkFfQ09NTU9ESVRZJyxcclxuICAvKiogbmVsIGxlYWQgbWFuY2EgaWwgY29kaWNlIHBsaWNvICovXHJcbiAgVk9MVFVSQV9TRU5aQV9DT0RJQ0VfUExJQ08gPSAnVk9MVFVSQV9TRU5aQV9DT0RJQ0VfUExJQ08nLFxyXG4gIC8qKiBuZWwgbGVhZCBtYW5jYSBpbCBjb2RpY2UgZmlzY2FsZSAqL1xyXG4gIFZPTFRVUkFfU0VOWkFfQ09ESUNFX0ZJU0NBTEUgPSAnVk9MVFVSQV9TRU5aQV9DT0RJQ0VfRklTQ0FMRScsXHJcbiAgLyoqIG5lbCBsZWFkIG1hbmNhbm8gbm9tZSBlIGNvZ25vbWUgKGNsaWVudGUgcmVzaWRlbnppYWxlKSBvIHJhZ2lvbmUgc29jaWFsZSAoY2xpZW50ZSBidXNpbmVzcykgKi9cclxuICBWT0xUVVJBX1NFTlpBX0RFTk9NSU5BWklPTkVfQ0xJRU5URSA9ICdWT0xUVVJBX1NFTlpBX0RFTk9NSU5BWklPTkVfQ0xJRU5URScsXHJcbiAgLyoqIGVycm9yZSBzY29ub3NjaXV0byAqL1xyXG4gIEVSUk9SRV9JTVBSRVZJU1RPID0gJ0VSUk9SRV9JTVBSRVZJU1RPJyxcclxuICAvKiogc2UgbGEgY2hpYW1hdGEgcmllc2NlICovXHJcbiAgT0sgPSAnT0snLFxyXG59XHJcblxyXG50eXBlIEVzaXRvQ2hlY2tTZW1hZm9yaWNvID1cclxuICB8ICdTRU1BRk9ST19ST1NTTydcclxuICB8ICdTRU1BRk9ST19HSUFMTE8nXHJcbiAgfCAnU0VNQUZPUk9fVkVSREUnXHJcbiAgfCAnTk9OX0RJU1BPTklCSUxFJztcclxuXHJcbnR5cGUgV1NJbnB1dCA9IHtcclxuICBpZExlYWQ6IHN0cmluZztcclxuICByaWZpdXRhPzogYm9vbGVhbjtcclxufTtcclxudHlwZSBXU091dHB1dCA9IHtcclxuICBlc2l0bzogRXNpdG9Nb2RlbGxvVm9sdHVyYTtcclxuICBlc2l0b0NoZWNrU2VtYWZvcmljbzogRXNpdG9DaGVja1NlbWFmb3JpY287XHJcbiAgc2NvcmU/OiBudW1iZXI7XHJcbn07XHJcblxyXG5lbnVtIFdTT3V0cHV0UmlmaXV0byB7XHJcbiAgSU5QVVRfVlVPVEkgPSAnSU5QVVRfVlVPVEknLFxyXG4gIFZPTFRVUkFfSU5FU0lTVEVOVEUgPSAnVk9MVFVSQV9JTkVTSVNURU5URScsXHJcbiAgVk9MVFVSQV9TRU5aQV9DT0RJQ0VfUExJQ08gPSAnVk9MVFVSQV9TRU5aQV9DT0RJQ0VfUExJQ08nLFxyXG4gIERBVElfQ0xJRU5URV9WVU9USSA9ICdEQVRJX0NMSUVOVEVfVlVPVEknLFxyXG4gIERBVElfRk9STklUVVJBX1ZVT1RJID0gJ0RBVElfRk9STklUVVJBX1ZVT1RJJyxcclxuICBWT0xUVVJBX0dJQV9JTlZJQVRBID0gJ1ZPTFRVUkFfR0lBX0lOVklBVEEnLFxyXG4gIFZPTFRVUkFfR0lBX1JJRklVVEFUQSA9ICdWT0xUVVJBX0dJQV9SSUZJVVRBVEEnLFxyXG4gIE9LID0gJ09LJyxcclxuICBGQUxMSVRPID0gJ0ZBTExJVE8nLFxyXG59XHJcblxyXG4vKipcclxuICogU2Vydml6aW8gcGVyIGxhIHZlcmlmaWNhIGRlaSBkYXRpIGRlbGxhIGZvcm5pdHVyYSBlIGRlbGxhIHJlbGF0aXZhIHZvbHR1cmFiaWxpdMOgXHJcbiAqIEBwYXJhbSBwYXJhbXNcclxuICogQHJldHVybnNcclxuICovXHJcblxyXG5hc3luYyBmdW5jdGlvbiBjaGVja01vZGVsbG8ocGFyYW1zOiBXU0lucHV0ICYgTW9kYWxFcnJvclllbGxvd1NpZ25hbFByb3BzKSB7XHJcbiAgY29uc3QgeyBpZExlYWQsIHJpZml1dGEsIC4uLnllbGxvd1NpZ25hbFByb3BzIH0gPSBwYXJhbXM7XHJcbiAgY29uc3QgbG9nSGFzaCA9IGdlbmVyYXRlT3BlcmF0aW9uSUQoKTtcclxuICBjb25zdCBxdWVyeSA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xyXG4gICAgaWRMZWFkLFxyXG4gICAgcmlmaXV0YVZvbHR1cmFTdVNlbWFmb3JvUm9zc286IHJpZml1dGEgPyByaWZpdXRhLnRvU3RyaW5nKCkgOiAnZmFsc2UnLFxyXG4gICAgbG9nSGFzaDogbG9nSGFzaCxcclxuICB9KTtcclxuICBjb25zdCB1cmwgPSBgJHtBUEl9L3dlYk9yZGVyQ29tbW9uU2VydmljZXMvdm9sdHVyYS9jaGVja01vZGVsbG9Wb2x0dXJhTGVhZD8ke3F1ZXJ5fWA7XHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgIH0sXHJcbiAgfSk7XHJcbiAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XHJcbiAgICB0aHJvdyBuZXcgU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IoXHJcbiAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQsXHJcbiAgICAgIGxvZ0hhc2gsXHJcbiAgICAgIHJlc3BvbnNlXHJcbiAgICApO1xyXG4gIH1cclxuICBjb25zdCBkYXRhID0gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSkgYXMgV1NPdXRwdXQ7XHJcbiAgaWYgKGRhdGEuZXNpdG8gIT09IEVzaXRvTW9kZWxsb1ZvbHR1cmEuT0spIHtcclxuICAgIHRocm93IG5ldyBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvcihkYXRhLmVzaXRvLCBsb2dIYXNoLCByZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBzd2l0Y2ggKGRhdGEuZXNpdG9DaGVja1NlbWFmb3JpY28pIHtcclxuICAgIGNhc2UgJ1NFTUFGT1JPX1JPU1NPJzoge1xyXG4gICAgICAvL1RPRE8gbWlnbGlvcmFyZSBsYSBnZXN0aW9uZSBkZWwgcmlmaXV0byBzZXBhcmFuZG9sYSBkYWwgY2hlY2sgbW9kZWxsb1xyXG4gICAgICBjb25zdCBsb2dIYXNoUmlmaXV0byA9IGdlbmVyYXRlT3BlcmF0aW9uSUQoKTtcclxuICAgICAgY29uc3QgdXJsUmlmaXV0byA9IGAke0FQSX0vd2ViT3JkZXJDb21tb25TZXJ2aWNlcy92b2x0dXJhL3YxLyR7aWRMZWFkfS9yZWZ1c2U/JHtnZXRMb2dIYXNoUXVlcnkoXHJcbiAgICAgICAgbG9nSGFzaFJpZml1dG9cclxuICAgICAgKX1gO1xyXG4gICAgICBjb25zdCByZXNwb25zZVJpZml1dG8gPSBhd2FpdCBmZXRjaCh1cmxSaWZpdXRvLCB7XHJcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAocmVzcG9uc2VSaWZpdXRvLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgY29uc3QgZGF0YVJpZml1dG8gPSAoYXdhaXQgcmVzcG9uc2UuanNvbigpKSBhcyBXU091dHB1dFJpZml1dG87XHJcbiAgICAgICAgaWYgKGRhdGFSaWZpdXRvID09PSBXU091dHB1dFJpZml1dG8uT0spXHJcbiAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tNb2RlbGxvVm9sdHVyYVJlZFNpZ25hbEVycm9yKFxyXG4gICAgICAgICAgICBkYXRhUmlmaXV0byxcclxuICAgICAgICAgICAgbG9nSGFzaCxcclxuICAgICAgICAgICAgcmVzcG9uc2VcclxuICAgICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgdGhyb3cgbmV3IFNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yKFxyXG4gICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHQsXHJcbiAgICAgICAgbG9nSGFzaCxcclxuICAgICAgICByZXNwb25zZVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgY2FzZSAnTk9OX0RJU1BPTklCSUxFJzogLy8gc2Ugbm9uIGRpc3BvbmliaWxlIGFsbG9yYSBzaSBwcm9zZWd1ZSFcclxuICAgIGNhc2UgJ1NFTUFGT1JPX1ZFUkRFJzpcclxuICAgICAgcmV0dXJuIE9LO1xyXG4gICAgY2FzZSAnU0VNQUZPUk9fR0lBTExPJzpcclxuICAgICAgdGhyb3cgbmV3IENoZWNrTW9kZWxsb1ZvbHR1cmFZZWxsb3dTaWduYWxFcnJvcihcclxuICAgICAgICB5ZWxsb3dTaWduYWxQcm9wcyxcclxuICAgICAgICBkYXRhLmVzaXRvQ2hlY2tTZW1hZm9yaWNvLFxyXG4gICAgICAgIGxvZ0hhc2gsXHJcbiAgICAgICAgcmVzcG9uc2VcclxuICAgICAgKTtcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIC8vbm9uIGRvdnJlYmJlIG1haSBhY2NhZGVyZVxyXG4gICAgICB0aHJvdyBuZXcgU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IoXHJcbiAgICAgICAgcmVzcG9uc2Uuc3RhdHVzVGV4dCxcclxuICAgICAgICBsb2dIYXNoLFxyXG4gICAgICAgIHJlc3BvbnNlXHJcbiAgICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY2hlY2tNb2RlbGxvQXRvbSA9IGF0b21XaXRoRXJyb3JSZXNldChhc3luYyAoZ2V0KSA9PiB7XHJcbiAgY29uc3QgaWRMZWFkID0gZ2V0KGN1cnJlbnRJZExlYWQpIHx8ICcnO1xyXG4gIGNvbnN0IGVtYWlsID0gKGF3YWl0IGdldChlbWFpbEF0b20pKSB8fCAnJztcclxuICBjb25zdCBjb25zZW50UGhvbmVDb250YWN0ID0gZ2V0KGNvbnNlbnRQaG9uZUNvbnRhY3RBdG9tKSB8fCBmYWxzZTtcclxuXHJcbiAgYXdhaXQgY2hlY2tNb2RlbGxvKHtcclxuICAgIGlkTGVhZCxcclxuICAgIHJpZml1dGE6IHRydWUsXHJcbiAgICBlbWFpbDogZW1haWwsXHJcbiAgICBjb25zZW50UGhvbmVDb250YWN0OiBjb25zZW50UGhvbmVDb250YWN0LFxyXG4gICAgb25ZZWxsb3dTdWJtaXQ6IGFzeW5jICh7IGVtYWlsLCBjb25zZW50UGhvbmVDb250YWN0IH0pID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCBjcmVhemlvbmVUYXNrKHtcclxuICAgICAgICAgIGlkTGVhZDogaWRMZWFkLFxyXG4gICAgICAgICAgZW1haWxSaWNvbnRhdHRvOiBlbWFpbCxcclxuICAgICAgICAgIGNvbnNlbnNvUmljb250YXR0b1RlbGVmb25pY286IGNvbnNlbnRQaG9uZUNvbnRhY3QsXHJcbiAgICAgICAgICBhbm51bGxhVm9sdHVyYTogdHJ1ZSxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gJ09LJztcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmRlYnVnKGVycm9yKTtcclxuICAgICAgICByZXR1cm4gJ0tPJztcclxuICAgICAgfVxyXG4gICAgfSxcclxuICB9KTtcclxufSk7XHJcbiJdLCJmaWxlIjoiQzovVXNlcnMvYWludHJvbmEvRGVza3RvcC9BcHAvcmVhY3QvbmFqL2xpYnMvZGF0YS1hY2Nlc3Mvc3JjL2xpYi9hcGkvd2Vib3JkZXIvY2hlY2tNb2RlbGxvLnRzIn0=