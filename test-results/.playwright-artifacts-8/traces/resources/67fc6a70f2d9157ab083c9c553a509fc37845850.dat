globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { ServiceBadInputError, ServiceLimits, ServiceUnhandledResponseError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { currentContractInfoAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/current-contract-info-atoms.ts";
import { AgeOutOfRangeError, CreditCheckError, Ddl009_010Error, TaxIdNotCoherentError, TaxIdNotValidError, TaxIdOutOfRetriesError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/errors/index.ts";
import { API, atomWithRetryableQuery, generateOperationID } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/index.ts";
import { areCheckBypassed } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/flags.ts";
const checkD365Limits = new ServiceLimits(
  4,
  // 5 chiamate massimo
  (reason) => new TaxIdOutOfRetriesError(reason)
);
async function checkD365(payload) {
  if (areCheckBypassed()) {
    return {
      master: "Prospect"
    };
  }
  checkD365Limits.check();
  const logHash = generateOperationID();
  const response = await fetch(`${API}/webOrderCommonServices/checkD365`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Accept: "application/json"
    },
    body: JSON.stringify({
      segmento: payload.segmento,
      partitaIva: payload.partitaIva,
      nome: payload.nome,
      cognome: payload.cognome,
      codiceFiscale: payload.codiceFiscale,
      email: payload.email,
      saltaCreditCheck: payload.saltaCreditCheck,
      logHash,
      idLead: payload.idLead,
      plicoCode: payload.plicoCode,
      salesProcess: payload.salesProcess,
      salesProcessForLog: payload.salesProcessForLog
    })
  });
  if (response.status !== 200) {
    throw checkD365Limits.err(new ServiceUnhandledResponseError(response.statusText, logHash));
  }
  const data = await response.json();
  const errorCode = data.errorManagement?.errorCode;
  if (errorCode === "DDL_009" || errorCode === "DDL_010") {
    throw checkD365Limits.err(new Ddl009_010Error(errorCode, logHash, response));
  }
  if (data.esito === "KO_CREDIT_CHECK" || !payload.saltaCreditCheck && data.response.esitoCreditCheck == null) {
    throw checkD365Limits.err(new CreditCheckError("KO_CREDIT_CHECK", logHash, response));
  }
  if (data.esito !== "OK") {
    const code = errorCode;
    switch (code) {
      case "CODICE_FISCALE_NON_DI_MAGGIORENNE":
        throw checkD365Limits.err(new AgeOutOfRangeError(code, logHash, response));
      case "CF_NON_COERENTE":
        throw checkD365Limits.err(new TaxIdNotCoherentError(code, logHash, response));
      case "CF_NON_VALIDO":
        throw checkD365Limits.err(new TaxIdNotValidError(code, logHash, response));
      case "INPUT_VUOTI":
        throw checkD365Limits.err(new ServiceBadInputError(code, logHash, response));
      default:
        throw checkD365Limits.err(new ServiceUnhandledResponseError(code, logHash, response));
    }
  }
  if (!["Prospect", "D365"].includes(data.master)) {
    throw checkD365Limits.err(new ServiceUnhandledResponseError(data.master, logHash, response));
  }
  checkD365Limits.reset();
  return data;
}
export const atomWithCheckD365 = (params) => {
  return atomWithRetryableQuery(async (get) => {
    const contract = get(currentContractInfoAtom);
    const idLead = contract.idLead;
    const plicoCode = await contract.plicoCode;
    const salesProcess = await contract.salesProcess;
    const salesProcessForLog = await contract.salesProcessForLog;
    return {
      queryKey: ["checkD365", params.segmento, params.partitaIva, params.codiceFiscale, params.nome, params.cognome, params.email, params.saltaCreditCheck],
      queryFn: () => checkD365({
        ...params,
        idLead,
        plicoCode,
        salesProcess,
        salesProcessForLog
      })
    };
  });
};

//# sourceMappingURL=data:application/json;base64,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QUEsSUFDSjtBQUFBLEVBQ0Y7QUFFQSxNQUFJLENBQUMsQ0FBQyxZQUFZLE1BQU0sRUFBRTZCLFNBQVNQLEtBQUt6QixNQUFNLEdBQUc7QUFDL0MsVUFBTUosZ0JBQWdCMkIsSUFDcEIsSUFBSXZDLDhCQUE4QnlDLEtBQUt6QixRQUFRRSxTQUFTQyxRQUFRLENBQ2xFO0FBQUEsRUFDRjtBQUVBUCxrQkFBZ0JxQyxNQUFNO0FBQ3RCLFNBQU9SO0FBQ1Q7QUFFTyxhQUFNUyxvQkFBb0JBLENBQUNDLFdBQWlDO0FBQ2pFLFNBQU8xQyx1QkFBdUIsT0FBTzJDLFFBQVE7QUFDM0MsVUFBTUMsV0FBV0QsSUFBSW5ELHVCQUF1QjtBQUM1QyxVQUFNaUMsU0FBU21CLFNBQVNuQjtBQUN4QixVQUFNQyxZQUFZLE1BQU1rQixTQUFTbEI7QUFDakMsVUFBTUMsZUFBZSxNQUFNaUIsU0FBU2pCO0FBQ3BDLFVBQU1DLHFCQUFxQixNQUFNZ0IsU0FBU2hCO0FBRTFDLFdBQU87QUFBQSxNQUNMaUIsVUFBVSxDQUNSLGFBQ0FILE9BQU94QixVQUNQd0IsT0FBT3ZCLFlBQ1B1QixPQUFPcEIsZUFDUG9CLE9BQU90QixNQUNQc0IsT0FBT3JCLFNBQ1BxQixPQUFPbkIsT0FDUG1CLE9BQU9sQixnQkFBZ0I7QUFBQSxNQUV6QnNCLFNBQVNBLE1BQ1B6QyxVQUFVO0FBQUEsUUFDUixHQUFHcUM7QUFBQUEsUUFDSGpCO0FBQUFBLFFBQ0FDO0FBQUFBLFFBQ0FDO0FBQUFBLFFBQ0FDO0FBQUFBLE1BQ0YsQ0FBQztBQUFBLElBQ0w7QUFBQSxFQUNGLENBQUM7QUFDSCIsIm5hbWVzIjpbIlNlcnZpY2VCYWRJbnB1dEVycm9yIiwiU2VydmljZUxpbWl0cyIsIlNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yIiwiY3VycmVudENvbnRyYWN0SW5mb0F0b20iLCJBZ2VPdXRPZlJhbmdlRXJyb3IiLCJDcmVkaXRDaGVja0Vycm9yIiwiRGRsMDA5XzAxMEVycm9yIiwiVGF4SWROb3RDb2hlcmVudEVycm9yIiwiVGF4SWROb3RWYWxpZEVycm9yIiwiVGF4SWRPdXRPZlJldHJpZXNFcnJvciIsIkFQSSIsImF0b21XaXRoUmV0cnlhYmxlUXVlcnkiLCJnZW5lcmF0ZU9wZXJhdGlvbklEIiwiYXJlQ2hlY2tCeXBhc3NlZCIsImNoZWNrRDM2NUxpbWl0cyIsInJlYXNvbiIsImNoZWNrRDM2NSIsInBheWxvYWQiLCJtYXN0ZXIiLCJjaGVjayIsImxvZ0hhc2giLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsIkFjY2VwdCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwic2VnbWVudG8iLCJwYXJ0aXRhSXZhIiwibm9tZSIsImNvZ25vbWUiLCJjb2RpY2VGaXNjYWxlIiwiZW1haWwiLCJzYWx0YUNyZWRpdENoZWNrIiwiaWRMZWFkIiwicGxpY29Db2RlIiwic2FsZXNQcm9jZXNzIiwic2FsZXNQcm9jZXNzRm9yTG9nIiwic3RhdHVzIiwiZXJyIiwic3RhdHVzVGV4dCIsImRhdGEiLCJqc29uIiwiZXJyb3JDb2RlIiwiZXJyb3JNYW5hZ2VtZW50IiwiZXNpdG8iLCJlc2l0b0NyZWRpdENoZWNrIiwiY29kZSIsImluY2x1ZGVzIiwicmVzZXQiLCJhdG9tV2l0aENoZWNrRDM2NSIsInBhcmFtcyIsImdldCIsImNvbnRyYWN0IiwicXVlcnlLZXkiLCJxdWVyeUZuIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbImNoZWNrRDM2NS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIFNlcnZpY2VCYWRJbnB1dEVycm9yLFxyXG4gIFNlcnZpY2VMaW1pdHMsXHJcbiAgU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IsXHJcbiAgU2VydmljZVZhbGlkYXRpb25Lb0Vycm9yLFxyXG59IGZyb20gJ0BuYWotd28vdXRpbCc7XHJcbmltcG9ydCB7IGN1cnJlbnRDb250cmFjdEluZm9BdG9tIH0gZnJvbSAnLi4vLi4vYXRvbXMvY3VycmVudC1jb250cmFjdC1pbmZvLWF0b21zJztcclxuaW1wb3J0IHtcclxuICBBZ2VPdXRPZlJhbmdlRXJyb3IsXHJcbiAgQ3JlZGl0Q2hlY2tFcnJvcixcclxuICBEZGwwMDlfMDEwRXJyb3IsXHJcbiAgVGF4SWROb3RDb2hlcmVudEVycm9yLFxyXG4gIFRheElkTm90VmFsaWRFcnJvcixcclxuICBUYXhJZE91dE9mUmV0cmllc0Vycm9yLFxyXG59IGZyb20gJy4uLy4uL2Vycm9ycyc7XHJcbmltcG9ydCB7IEFQSSwgYXRvbVdpdGhSZXRyeWFibGVRdWVyeSwgZ2VuZXJhdGVPcGVyYXRpb25JRCB9IGZyb20gJy4uLy4uL3V0aWxzJztcclxuaW1wb3J0IHsgYXJlQ2hlY2tCeXBhc3NlZCB9IGZyb20gJy4uLy4uL3V0aWxzL2ZsYWdzJztcclxuaW1wb3J0IHtcclxuICBDaGVja0QzNjVSZXF1ZXN0LFxyXG4gIENoZWNrRDM2NVJlcXVlc3RQaWNrLFxyXG4gIENoZWNrRDM2NVJlc3BvbnNlLFxyXG59IGZyb20gJy4vdHlwZXMnO1xyXG5cclxuY29uc3QgY2hlY2tEMzY1TGltaXRzID0gbmV3IFNlcnZpY2VMaW1pdHM8U2VydmljZVZhbGlkYXRpb25Lb0Vycm9yPihcclxuICA0LCAvLyA1IGNoaWFtYXRlIG1hc3NpbW9cclxuICAocmVhc29uKSA9PiBuZXcgVGF4SWRPdXRPZlJldHJpZXNFcnJvcihyZWFzb24pXHJcbik7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBjaGVja0QzNjUoXHJcbiAgcGF5bG9hZDogQ2hlY2tEMzY1UmVxdWVzdFxyXG4pOiBQcm9taXNlPENoZWNrRDM2NVJlc3BvbnNlPiB7XHJcbiAgaWYgKGFyZUNoZWNrQnlwYXNzZWQoKSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbWFzdGVyOiAnUHJvc3BlY3QnLFxyXG4gICAgfSBhcyBDaGVja0QzNjVSZXNwb25zZTtcclxuICB9XHJcblxyXG4gIGNoZWNrRDM2NUxpbWl0cy5jaGVjaygpO1xyXG5cclxuICBjb25zdCBsb2dIYXNoID0gZ2VuZXJhdGVPcGVyYXRpb25JRCgpO1xyXG5cclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSX0vd2ViT3JkZXJDb21tb25TZXJ2aWNlcy9jaGVja0QzNjVgLCB7XHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBzZWdtZW50bzogcGF5bG9hZC5zZWdtZW50byxcclxuICAgICAgcGFydGl0YUl2YTogcGF5bG9hZC5wYXJ0aXRhSXZhLFxyXG4gICAgICBub21lOiBwYXlsb2FkLm5vbWUsXHJcbiAgICAgIGNvZ25vbWU6IHBheWxvYWQuY29nbm9tZSxcclxuICAgICAgY29kaWNlRmlzY2FsZTogcGF5bG9hZC5jb2RpY2VGaXNjYWxlLFxyXG4gICAgICBlbWFpbDogcGF5bG9hZC5lbWFpbCxcclxuICAgICAgc2FsdGFDcmVkaXRDaGVjazogcGF5bG9hZC5zYWx0YUNyZWRpdENoZWNrLFxyXG4gICAgICBsb2dIYXNoOiBsb2dIYXNoLFxyXG4gICAgICBpZExlYWQ6IHBheWxvYWQuaWRMZWFkLFxyXG4gICAgICBwbGljb0NvZGU6IHBheWxvYWQucGxpY29Db2RlLFxyXG4gICAgICBzYWxlc1Byb2Nlc3M6IHBheWxvYWQuc2FsZXNQcm9jZXNzLFxyXG4gICAgICBzYWxlc1Byb2Nlc3NGb3JMb2c6IHBheWxvYWQuc2FsZXNQcm9jZXNzRm9yTG9nLFxyXG4gICAgfSksXHJcbiAgfSk7XHJcblxyXG4gIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xyXG4gICAgdGhyb3cgY2hlY2tEMzY1TGltaXRzLmVycihcclxuICAgICAgbmV3IFNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQsIGxvZ0hhc2gpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZGF0YSA9IChhd2FpdCByZXNwb25zZS5qc29uKCkpIGFzIENoZWNrRDM2NVJlc3BvbnNlO1xyXG5cclxuICBjb25zdCBlcnJvckNvZGUgPSBkYXRhLmVycm9yTWFuYWdlbWVudD8uZXJyb3JDb2RlO1xyXG4gIGlmIChlcnJvckNvZGUgPT09ICdERExfMDA5JyB8fCBlcnJvckNvZGUgPT09ICdERExfMDEwJykge1xyXG4gICAgdGhyb3cgY2hlY2tEMzY1TGltaXRzLmVycihcclxuICAgICAgbmV3IERkbDAwOV8wMTBFcnJvcihlcnJvckNvZGUsIGxvZ0hhc2gsIHJlc3BvbnNlKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGlmIChcclxuICAgIGRhdGEuZXNpdG8gPT09ICdLT19DUkVESVRfQ0hFQ0snIHx8XHJcbiAgICAoIXBheWxvYWQuc2FsdGFDcmVkaXRDaGVjayAmJiBkYXRhLnJlc3BvbnNlLmVzaXRvQ3JlZGl0Q2hlY2sgPT0gbnVsbClcclxuICApIHtcclxuICAgIHRocm93IGNoZWNrRDM2NUxpbWl0cy5lcnIoXHJcbiAgICAgIG5ldyBDcmVkaXRDaGVja0Vycm9yKCdLT19DUkVESVRfQ0hFQ0snLCBsb2dIYXNoLCByZXNwb25zZSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBpZiAoZGF0YS5lc2l0byAhPT0gJ09LJykge1xyXG4gICAgY29uc3QgY29kZSA9IGVycm9yQ29kZSE7XHJcbiAgICBzd2l0Y2ggKGNvZGUpIHtcclxuICAgICAgY2FzZSAnQ09ESUNFX0ZJU0NBTEVfTk9OX0RJX01BR0dJT1JFTk5FJzpcclxuICAgICAgICB0aHJvdyBjaGVja0QzNjVMaW1pdHMuZXJyKFxyXG4gICAgICAgICAgbmV3IEFnZU91dE9mUmFuZ2VFcnJvcihjb2RlLCBsb2dIYXNoLCByZXNwb25zZSlcclxuICAgICAgICApO1xyXG4gICAgICBjYXNlICdDRl9OT05fQ09FUkVOVEUnOlxyXG4gICAgICAgIHRocm93IGNoZWNrRDM2NUxpbWl0cy5lcnIoXHJcbiAgICAgICAgICBuZXcgVGF4SWROb3RDb2hlcmVudEVycm9yKGNvZGUsIGxvZ0hhc2gsIHJlc3BvbnNlKVxyXG4gICAgICAgICk7XHJcbiAgICAgIGNhc2UgJ0NGX05PTl9WQUxJRE8nOlxyXG4gICAgICAgIHRocm93IGNoZWNrRDM2NUxpbWl0cy5lcnIoXHJcbiAgICAgICAgICBuZXcgVGF4SWROb3RWYWxpZEVycm9yKGNvZGUsIGxvZ0hhc2gsIHJlc3BvbnNlKVxyXG4gICAgICAgICk7XHJcbiAgICAgIGNhc2UgJ0lOUFVUX1ZVT1RJJzpcclxuICAgICAgICB0aHJvdyBjaGVja0QzNjVMaW1pdHMuZXJyKFxyXG4gICAgICAgICAgbmV3IFNlcnZpY2VCYWRJbnB1dEVycm9yKGNvZGUsIGxvZ0hhc2gsIHJlc3BvbnNlKVxyXG4gICAgICAgICk7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgY2hlY2tEMzY1TGltaXRzLmVycihcclxuICAgICAgICAgIG5ldyBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvcihjb2RlLCBsb2dIYXNoLCByZXNwb25zZSlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaWYgKCFbJ1Byb3NwZWN0JywgJ0QzNjUnXS5pbmNsdWRlcyhkYXRhLm1hc3RlcikpIHtcclxuICAgIHRocm93IGNoZWNrRDM2NUxpbWl0cy5lcnIoXHJcbiAgICAgIG5ldyBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvcihkYXRhLm1hc3RlciwgbG9nSGFzaCwgcmVzcG9uc2UpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY2hlY2tEMzY1TGltaXRzLnJlc2V0KCk7XHJcbiAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBhdG9tV2l0aENoZWNrRDM2NSA9IChwYXJhbXM6IENoZWNrRDM2NVJlcXVlc3RQaWNrKSA9PiB7XHJcbiAgcmV0dXJuIGF0b21XaXRoUmV0cnlhYmxlUXVlcnkoYXN5bmMgKGdldCkgPT4ge1xyXG4gICAgY29uc3QgY29udHJhY3QgPSBnZXQoY3VycmVudENvbnRyYWN0SW5mb0F0b20pO1xyXG4gICAgY29uc3QgaWRMZWFkID0gY29udHJhY3QuaWRMZWFkO1xyXG4gICAgY29uc3QgcGxpY29Db2RlID0gYXdhaXQgY29udHJhY3QucGxpY29Db2RlO1xyXG4gICAgY29uc3Qgc2FsZXNQcm9jZXNzID0gYXdhaXQgY29udHJhY3Quc2FsZXNQcm9jZXNzO1xyXG4gICAgY29uc3Qgc2FsZXNQcm9jZXNzRm9yTG9nID0gYXdhaXQgY29udHJhY3Quc2FsZXNQcm9jZXNzRm9yTG9nO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHF1ZXJ5S2V5OiBbXHJcbiAgICAgICAgJ2NoZWNrRDM2NScsXHJcbiAgICAgICAgcGFyYW1zLnNlZ21lbnRvLFxyXG4gICAgICAgIHBhcmFtcy5wYXJ0aXRhSXZhLFxyXG4gICAgICAgIHBhcmFtcy5jb2RpY2VGaXNjYWxlLFxyXG4gICAgICAgIHBhcmFtcy5ub21lLFxyXG4gICAgICAgIHBhcmFtcy5jb2dub21lLFxyXG4gICAgICAgIHBhcmFtcy5lbWFpbCxcclxuICAgICAgICBwYXJhbXMuc2FsdGFDcmVkaXRDaGVjayxcclxuICAgICAgXSxcclxuICAgICAgcXVlcnlGbjogKCkgPT5cclxuICAgICAgICBjaGVja0QzNjUoe1xyXG4gICAgICAgICAgLi4ucGFyYW1zLFxyXG4gICAgICAgICAgaWRMZWFkLFxyXG4gICAgICAgICAgcGxpY29Db2RlLFxyXG4gICAgICAgICAgc2FsZXNQcm9jZXNzLFxyXG4gICAgICAgICAgc2FsZXNQcm9jZXNzRm9yTG9nLFxyXG4gICAgICAgIH0pLFxyXG4gICAgfTtcclxuICB9KTtcclxufTtcclxuIl0sImZpbGUiOiJDOi9Vc2Vycy9haW50cm9uYS9EZXNrdG9wL0FwcC9yZWFjdC9uYWovbGlicy9kYXRhLWFjY2Vzcy9zcmMvbGliL2FwaS93ZWJvcmRlci9jaGVja0QzNjUudHMifQ==