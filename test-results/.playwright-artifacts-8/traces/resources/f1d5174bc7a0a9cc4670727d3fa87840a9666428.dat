globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { atomAction, ServiceUnhandledResponseError, tryAsyncOrF } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { supplyAddressSelectedAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/account-selected-atoms.ts";
import { familyNameAtom, givenNameAtom, taxIdAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/profile-atoms.ts";
import { estimatedYearPowerConsumptionAtom, powerSupplySelectedAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/supply-selected-power.ts";
import { API, generateOperationID } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/index.ts";
import { normalizeAddress } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/egon/egonNormalize.ts";
import { suggestStreet } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/egon/suggestStreet.ts";
import { estimatedYearGasConsumptionAtom, gasSupplySelectedAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/supply-selected-gas.ts";
export async function ocrBollette(files, signal) {
  const form = new FormData();
  files.forEach((file) => {
    form.append("file", file);
  });
  const logHash = generateOperationID();
  const response = await fetch(`${API}/webOrderCommonServices/ocrBollette`, {
    method: "POST",
    headers: {
      Accept: "application/json",
      transactionId: logHash
    },
    body: form,
    signal
  });
  if (response.status !== 200) {
    throw new ServiceUnhandledResponseError(response.statusText, logHash);
  }
  const rawData = await response.json();
  if (rawData.errors?.length) {
    throw new ServiceUnhandledResponseError(rawData.errors[0], logHash);
  }
  const data = {
    ...rawData,
    annualPowerConsumption: rawData.annualPowerConsumption ? parseFloat(rawData.annualPowerConsumption) : void 0,
    annualGasConsumption: rawData.annualGasConsumption ? parseFloat(rawData.annualGasConsumption) : void 0
  };
  if (data.annualPowerConsumption != null && isNaN(data.annualPowerConsumption)) {
    data.annualPowerConsumption = void 0;
  }
  if (data.annualGasConsumption != null && isNaN(data.annualGasConsumption)) {
    data.annualGasConsumption = void 0;
  }
  if (data.address && data.civic && data.cap && data.city && data.province) {
    try {
      const query = `${data.address}, ${data.civic}, ${data.cap} ${data.city} ${data.province}`;
      const suggestions = await suggestStreet(query, signal);
      if (suggestions !== "SERVICE-ERROR" && suggestions[0]) {
        const suggestion = suggestions[0];
        data.normalizedAddress = await normalizeAddress(suggestion, signal);
      }
    } catch (error) {
      console.error("Error normalizing address from OCR:", error);
    }
  }
  return data;
}
export const ocrBollette$ = globalThis.jotaiAtomCache.get("C:\\Users\\aintrona\\Desktop\\App\\react\\naj\\libs\\data-access\\src\\lib\\api\\weborder\\ocr-bollette.ts/ocrBollette$", atomAction(async (get, set, files, signal) => {
  const warn = (error) => console.warn("OCR Bollette:", error);
  const response = await ocrBollette(files, signal);
  console.log("OCR Bollette response:", response);
  if (response.name) {
    await tryAsyncOrF(set(givenNameAtom, response.name), warn);
  }
  if (response.surname) {
    await tryAsyncOrF(set(familyNameAtom, response.surname), warn);
  }
  if (response.fiscalCode) {
    await tryAsyncOrF(set(taxIdAtom, response.fiscalCode), warn);
  }
  if (response.annualPowerConsumption != null) {
    await tryAsyncOrF(set(estimatedYearPowerConsumptionAtom, response.annualPowerConsumption), warn);
  }
  if (response.annualGasConsumption != null) {
    await tryAsyncOrF(set(estimatedYearGasConsumptionAtom, response.annualGasConsumption), warn);
  }
  if (response.normalizedAddress) {
    await tryAsyncOrF(set(supplyAddressSelectedAtom, response.normalizedAddress), warn);
  }
  if (response.podCode) {
    try {
      const powerSupply = await get(powerSupplySelectedAtom);
      await set(powerSupply.pod, response.podCode);
    } catch (e) {
      warn(e);
    }
  }
  if (response.pdrCode) {
    try {
      const gasSupply = await get(gasSupplySelectedAtom);
      await set(gasSupply.pdr, response.pdrCode);
    } catch (e) {
      warn(e);
    }
  }
}));
ocrBollette$.debugLabel = "ocrBollette$";

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLFNBQ0VBLFlBQ0FDLCtCQUNBQyxtQkFDSztBQUNQLFNBQVNDLGlDQUFpQztBQUMxQyxTQUNFQyxnQkFDQUMsZUFDQUMsaUJBQ0s7QUFDUCxTQUNFQyxtQ0FDQUMsK0JBQ0s7QUFDUCxTQUFTQyxLQUFLQywyQkFBMkI7QUFDekMsU0FBU0Msd0JBQXdCO0FBQ2pDLFNBQVNDLHFCQUFxQjtBQUU5QixTQUNFQyxpQ0FDQUMsNkJBQ0s7QUFRUCxzQkFBc0JDLFlBQVlDLE9BQWVDLFFBQXNCO0FBQ3JFLFFBQU1DLE9BQU8sSUFBSUMsU0FBUztBQUcxQkgsUUFBTUksUUFBU0MsVUFBUztBQUN0QkgsU0FBS0ksT0FBTyxRQUFRRCxJQUFJO0FBQUEsRUFDMUIsQ0FBQztBQUVELFFBQU1FLFVBQVViLG9CQUFvQjtBQUNwQyxRQUFNYyxXQUFXLE1BQU1DLE1BQU0sR0FBR2hCLEdBQUcsdUNBQXVDO0FBQUEsSUFDeEVpQixRQUFRO0FBQUEsSUFDUkMsU0FBUztBQUFBLE1BQ1BDLFFBQVE7QUFBQSxNQUNSQyxlQUFlTjtBQUFBQSxJQUNqQjtBQUFBLElBQ0FPLE1BQU1aO0FBQUFBLElBQ05EO0FBQUFBLEVBQ0YsQ0FBQztBQUVELE1BQUlPLFNBQVNPLFdBQVcsS0FBSztBQUMzQixVQUFNLElBQUk5Qiw4QkFBOEJ1QixTQUFTUSxZQUFZVCxPQUFPO0FBQUEsRUFDdEU7QUFFQSxRQUFNVSxVQUFVLE1BQU1ULFNBQVNVLEtBQUs7QUFFcEMsTUFBSUQsUUFBUUUsUUFBUUMsUUFBUTtBQUMxQixVQUFNLElBQUluQyw4QkFBOEJnQyxRQUFRRSxPQUFPLENBQUMsR0FBR1osT0FBTztBQUFBLEVBQ3BFO0FBR0EsUUFBTWMsT0FBNEI7QUFBQSxJQUNoQyxHQUFHSjtBQUFBQSxJQUNISyx3QkFBd0JMLFFBQVFLLHlCQUM1QkMsV0FBV04sUUFBUUssc0JBQXNCLElBQ3pDRTtBQUFBQSxJQUNKQyxzQkFBc0JSLFFBQVFRLHVCQUMxQkYsV0FBV04sUUFBUVEsb0JBQW9CLElBQ3ZDRDtBQUFBQSxFQUNOO0FBR0EsTUFDRUgsS0FBS0MsMEJBQTBCLFFBQy9CSSxNQUFNTCxLQUFLQyxzQkFBc0IsR0FDakM7QUFDQUQsU0FBS0MseUJBQXlCRTtBQUFBQSxFQUNoQztBQUVBLE1BQUlILEtBQUtJLHdCQUF3QixRQUFRQyxNQUFNTCxLQUFLSSxvQkFBb0IsR0FBRztBQUN6RUosU0FBS0ksdUJBQXVCRDtBQUFBQSxFQUM5QjtBQUdBLE1BQUlILEtBQUtNLFdBQVdOLEtBQUtPLFNBQVNQLEtBQUtRLE9BQU9SLEtBQUtTLFFBQVFULEtBQUtVLFVBQVU7QUFDeEUsUUFBSTtBQUVGLFlBQU1DLFFBQVEsR0FBR1gsS0FBS00sT0FBTyxLQUFLTixLQUFLTyxLQUFLLEtBQUtQLEtBQUtRLEdBQUcsSUFBSVIsS0FBS1MsSUFBSSxJQUFJVCxLQUFLVSxRQUFRO0FBR3ZGLFlBQU1FLGNBQWMsTUFBTXJDLGNBQWNvQyxPQUFPL0IsTUFBTTtBQUVyRCxVQUFJZ0MsZ0JBQWdCLG1CQUFtQkEsWUFBWSxDQUFDLEdBQUc7QUFFckQsY0FBTUMsYUFBYUQsWUFBWSxDQUFDO0FBR2hDWixhQUFLYyxvQkFBb0IsTUFBTXhDLGlCQUFpQnVDLFlBQVlqQyxNQUFNO0FBQUEsTUFDcEU7QUFBQSxJQUNGLFNBQVNtQyxPQUFPO0FBQ2RDLGNBQVFELE1BQU0sdUNBQXVDQSxLQUFLO0FBQUEsSUFFNUQ7QUFBQSxFQUNGO0FBRUEsU0FBT2Y7QUFDVDtBQTZCQSxhQUFBaUIsZUFBQUMsV0FBQUMsZUFBQUMsSUFBQSwySEFBNEJ6RCxXQUMxQixPQUFPeUQsS0FBS0MsS0FBSzFDLE9BQWVDLFdBQXlCO0FBQ3ZELFFBQU0wQyxPQUFPQSxDQUFDUCxVQUFlQyxRQUFRTSxLQUFLLGlCQUFpQlAsS0FBSztBQUVoRSxRQUFNNUIsV0FBVyxNQUFNVCxZQUFZQyxPQUFPQyxNQUFNO0FBQ2hEb0MsVUFBUU8sSUFBSSwwQkFBMEJwQyxRQUFRO0FBRTlDLE1BQUlBLFNBQVNxQyxNQUFNO0FBQ2pCLFVBQU0zRCxZQUFZd0QsSUFBSXJELGVBQWVtQixTQUFTcUMsSUFBSSxHQUFHRixJQUFJO0FBQUEsRUFDM0Q7QUFDQSxNQUFJbkMsU0FBU3NDLFNBQVM7QUFDcEIsVUFBTTVELFlBQVl3RCxJQUFJdEQsZ0JBQWdCb0IsU0FBU3NDLE9BQU8sR0FBR0gsSUFBSTtBQUFBLEVBQy9EO0FBQ0EsTUFBSW5DLFNBQVN1QyxZQUFZO0FBQ3ZCLFVBQU03RCxZQUFZd0QsSUFBSXBELFdBQVdrQixTQUFTdUMsVUFBVSxHQUFHSixJQUFJO0FBQUEsRUFDN0Q7QUFHQSxNQUFJbkMsU0FBU2MsMEJBQTBCLE1BQU07QUFDM0MsVUFBTXBDLFlBQ0p3RCxJQUFJbkQsbUNBQW1DaUIsU0FBU2Msc0JBQXNCLEdBQ3RFcUIsSUFDRjtBQUFBLEVBQ0Y7QUFDQSxNQUFJbkMsU0FBU2lCLHdCQUF3QixNQUFNO0FBQ3pDLFVBQU12QyxZQUNKd0QsSUFBSTdDLGlDQUFpQ1csU0FBU2lCLG9CQUFvQixHQUNsRWtCLElBQ0Y7QUFBQSxFQUNGO0FBR0EsTUFBSW5DLFNBQVMyQixtQkFBbUI7QUFDOUIsVUFBTWpELFlBQ0p3RCxJQUFJdkQsMkJBQTJCcUIsU0FBUzJCLGlCQUFpQixHQUN6RFEsSUFDRjtBQUFBLEVBQ0Y7QUFFQSxNQUFJbkMsU0FBU3dDLFNBQVM7QUFDcEIsUUFBSTtBQUVGLFlBQU1DLGNBQWUsTUFBTVIsSUFBSWpELHVCQUF1QjtBQUN0RCxZQUFNa0QsSUFBSU8sWUFBWUMsS0FBSzFDLFNBQVN3QyxPQUFPO0FBQUEsSUFDN0MsU0FBU0csR0FBRztBQUNWUixXQUFLUSxDQUFDO0FBQUEsSUFDUjtBQUFBLEVBQ0Y7QUFFQSxNQUFJM0MsU0FBUzRDLFNBQVM7QUFDcEIsUUFBSTtBQUVGLFlBQU1DLFlBQWEsTUFBTVosSUFBSTNDLHFCQUFxQjtBQUNsRCxZQUFNNEMsSUFBSVcsVUFBVUMsS0FBSzlDLFNBQVM0QyxPQUFPO0FBQUEsSUFDM0MsU0FBU0QsR0FBRztBQUNWUixXQUFLUSxDQUFDO0FBQUEsSUFDUjtBQUFBLEVBQ0Y7QUFDRixDQUNGLENBQUM7QUFBQ2IsYUFBQWlCLGFBQUEiLCJuYW1lcyI6WyJhdG9tQWN0aW9uIiwiU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IiLCJ0cnlBc3luY09yRiIsInN1cHBseUFkZHJlc3NTZWxlY3RlZEF0b20iLCJmYW1pbHlOYW1lQXRvbSIsImdpdmVuTmFtZUF0b20iLCJ0YXhJZEF0b20iLCJlc3RpbWF0ZWRZZWFyUG93ZXJDb25zdW1wdGlvbkF0b20iLCJwb3dlclN1cHBseVNlbGVjdGVkQXRvbSIsIkFQSSIsImdlbmVyYXRlT3BlcmF0aW9uSUQiLCJub3JtYWxpemVBZGRyZXNzIiwic3VnZ2VzdFN0cmVldCIsImVzdGltYXRlZFllYXJHYXNDb25zdW1wdGlvbkF0b20iLCJnYXNTdXBwbHlTZWxlY3RlZEF0b20iLCJvY3JCb2xsZXR0ZSIsImZpbGVzIiwic2lnbmFsIiwiZm9ybSIsIkZvcm1EYXRhIiwiZm9yRWFjaCIsImZpbGUiLCJhcHBlbmQiLCJsb2dIYXNoIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBY2NlcHQiLCJ0cmFuc2FjdGlvbklkIiwiYm9keSIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJyYXdEYXRhIiwianNvbiIsImVycm9ycyIsImxlbmd0aCIsImRhdGEiLCJhbm51YWxQb3dlckNvbnN1bXB0aW9uIiwicGFyc2VGbG9hdCIsInVuZGVmaW5lZCIsImFubnVhbEdhc0NvbnN1bXB0aW9uIiwiaXNOYU4iLCJhZGRyZXNzIiwiY2l2aWMiLCJjYXAiLCJjaXR5IiwicHJvdmluY2UiLCJxdWVyeSIsInN1Z2dlc3Rpb25zIiwic3VnZ2VzdGlvbiIsIm5vcm1hbGl6ZWRBZGRyZXNzIiwiZXJyb3IiLCJjb25zb2xlIiwib2NyQm9sbGV0dGUkIiwiZ2xvYmFsVGhpcyIsImpvdGFpQXRvbUNhY2hlIiwiZ2V0Iiwic2V0Iiwid2FybiIsImxvZyIsIm5hbWUiLCJzdXJuYW1lIiwiZmlzY2FsQ29kZSIsInBvZENvZGUiLCJwb3dlclN1cHBseSIsInBvZCIsImUiLCJwZHJDb2RlIiwiZ2FzU3VwcGx5IiwicGRyIiwiZGVidWdMYWJlbCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlcyI6WyJvY3ItYm9sbGV0dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBhdG9tQWN0aW9uLFxyXG4gIFNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yLFxyXG4gIHRyeUFzeW5jT3JGLFxyXG59IGZyb20gJ0BuYWotd28vdXRpbCc7XHJcbmltcG9ydCB7IHN1cHBseUFkZHJlc3NTZWxlY3RlZEF0b20gfSBmcm9tICcuLi8uLi9hdG9tcy9hY2NvdW50LXNlbGVjdGVkLWF0b21zJztcclxuaW1wb3J0IHtcclxuICBmYW1pbHlOYW1lQXRvbSxcclxuICBnaXZlbk5hbWVBdG9tLFxyXG4gIHRheElkQXRvbSxcclxufSBmcm9tICcuLi8uLi9hdG9tcy9wcm9maWxlLWF0b21zJztcclxuaW1wb3J0IHtcclxuICBlc3RpbWF0ZWRZZWFyUG93ZXJDb25zdW1wdGlvbkF0b20sXHJcbiAgcG93ZXJTdXBwbHlTZWxlY3RlZEF0b20sXHJcbn0gZnJvbSAnLi4vLi4vYXRvbXMvc3VwcGx5LXNlbGVjdGVkLXBvd2VyJztcclxuaW1wb3J0IHsgQVBJLCBnZW5lcmF0ZU9wZXJhdGlvbklEIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xyXG5pbXBvcnQgeyBub3JtYWxpemVBZGRyZXNzIH0gZnJvbSAnLi4vZWdvbi9lZ29uTm9ybWFsaXplJztcclxuaW1wb3J0IHsgc3VnZ2VzdFN0cmVldCB9IGZyb20gJy4uL2Vnb24vc3VnZ2VzdFN0cmVldCc7XHJcbmltcG9ydCB7IEVnb25BZGRyZXNzIH0gZnJvbSAnLi4vZWdvbi90eXBlcyc7XHJcbmltcG9ydCB7XHJcbiAgZXN0aW1hdGVkWWVhckdhc0NvbnN1bXB0aW9uQXRvbSxcclxuICBnYXNTdXBwbHlTZWxlY3RlZEF0b20sXHJcbn0gZnJvbSAnLi4vLi4vYXRvbXMvc3VwcGx5LXNlbGVjdGVkLWdhcyc7XHJcblxyXG4vKipcclxuICogRnVuY3Rpb24gdG8gdXBsb2FkIHV0aWxpdHkgYmlsbHMgZm9yIE9DUiBwcm9jZXNzaW5nXHJcbiAqIEBwYXJhbSBmaWxlcyBBcnJheSBvZiBmaWxlcyB0byBiZSBwcm9jZXNzZWRcclxuICogQHBhcmFtIHNpZ25hbCBPcHRpb25hbCBBYm9ydFNpZ25hbCB0byBjYW5jZWwgdGhlIHJlcXVlc3RcclxuICogQHJldHVybnMgVGhlIE9DUiBwcm9jZXNzaW5nIHJlc3VsdCB3aXRoIG5vcm1hbGl6ZWQgYWRkcmVzc1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG9jckJvbGxldHRlKGZpbGVzOiBGaWxlW10sIHNpZ25hbD86IEFib3J0U2lnbmFsKSB7XHJcbiAgY29uc3QgZm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xyXG5cclxuICAvLyBBcHBlbmQgZWFjaCBmaWxlIHRvIHRoZSBGb3JtRGF0YVxyXG4gIGZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcclxuICAgIGZvcm0uYXBwZW5kKCdmaWxlJywgZmlsZSk7XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGxvZ0hhc2ggPSBnZW5lcmF0ZU9wZXJhdGlvbklEKCk7XHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUEl9L3dlYk9yZGVyQ29tbW9uU2VydmljZXMvb2NyQm9sbGV0dGVgLCB7XHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgIHRyYW5zYWN0aW9uSWQ6IGxvZ0hhc2gsXHJcbiAgICB9LFxyXG4gICAgYm9keTogZm9ybSxcclxuICAgIHNpZ25hbDogc2lnbmFsLFxyXG4gIH0pO1xyXG5cclxuICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgIHRocm93IG5ldyBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0LCBsb2dIYXNoKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHJhd0RhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gIGlmIChyYXdEYXRhLmVycm9ycz8ubGVuZ3RoKSB7XHJcbiAgICB0aHJvdyBuZXcgU2VydmljZVVuaGFuZGxlZFJlc3BvbnNlRXJyb3IocmF3RGF0YS5lcnJvcnNbMF0sIGxvZ0hhc2gpO1xyXG4gIH1cclxuXHJcbiAgLy8gQ29udmVydCBzdHJpbmcgY29uc3VtcHRpb24gdmFsdWVzIHRvIG51bWJlcnNcclxuICBjb25zdCBkYXRhOiBPY3JCb2xsZXR0ZVJlc3BvbnNlID0ge1xyXG4gICAgLi4ucmF3RGF0YSxcclxuICAgIGFubnVhbFBvd2VyQ29uc3VtcHRpb246IHJhd0RhdGEuYW5udWFsUG93ZXJDb25zdW1wdGlvblxyXG4gICAgICA/IHBhcnNlRmxvYXQocmF3RGF0YS5hbm51YWxQb3dlckNvbnN1bXB0aW9uKVxyXG4gICAgICA6IHVuZGVmaW5lZCxcclxuICAgIGFubnVhbEdhc0NvbnN1bXB0aW9uOiByYXdEYXRhLmFubnVhbEdhc0NvbnN1bXB0aW9uXHJcbiAgICAgID8gcGFyc2VGbG9hdChyYXdEYXRhLmFubnVhbEdhc0NvbnN1bXB0aW9uKVxyXG4gICAgICA6IHVuZGVmaW5lZCxcclxuICB9O1xyXG5cclxuICAvLyBGaWx0ZXIgb3V0IE5hTiB2YWx1ZXNcclxuICBpZiAoXHJcbiAgICBkYXRhLmFubnVhbFBvd2VyQ29uc3VtcHRpb24gIT0gbnVsbCAmJlxyXG4gICAgaXNOYU4oZGF0YS5hbm51YWxQb3dlckNvbnN1bXB0aW9uKVxyXG4gICkge1xyXG4gICAgZGF0YS5hbm51YWxQb3dlckNvbnN1bXB0aW9uID0gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgaWYgKGRhdGEuYW5udWFsR2FzQ29uc3VtcHRpb24gIT0gbnVsbCAmJiBpc05hTihkYXRhLmFubnVhbEdhc0NvbnN1bXB0aW9uKSkge1xyXG4gICAgZGF0YS5hbm51YWxHYXNDb25zdW1wdGlvbiA9IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIC8vIE5vcm1hbGl6ZSBhZGRyZXNzIGlmIGFsbCByZXF1aXJlZCBmaWVsZHMgYXJlIHByZXNlbnRcclxuICBpZiAoZGF0YS5hZGRyZXNzICYmIGRhdGEuY2l2aWMgJiYgZGF0YS5jYXAgJiYgZGF0YS5jaXR5ICYmIGRhdGEucHJvdmluY2UpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENyZWF0ZSBhIHF1ZXJ5IHN0cmluZyBmb3Igc3VnZ2VzdFN0cmVldFxyXG4gICAgICBjb25zdCBxdWVyeSA9IGAke2RhdGEuYWRkcmVzc30sICR7ZGF0YS5jaXZpY30sICR7ZGF0YS5jYXB9ICR7ZGF0YS5jaXR5fSAke2RhdGEucHJvdmluY2V9YDtcclxuXHJcbiAgICAgIC8vIEdldCBzdWdnZXN0aW9uc1xyXG4gICAgICBjb25zdCBzdWdnZXN0aW9ucyA9IGF3YWl0IHN1Z2dlc3RTdHJlZXQocXVlcnksIHNpZ25hbCk7XHJcblxyXG4gICAgICBpZiAoc3VnZ2VzdGlvbnMgIT09ICdTRVJWSUNFLUVSUk9SJyAmJiBzdWdnZXN0aW9uc1swXSkge1xyXG4gICAgICAgIC8vIFVzZSB0aGUgZmlyc3Qgc3VnZ2VzdGlvblxyXG4gICAgICAgIGNvbnN0IHN1Z2dlc3Rpb24gPSBzdWdnZXN0aW9uc1swXTtcclxuXHJcbiAgICAgICAgLy8gTm9ybWFsaXplIHRoZSBhZGRyZXNzXHJcbiAgICAgICAgZGF0YS5ub3JtYWxpemVkQWRkcmVzcyA9IGF3YWl0IG5vcm1hbGl6ZUFkZHJlc3Moc3VnZ2VzdGlvbiwgc2lnbmFsKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igbm9ybWFsaXppbmcgYWRkcmVzcyBmcm9tIE9DUjonLCBlcnJvcik7XHJcbiAgICAgIC8vIERvbid0IHRocm93IHRoZSBlcnJvciwganVzdCBjb250aW51ZSB3aXRob3V0IG5vcm1hbGl6ZWQgYWRkcmVzc1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRhdGE7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUeXBlIGRlZmluaXRpb24gZm9yIHRoZSBPQ1IgQm9sbGV0dGUgcmVzcG9uc2VcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgT2NyQm9sbGV0dGVSZXNwb25zZSB7XHJcbiAgbmFtZT86IHN0cmluZztcclxuICBzdXJuYW1lPzogc3RyaW5nO1xyXG4gIGZpc2NhbENvZGU/OiBzdHJpbmc7XHJcbiAgYW5udWFsUG93ZXJDb25zdW1wdGlvbj86IG51bWJlcjtcclxuICBhbm51YWxHYXNDb25zdW1wdGlvbj86IG51bWJlcjtcclxuICBhZGRyZXNzPzogc3RyaW5nO1xyXG4gIGNpdmljPzogc3RyaW5nO1xyXG4gIGNhcD86IHN0cmluZztcclxuICBjaXR5Pzogc3RyaW5nO1xyXG4gIHByb3ZpbmNlPzogc3RyaW5nO1xyXG4gIHBkckNvZGU/OiBzdHJpbmc7XHJcbiAgcG9kQ29kZT86IHN0cmluZztcclxuICBlcnJvcnM6IHN0cmluZ1tdO1xyXG4gIG5vcm1hbGl6ZWRBZGRyZXNzPzogRWdvbkFkZHJlc3M7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBdG9tIGFjdGlvbiBmb3IgT0NSIHByb2Nlc3Npbmcgb2YgdXRpbGl0eSBiaWxscy5cclxuICogQ2FsbCB0aGUgT0NSIHNlcnZpY2UgYW5kIHNldCByZWxldmFudCBhdG9tcy5cclxuICogVGhpcyBwcm92aWRlcyBhIGNvbnZlbmllbnQgd2F5IHRvIGNhbGwgdGhlIG9jckJvbGxldHRlIGZ1bmN0aW9uIGZyb20gUmVhY3QgY29tcG9uZW50cy5cclxuICogQHBhcmFtIGZpbGVzIEFycmF5IG9mIGZpbGVzIHRvIGJlIHByb2Nlc3NlZFxyXG4gKiBAcGFyYW0gc2lnbmFsIE9wdGlvbmFsIEFib3J0U2lnbmFsIHRvIGNhbmNlbCB0aGUgcmVxdWVzdFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IG9jckJvbGxldHRlJCA9IGF0b21BY3Rpb24oXHJcbiAgYXN5bmMgKGdldCwgc2V0LCBmaWxlczogRmlsZVtdLCBzaWduYWw/OiBBYm9ydFNpZ25hbCkgPT4ge1xyXG4gICAgY29uc3Qgd2FybiA9IChlcnJvcjogYW55KSA9PiBjb25zb2xlLndhcm4oJ09DUiBCb2xsZXR0ZTonLCBlcnJvcik7XHJcblxyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBvY3JCb2xsZXR0ZShmaWxlcywgc2lnbmFsKTtcclxuICAgIGNvbnNvbGUubG9nKCdPQ1IgQm9sbGV0dGUgcmVzcG9uc2U6JywgcmVzcG9uc2UpO1xyXG5cclxuICAgIGlmIChyZXNwb25zZS5uYW1lKSB7XHJcbiAgICAgIGF3YWl0IHRyeUFzeW5jT3JGKHNldChnaXZlbk5hbWVBdG9tLCByZXNwb25zZS5uYW1lKSwgd2Fybik7XHJcbiAgICB9XHJcbiAgICBpZiAocmVzcG9uc2Uuc3VybmFtZSkge1xyXG4gICAgICBhd2FpdCB0cnlBc3luY09yRihzZXQoZmFtaWx5TmFtZUF0b20sIHJlc3BvbnNlLnN1cm5hbWUpLCB3YXJuKTtcclxuICAgIH1cclxuICAgIGlmIChyZXNwb25zZS5maXNjYWxDb2RlKSB7XHJcbiAgICAgIGF3YWl0IHRyeUFzeW5jT3JGKHNldCh0YXhJZEF0b20sIHJlc3BvbnNlLmZpc2NhbENvZGUpLCB3YXJuKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgY29uc3VtcHRpb25cclxuICAgIGlmIChyZXNwb25zZS5hbm51YWxQb3dlckNvbnN1bXB0aW9uICE9IG51bGwpIHtcclxuICAgICAgYXdhaXQgdHJ5QXN5bmNPckYoXHJcbiAgICAgICAgc2V0KGVzdGltYXRlZFllYXJQb3dlckNvbnN1bXB0aW9uQXRvbSwgcmVzcG9uc2UuYW5udWFsUG93ZXJDb25zdW1wdGlvbiksXHJcbiAgICAgICAgd2FyblxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgaWYgKHJlc3BvbnNlLmFubnVhbEdhc0NvbnN1bXB0aW9uICE9IG51bGwpIHtcclxuICAgICAgYXdhaXQgdHJ5QXN5bmNPckYoXHJcbiAgICAgICAgc2V0KGVzdGltYXRlZFllYXJHYXNDb25zdW1wdGlvbkF0b20sIHJlc3BvbnNlLmFubnVhbEdhc0NvbnN1bXB0aW9uKSxcclxuICAgICAgICB3YXJuXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0IHRoZSBzdXBwbHkgYWRkcmVzc1xyXG4gICAgaWYgKHJlc3BvbnNlLm5vcm1hbGl6ZWRBZGRyZXNzKSB7XHJcbiAgICAgIGF3YWl0IHRyeUFzeW5jT3JGKFxyXG4gICAgICAgIHNldChzdXBwbHlBZGRyZXNzU2VsZWN0ZWRBdG9tLCByZXNwb25zZS5ub3JtYWxpemVkQWRkcmVzcyksXHJcbiAgICAgICAgd2FyblxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXNwb25zZS5wb2RDb2RlKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cclxuICAgICAgICBjb25zdCBwb3dlclN1cHBseSA9IChhd2FpdCBnZXQocG93ZXJTdXBwbHlTZWxlY3RlZEF0b20pKSE7XHJcbiAgICAgICAgYXdhaXQgc2V0KHBvd2VyU3VwcGx5LnBvZCwgcmVzcG9uc2UucG9kQ29kZSk7XHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICB3YXJuKGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlc3BvbnNlLnBkckNvZGUpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxyXG4gICAgICAgIGNvbnN0IGdhc1N1cHBseSA9IChhd2FpdCBnZXQoZ2FzU3VwcGx5U2VsZWN0ZWRBdG9tKSkhO1xyXG4gICAgICAgIGF3YWl0IHNldChnYXNTdXBwbHkucGRyLCByZXNwb25zZS5wZHJDb2RlKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHdhcm4oZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbik7XHJcbiJdLCJmaWxlIjoiQzovVXNlcnMvYWludHJvbmEvRGVza3RvcC9BcHAvcmVhY3QvbmFqL2xpYnMvZGF0YS1hY2Nlc3Mvc3JjL2xpYi9hcGkvd2Vib3JkZXIvb2NyLWJvbGxldHRlLnRzIn0=