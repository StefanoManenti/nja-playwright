globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { CheckIbanNonRiuscitoError, IbanNotValidError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/errors/index.ts";
import { ServiceUnhandledResponseError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { currentContractInfoAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/current-contract-info-atoms.ts";
import { API, atomWithRetryableQuery, generateOperationID } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/index.ts";
import { areCheckBypassed } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/utils/flags.ts";
import { addressAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/profile-atoms.ts";
async function checkIban(payload) {
  if (areCheckBypassed()) {
    return {
      stato: "CHECK_RIUSCITO",
      ibanSeda: true
    };
  }
  const otherFields = {};
  if (payload.tipoSoggetto !== "PG") {
    otherFields.siglaProvincia = "XX";
  }
  const logHash = generateOperationID();
  const response = await fetch(`${API}/webOrderCommonServices/ibanCheck`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Accept: "application/json"
    },
    body: JSON.stringify({
      iban: payload.iban,
      codiceProposta: payload.plicoCode,
      subjectType: payload.tipoSoggetto,
      vatRegistrationNo: payload.tipoSoggetto === "PF" ? payload.codiceFiscaleIntestatario : payload.piva,
      provinceCode: payload.tipoSoggetto === "PF" ? null : payload.siglaProvincia,
      operationId: logHash,
      logHash,
      idLead: payload.idLead,
      plicoCode: payload.plicoCode,
      salesProcess: payload.salesProcess
    })
  });
  if (response.status !== 200) {
    throw new ServiceUnhandledResponseError(response.statusText, logHash, response);
  }
  const data = await response.json();
  switch (data.result) {
    case "CHECK_RIUSCITO":
    case "CHECK_PARZIALE":
      return {
        stato: data.statoCheckIban,
        ibanSeda: data.ibanSeda
      };
    case "CHECK_NON_RIUSCITO":
      throw new CheckIbanNonRiuscitoError(data.errorMessage, logHash, response);
    default:
      throw new IbanNotValidError(data.statoCheckIban, logHash, response);
  }
}
export const atomWithCheckIban = (tool) => {
  return atomWithRetryableQuery(async (get) => {
    const contract = get(currentContractInfoAtom);
    const idLead = contract.idLead;
    const plicoCode = await contract.plicoCode;
    const salesProcess = await contract.salesProcess;
    const ibanPayload = getIbanPayload(tool);
    if (ibanPayload.tipoSoggetto === "PG") {
      const a = await get(addressAtom);
      ibanPayload.siglaProvincia = a?.province || "";
    }
    return {
      queryKey: ["checkIban", ibanPayload],
      queryFn: () => checkIban({
        idLead,
        plicoCode,
        salesProcess,
        operazione: salesProcess,
        ...ibanPayload
      })
    };
  });
};
function getIbanPayload(tool) {
  const iban = tool.iban;
  if (tool.intestatario.type === "legal") {
    const payload2 = {
      iban,
      tipoSoggetto: "PG",
      piva: tool.intestatario.vatNumber,
      siglaProvincia: ""
    };
    return payload2;
  }
  const payload = {
    iban,
    tipoSoggetto: "PF",
    codiceFiscaleIntestatario: tool.intestatario.taxId
  };
  return payload;
}

//# sourceMappingURL=data:application/json;base64,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SixNQUFtQjtBQUN6QyxRQUFNbkIsT0FBT21CLEtBQUtuQjtBQUVsQixNQUFJbUIsS0FBS1UsYUFBYUMsU0FBUyxTQUFTO0FBQ3RDLFVBQU03QyxXQUE0QjtBQUFBLE1BQ2hDZTtBQUFBQSxNQUNBWCxjQUFjO0FBQUEsTUFDZGlCLE1BQU1hLEtBQUtVLGFBQWFFO0FBQUFBLE1BQ3hCekMsZ0JBQWdCO0FBQUEsSUFDbEI7QUFDQSxXQUFPTDtBQUFBQSxFQUNUO0FBRUEsUUFBTUEsVUFBNEI7QUFBQSxJQUNoQ2U7QUFBQUEsSUFDQVgsY0FBYztBQUFBLElBQ2RnQiwyQkFBMkJjLEtBQUtVLGFBQWFHO0FBQUFBLEVBQy9DO0FBQ0EsU0FBTy9DO0FBQ1QiLCJuYW1lcyI6WyJDaGVja0liYW5Ob25SaXVzY2l0b0Vycm9yIiwiSWJhbk5vdFZhbGlkRXJyb3IiLCJTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvciIsImN1cnJlbnRDb250cmFjdEluZm9BdG9tIiwiQVBJIiwiYXRvbVdpdGhSZXRyeWFibGVRdWVyeSIsImdlbmVyYXRlT3BlcmF0aW9uSUQiLCJhcmVDaGVja0J5cGFzc2VkIiwiYWRkcmVzc0F0b20iLCJjaGVja0liYW4iLCJwYXlsb2FkIiwic3RhdG8iLCJpYmFuU2VkYSIsIm90aGVyRmllbGRzIiwidGlwb1NvZ2dldHRvIiwic2lnbGFQcm92aW5jaWEiLCJsb2dIYXNoIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBY2NlcHQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImliYW4iLCJjb2RpY2VQcm9wb3N0YSIsInBsaWNvQ29kZSIsInN1YmplY3RUeXBlIiwidmF0UmVnaXN0cmF0aW9uTm8iLCJjb2RpY2VGaXNjYWxlSW50ZXN0YXRhcmlvIiwicGl2YSIsInByb3ZpbmNlQ29kZSIsIm9wZXJhdGlvbklkIiwiaWRMZWFkIiwic2FsZXNQcm9jZXNzIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsImRhdGEiLCJqc29uIiwicmVzdWx0Iiwic3RhdG9DaGVja0liYW4iLCJlcnJvck1lc3NhZ2UiLCJhdG9tV2l0aENoZWNrSWJhbiIsInRvb2wiLCJnZXQiLCJjb250cmFjdCIsImliYW5QYXlsb2FkIiwiZ2V0SWJhblBheWxvYWQiLCJhIiwicHJvdmluY2UiLCJxdWVyeUtleSIsInF1ZXJ5Rm4iLCJvcGVyYXppb25lIiwiaW50ZXN0YXRhcmlvIiwidHlwZSIsInZhdE51bWJlciIsInRheElkIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbImNoZWNrSWJhbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGVja0liYW5Ob25SaXVzY2l0b0Vycm9yLCBJYmFuTm90VmFsaWRFcnJvciB9IGZyb20gJy4uLy4uL2Vycm9ycyc7XHJcbmltcG9ydCB7IFNlcnZpY2VVbmhhbmRsZWRSZXNwb25zZUVycm9yIH0gZnJvbSAnQG5hai13by91dGlsJztcclxuaW1wb3J0IHsgY3VycmVudENvbnRyYWN0SW5mb0F0b20gfSBmcm9tICcuLi8uLi9hdG9tcy9jdXJyZW50LWNvbnRyYWN0LWluZm8tYXRvbXMnO1xyXG5pbXBvcnQgdHlwZSB7IFBheW1lbnRUb29sIH0gZnJvbSAnLi4vLi4vYXRvbXMvdHlwZXMnO1xyXG5pbXBvcnQgeyBBUEksIGF0b21XaXRoUmV0cnlhYmxlUXVlcnksIGdlbmVyYXRlT3BlcmF0aW9uSUQgfSBmcm9tICcuLi8uLi91dGlscyc7XHJcbmltcG9ydCB7IGFyZUNoZWNrQnlwYXNzZWQgfSBmcm9tICcuLi8uLi91dGlscy9mbGFncyc7XHJcbmltcG9ydCB7IGFkZHJlc3NBdG9tIH0gZnJvbSAnLi4vLi4vYXRvbXMvcHJvZmlsZS1hdG9tcyc7XHJcblxyXG5pbnRlcmZhY2UgV1NJbnB1dEJhc2Uge1xyXG4gIGliYW46IHN0cmluZztcclxuICBvcGVyYXppb25lPzogJ0NBTUJJT19QUk9ET1RUTycgfCBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ2hlY2tJYmFuSW5wdXRQRiBleHRlbmRzIFdTSW5wdXRCYXNlIHtcclxuICAvKipcclxuICAgKiBQRjogcGVyc29uYSBmaXNpY2FcclxuICAgKiBQRzogcGVyc29uYSBnaXVyaWRpY2FcclxuICAgKi9cclxuICB0aXBvU29nZ2V0dG86ICdQRic7XHJcblxyXG4gIC8qKlxyXG4gICAqIGlsIGNvZGljZSBmaXNjYWxlIGRlbGwnaW50ZXN0YXRhcmlvIGRlbCBjb250b1xyXG4gICAqL1xyXG4gIGNvZGljZUZpc2NhbGVJbnRlc3RhdGFyaW86IHN0cmluZztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDaGVja0liYW5JbnB1dFBHIGV4dGVuZHMgV1NJbnB1dEJhc2Uge1xyXG4gIC8qKlxyXG4gICAqIFBGOiBwZXJzb25hIGZpc2ljYVxyXG4gICAqIFBHOiBwZXJzb25hIGdpdXJpZGljYVxyXG4gICAqL1xyXG4gIHRpcG9Tb2dnZXR0bzogJ1BHJztcclxuXHJcbiAgLyoqXHJcbiAgICogbGEgcGFydGl0YSBpdmEgZGVsbCdpbnRlc3RhdGFyaW8gZGVsIGNvbnRvXHJcbiAgICovXHJcbiAgcGl2YTogc3RyaW5nO1xyXG5cclxuICAvKipcclxuICAgKiBpbCBjb2RpY2UgcHJvdmluY2lhIGRlbGxhIHNlZGUgbGVnYWxlXHJcbiAgICogQGV4YW1wbGUgKE1JKVxyXG4gICAqL1xyXG4gIHNpZ2xhUHJvdmluY2lhOiBzdHJpbmc7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIENoZWNrSWJhbklucHV0ID0gQ2hlY2tJYmFuSW5wdXRQRiB8IENoZWNrSWJhbklucHV0UEc7XHJcbnR5cGUgQ2hlY2tJYmFuU3RhdG8gPVxyXG4gIHwgJ0NIRUNLX05PTl9SSVVTQ0lUTydcclxuICB8ICdDSEVDS19QQVJaSUFMRSdcclxuICB8ICdDSEVDS19SSVVTQ0lUTyc7XHJcbmV4cG9ydCB0eXBlIENoZWNrSWJhblZhbHVlID0geyBzdGF0bzogQ2hlY2tJYmFuU3RhdG87IGliYW5TZWRhPzogYm9vbGVhbiB9O1xyXG5cclxuYXN5bmMgZnVuY3Rpb24gY2hlY2tJYmFuKFxyXG4gIHBheWxvYWQ6IENoZWNrSWJhbklucHV0ICYge1xyXG4gICAgaWRMZWFkOiBzdHJpbmc7XHJcbiAgICBwbGljb0NvZGU6IHN0cmluZztcclxuICAgIHNhbGVzUHJvY2Vzczogc3RyaW5nO1xyXG4gIH1cclxuKSB7XHJcbiAgaWYgKGFyZUNoZWNrQnlwYXNzZWQoKSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3RhdG86ICdDSEVDS19SSVVTQ0lUTycsXHJcbiAgICAgIGliYW5TZWRhOiB0cnVlLFxyXG4gICAgfSBhcyBDaGVja0liYW5WYWx1ZTtcclxuICB9XHJcblxyXG4gIGNvbnN0IG90aGVyRmllbGRzOiB7IHNpZ2xhUHJvdmluY2lhPzogc3RyaW5nIH0gPSB7fTtcclxuICBpZiAocGF5bG9hZC50aXBvU29nZ2V0dG8gIT09ICdQRycpIHtcclxuICAgIG90aGVyRmllbGRzLnNpZ2xhUHJvdmluY2lhID0gJ1hYJztcclxuICB9XHJcblxyXG4gIGNvbnN0IGxvZ0hhc2ggPSBnZW5lcmF0ZU9wZXJhdGlvbklEKCk7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJfS93ZWJPcmRlckNvbW1vblNlcnZpY2VzL2liYW5DaGVja2AsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGliYW46IHBheWxvYWQuaWJhbixcclxuICAgICAgY29kaWNlUHJvcG9zdGE6IHBheWxvYWQucGxpY29Db2RlLFxyXG4gICAgICBzdWJqZWN0VHlwZTogcGF5bG9hZC50aXBvU29nZ2V0dG8sXHJcbiAgICAgIHZhdFJlZ2lzdHJhdGlvbk5vOlxyXG4gICAgICAgIHBheWxvYWQudGlwb1NvZ2dldHRvID09PSAnUEYnXHJcbiAgICAgICAgICA/IHBheWxvYWQuY29kaWNlRmlzY2FsZUludGVzdGF0YXJpb1xyXG4gICAgICAgICAgOiBwYXlsb2FkLnBpdmEsXHJcbiAgICAgIHByb3ZpbmNlQ29kZTpcclxuICAgICAgICBwYXlsb2FkLnRpcG9Tb2dnZXR0byA9PT0gJ1BGJyA/IG51bGwgOiBwYXlsb2FkLnNpZ2xhUHJvdmluY2lhLFxyXG4gICAgICBvcGVyYXRpb25JZDogbG9nSGFzaCxcclxuICAgICAgbG9nSGFzaDogbG9nSGFzaCxcclxuICAgICAgaWRMZWFkOiBwYXlsb2FkLmlkTGVhZCxcclxuICAgICAgcGxpY29Db2RlOiBwYXlsb2FkLnBsaWNvQ29kZSxcclxuICAgICAgc2FsZXNQcm9jZXNzOiBwYXlsb2FkLnNhbGVzUHJvY2VzcyxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgIHRocm93IG5ldyBTZXJ2aWNlVW5oYW5kbGVkUmVzcG9uc2VFcnJvcihcclxuICAgICAgcmVzcG9uc2Uuc3RhdHVzVGV4dCxcclxuICAgICAgbG9nSGFzaCxcclxuICAgICAgcmVzcG9uc2VcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG5cclxuICBzd2l0Y2ggKGRhdGEucmVzdWx0KSB7XHJcbiAgICBjYXNlICdDSEVDS19SSVVTQ0lUTyc6XHJcbiAgICBjYXNlICdDSEVDS19QQVJaSUFMRSc6XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3RhdG86IGRhdGEuc3RhdG9DaGVja0liYW4sXHJcbiAgICAgICAgaWJhblNlZGE6IGRhdGEuaWJhblNlZGEsXHJcbiAgICAgIH0gYXMgQ2hlY2tJYmFuVmFsdWU7XHJcbiAgICBjYXNlICdDSEVDS19OT05fUklVU0NJVE8nOlxyXG4gICAgICB0aHJvdyBuZXcgQ2hlY2tJYmFuTm9uUml1c2NpdG9FcnJvcihkYXRhLmVycm9yTWVzc2FnZSwgbG9nSGFzaCwgcmVzcG9uc2UpO1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgdGhyb3cgbmV3IEliYW5Ob3RWYWxpZEVycm9yKGRhdGEuc3RhdG9DaGVja0liYW4sIGxvZ0hhc2gsIHJlc3BvbnNlKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBhdG9tV2l0aENoZWNrSWJhbiA9IChcclxuICB0b29sOiBQaWNrPFBheW1lbnRUb29sLCAnaWJhbicgfCAnaW50ZXN0YXRhcmlvJyB8ICdzdWJzY3JpYmVyJz5cclxuKSA9PiB7XHJcbiAgcmV0dXJuIGF0b21XaXRoUmV0cnlhYmxlUXVlcnkoYXN5bmMgKGdldCkgPT4ge1xyXG4gICAgY29uc3QgY29udHJhY3QgPSBnZXQoY3VycmVudENvbnRyYWN0SW5mb0F0b20pO1xyXG4gICAgY29uc3QgaWRMZWFkID0gY29udHJhY3QuaWRMZWFkO1xyXG4gICAgY29uc3QgcGxpY29Db2RlID0gYXdhaXQgY29udHJhY3QucGxpY29Db2RlO1xyXG4gICAgY29uc3Qgc2FsZXNQcm9jZXNzID0gYXdhaXQgY29udHJhY3Quc2FsZXNQcm9jZXNzO1xyXG4gICAgY29uc3QgaWJhblBheWxvYWQgPSBnZXRJYmFuUGF5bG9hZCh0b29sKTtcclxuXHJcbiAgICBpZiAoaWJhblBheWxvYWQudGlwb1NvZ2dldHRvID09PSAnUEcnKSB7XHJcbiAgICAgIGNvbnN0IGEgPSBhd2FpdCBnZXQoYWRkcmVzc0F0b20pO1xyXG4gICAgICBpYmFuUGF5bG9hZC5zaWdsYVByb3ZpbmNpYSA9IGE/LnByb3ZpbmNlIHx8ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHF1ZXJ5S2V5OiBbJ2NoZWNrSWJhbicsIGliYW5QYXlsb2FkXSxcclxuICAgICAgcXVlcnlGbjogKCkgPT5cclxuICAgICAgICBjaGVja0liYW4oe1xyXG4gICAgICAgICAgaWRMZWFkLFxyXG4gICAgICAgICAgcGxpY29Db2RlLFxyXG4gICAgICAgICAgc2FsZXNQcm9jZXNzLFxyXG4gICAgICAgICAgb3BlcmF6aW9uZTogc2FsZXNQcm9jZXNzLFxyXG4gICAgICAgICAgLi4uaWJhblBheWxvYWQsXHJcbiAgICAgICAgfSksXHJcbiAgICB9O1xyXG4gIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gZ2V0SWJhblBheWxvYWQodG9vbDogUGF5bWVudFRvb2wpIHtcclxuICBjb25zdCBpYmFuID0gdG9vbC5pYmFuO1xyXG5cclxuICBpZiAodG9vbC5pbnRlc3RhdGFyaW8udHlwZSA9PT0gJ2xlZ2FsJykge1xyXG4gICAgY29uc3QgcGF5bG9hZDogQ2hlY2tJYmFuSW5wdXRQRyA9IHtcclxuICAgICAgaWJhbjogaWJhbixcclxuICAgICAgdGlwb1NvZ2dldHRvOiAnUEcnLFxyXG4gICAgICBwaXZhOiB0b29sLmludGVzdGF0YXJpby52YXROdW1iZXIsXHJcbiAgICAgIHNpZ2xhUHJvdmluY2lhOiAnJyxcclxuICAgIH07XHJcbiAgICByZXR1cm4gcGF5bG9hZDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHBheWxvYWQ6IENoZWNrSWJhbklucHV0UEYgPSB7XHJcbiAgICBpYmFuOiBpYmFuLFxyXG4gICAgdGlwb1NvZ2dldHRvOiAnUEYnIGFzIGNvbnN0LFxyXG4gICAgY29kaWNlRmlzY2FsZUludGVzdGF0YXJpbzogdG9vbC5pbnRlc3RhdGFyaW8udGF4SWQsXHJcbiAgfTtcclxuICByZXR1cm4gcGF5bG9hZDtcclxufVxyXG4iXSwiZmlsZSI6IkM6L1VzZXJzL2FpbnRyb25hL0Rlc2t0b3AvQXBwL3JlYWN0L25hai9saWJzL2RhdGEtYWNjZXNzL3NyYy9saWIvYXBpL3dlYm9yZGVyL2NoZWNrSWJhbi50cyJ9