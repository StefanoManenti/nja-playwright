globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { atom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/node_modules/.vite/apps/naj/deps/jotai.js?v=0189a8d1";
import { EgonAddress } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/egon/index.ts";
import { buildPanelBestSizeAtom, buildPanelCompatibilityAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/panel-adoption/index.ts";
import { atomWithPanelsLocationAlreadyActive } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/private-area/panelsDetails.ts";
import { atomWithCheckAsset } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/checkAsset.ts";
import { atomWithCheckPayment } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/checkPayment.ts";
import { atomWithCheckCredit } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/creditCheck.ts";
import { CommodityObj } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/CommodityObj.ts";
import { Segment } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/enums.ts";
import { Bill, Payment } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/troubleshooting/types.ts";
import { atomWithAddressAsString } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms-generators/atomWithAddressAsString.ts";
import { atomWithPaymentHolder } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms-generators/atomWithPaymentHolder.ts";
import { atomWithPaymentTools } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms-generators/buildPaymentToolsAtom.ts";
export class ChangeOfferAccount {
  constructor(data, customer) {
    this.data = data;
    this.customer = customer;
    this.existing = true;
    this.customer$ = atom(() => this.customer);
    this._billType$ = atom(Bill.NOT_SELECTED);
    this.billTypeFromService$ = atom(() => this.data.bollettaDigitale ? Bill.DIGITAL : Bill.PAPER);
    this.billType$ = atom((get) => {
      const billType = get(this._billType$);
      return billType || get(this.billTypeFromService$);
    }, (get, set, args) => {
      set(this._billType$, args);
    });
    this._paymentType$ = atom(Payment.NOT_SELECTED);
    this._paymentTool$ = atom();
    this.checkCredit$ = atom((get) => {
      const paymentType = get(this._paymentType$);
      if (!paymentType) {
        return {
          customerInWhitelist: false
        };
      }
      return get(atomWithCheckCredit(this.customer$, this));
    });
    this.paymentData$ = atom(async (get) => {
      const customerCode = get(this.customer.customerCode);
      if (!customerCode) return void 0;
      const response = await get(atomWithCheckPayment(customerCode));
      if (response.esito !== "OK" || !response.datiPagamento) return void 0;
      return response.datiPagamento;
    });
    this.paymentTypeFromService$ = atom(async (get) => {
      const paymentData = await get(this.paymentData$);
      console.log(paymentData);
      return paymentData?.domiciliazione ? Payment.DOMICILIATION : Payment.POSTAL;
    });
    this.paymentType$ = atom(async (get) => {
      const paymentType = get(this._paymentType$);
      return paymentType || get(this.paymentTypeFromService$);
    }, (get, set, args) => {
      set(this._paymentType$, args);
    });
    this.paymentTool$ = atom(async (get) => {
      const _type = get(this._paymentType$);
      const _tool = get(this._paymentTool$);
      if (_type && _tool) {
        if ("id" in _tool && !("iban" in _tool)) {
          const paymentTools = await get(this.paymentTools);
          return paymentTools?.find((tool) => tool.id === _tool.id);
        }
        return _tool;
      }
      const type = await get(this.paymentTypeFromService$);
      if (type !== Payment.DOMICILIATION) {
        return void 0;
      }
      const paymentData = await get(this.paymentData$);
      if (!paymentData) {
        return void 0;
      }
      return {
        iban: paymentData.iban || "",
        // [Christian Micocci] Domenico Napoletano, in data 11/06/2025 mi ha detto che ibanSeda non serve per il cambio prodotto.
        // ibanSeda: paymentData.ibanSeda,
        intestatario: paymentData.segmentoIntestatario === Segment.SMALL ? {
          type: "legal",
          businessName: paymentData.ragSocIntestatario || "",
          taxId: paymentData.codFiscIntestatario || "",
          vatNumber: paymentData.partitaIvaIntestatario || ""
        } : {
          type: "individual",
          givenName: paymentData.nomeIntestatario || "",
          familyName: paymentData.cognomeIntestatario || "",
          taxId: paymentData.codFiscIntestatario || ""
        },
        subscriber: paymentData.segmentoIntestatario === Segment.SMALL ? {
          type: "individual",
          givenName: paymentData.nomeSottoscrittore || "",
          familyName: paymentData.cognomeSottoscrittore || "",
          taxId: paymentData.codFiscSottoscrittore || ""
        } : void 0
      };
    }, (get, set, args) => {
      set(this._paymentTool$, args);
    });
    this.samePaymentHolderAtom = atomWithPaymentHolder(this);
    this.code = this.data.codiceConto;
    this.paymentTools = atomWithPaymentTools(this.code);
    this.alias = this.data.alias;
    this.commodity = new CommodityObj(this.data.commodity);
    this.powerSupply = atom(() => this.commodity.power ? new ChangeOfferPowerSupply(this.data, this) : void 0);
    this.gasSupply = atom(() => this.commodity.gas ? new ChangeOfferGasSupply(this.data, this) : void 0);
    this.supplyAddress = atom(EgonAddress.fromCheckD365Format(this.data.indirizzoFornitura));
    this.shippingAddress = atom(EgonAddress.fromCheckD365Format(this.data.indirizzoEsazione));
    this.supplyAddressAsString = atomWithAddressAsString(this.supplyAddress);
    this.shippingAddressAsString = atomWithAddressAsString(this.shippingAddress);
  }
}
export function isChangeOfferAccount(account) {
  return account instanceof ChangeOfferAccount;
}
class ChangeOfferPowerSupply {
  constructor(data, account) {
    this.data = data;
    this.account = account;
    this.panelBestSize = buildPanelBestSizeAtom(this, this.account.customer.customerCode);
    this.panelCompatible = buildPanelCompatibilityAtom(this);
    this.activePanelsLocations$ = atomWithPanelsLocationAlreadyActive(this, this.data.codiceConto);
    this.productName = this.data.codiceSiebelProdottoPower;
    this.assetCode = atom("TODO DA DOVE LO PRENDO?");
    this.assetId = atom("TODO DA DOVE LO PRENDO?");
    this.consumption = {
      estimatedYear: atom(this.data.consumoAnnuoPower)
    };
    this.contractCode = atom(this.data.codiceContratto);
    this.existing = true;
    this.pdfCode = atom(this.data.codiceConto);
    this.pod = atom(this.data.pod);
    this.checkAsset = atomWithCheckAsset({
      pod: this.pod
    });
    this.assetSiebel = this.data.codiceAssetSiebelPower;
  }
}
class ChangeOfferGasSupply {
  constructor(data, account) {
    this.data = data;
    this.account = account;
    this.productName = this.data.codiceSiebelProdottoGas;
    this.assetCode = atom("NOT_AVAILABLE");
    this.assetId = atom("NOT_AVAILABLE");
    this.consumption = {
      estimatedYear: atom(this.data.consumoAnnuoGas)
    };
    this.contractCode = atom(this.data.codiceContratto);
    this.existing = true;
    this.pdfCode = atom(this.data.codiceConto);
    this.pdr = atom(this.data.pdr);
    this.checkAsset = atomWithCheckAsset({
      pdr: this.pdr
    });
    this.assetSiebel = this.data.codiceAssetSiebelGas;
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLFNBQWVBLFlBQVk7QUFFM0IsU0FBU0MsbUJBQW1CO0FBQzVCLFNBQ0VDLHdCQUNBQyxtQ0FDSztBQUNQLFNBQVNDLDJDQUEyQztBQUNwRCxTQUFTQywwQkFBMEI7QUFDbkMsU0FBU0MsNEJBQTRCO0FBQ3JDLFNBQVNDLDJCQUEyQjtBQUNwQyxTQUFTQyxvQkFBb0I7QUFDN0IsU0FBU0MsZUFBZTtBQVl4QixTQUFTQyxNQUFNQyxlQUFlO0FBQzlCLFNBQVNDLCtCQUErQjtBQUN4QyxTQUFTQyw2QkFBNkI7QUFDdEMsU0FBU0MsNEJBQTRCO0FBRzlCLGFBQU1DLG1CQUE4QztBQUFBLEVBK0l6REMsWUFBb0JDLE1BQWlDQyxVQUFvQjtBQUFyREQ7QUFBaUNDO0FBOUlyRCxTQUFTQyxXQUFXO0FBRXBCLFNBQVNDLFlBQVlwQixLQUFLLE1BQU0sS0FBS2tCLFFBQVE7QUFFN0MsU0FBU0csYUFBYXJCLEtBQUtVLEtBQUtZLFlBQVk7QUFDNUMsU0FBU0MsdUJBQXVCdkIsS0FBSyxNQUNuQyxLQUFLaUIsS0FBS08sbUJBQW1CZCxLQUFLZSxVQUFVZixLQUFLZ0IsS0FDbkQ7QUFDQSxTQUFTQyxZQUFZM0IsS0FDbEI0QixTQUFRO0FBQ1AsWUFBTUMsV0FBV0QsSUFBSSxLQUFLUCxVQUFVO0FBQ3BDLGFBQU9RLFlBQVlELElBQUksS0FBS0wsb0JBQW9CO0FBQUEsSUFDbEQsR0FDQSxDQUFDSyxLQUFLRSxLQUFLQyxTQUFlO0FBQ3hCRCxVQUFJLEtBQUtULFlBQVlVLElBQUk7QUFBQSxJQUMzQixDQUNGO0FBRUEsU0FBU0MsZ0JBQWdCaEMsS0FBS1csUUFBUVcsWUFBWTtBQUNsRCxTQUFTVyxnQkFBZ0JqQyxLQUEyQztBQUNwRSxTQUFTa0MsZUFBZWxDLEtBQU00QixTQUFRO0FBQ3BDLFlBQU1PLGNBQWNQLElBQUksS0FBS0ksYUFBYTtBQUMxQyxVQUFJLENBQUNHLGFBQWE7QUFDaEIsZUFBTztBQUFBLFVBQ0xDLHFCQUFxQjtBQUFBLFFBQ3ZCO0FBQUEsTUFDRjtBQUVBLGFBQU9SLElBQUlyQixvQkFBb0IsS0FBS2EsV0FBVyxJQUFJLENBQUM7QUFBQSxJQUN0RCxDQUFDO0FBRUQsU0FBaUJpQixlQUFlckMsS0FBSyxPQUFPNEIsUUFBUTtBQUNsRCxZQUFNVSxlQUFlVixJQUFJLEtBQUtWLFNBQVNvQixZQUFZO0FBQ25ELFVBQUksQ0FBQ0EsYUFBYyxRQUFPQztBQUUxQixZQUFNQyxXQUFXLE1BQU1aLElBQUl0QixxQkFBcUJnQyxZQUFZLENBQUM7QUFDN0QsVUFBSUUsU0FBU0MsVUFBVSxRQUFRLENBQUNELFNBQVNFLGNBQWUsUUFBT0g7QUFFL0QsYUFBT0MsU0FBU0U7QUFBQUEsSUFDbEIsQ0FBQztBQUVELFNBQVNDLDBCQUEwQjNDLEtBQUssT0FBTzRCLFFBQVE7QUFDckQsWUFBTWdCLGNBQWMsTUFBTWhCLElBQUksS0FBS1MsWUFBWTtBQUMvQ1EsY0FBUUMsSUFBSUYsV0FBVztBQUN2QixhQUFPQSxhQUFhRyxpQkFBaUJwQyxRQUFRcUMsZ0JBQWdCckMsUUFBUXNDO0FBQUFBLElBQ3ZFLENBQUM7QUFFRCxTQUFTQyxlQUFlbEQsS0FDdEIsT0FBTzRCLFFBQVE7QUFDYixZQUFNTyxjQUFjUCxJQUFJLEtBQUtJLGFBQWE7QUFDMUMsYUFBT0csZUFBZVAsSUFBSSxLQUFLZSx1QkFBdUI7QUFBQSxJQUN4RCxHQUNBLENBQUNmLEtBQUtFLEtBQUtDLFNBQWtCO0FBQzNCRCxVQUFJLEtBQUtFLGVBQWVELElBQUk7QUFBQSxJQUM5QixDQUNGO0FBRUEsU0FBU29CLGVBSUxuRCxLQUNGLE9BQU80QixRQUFRO0FBQ2IsWUFBTXdCLFFBQVF4QixJQUFJLEtBQUtJLGFBQWE7QUFDcEMsWUFBTXFCLFFBQVF6QixJQUFJLEtBQUtLLGFBQWE7QUFDcEMsVUFBSW1CLFNBQVNDLE9BQU87QUFFbEIsWUFBSSxRQUFRQSxTQUFTLEVBQUUsVUFBVUEsUUFBUTtBQUN2QyxnQkFBTUMsZUFBZSxNQUFNMUIsSUFBSSxLQUFLMEIsWUFBWTtBQUNoRCxpQkFBT0EsY0FBY0MsS0FBTUMsVUFBU0EsS0FBS0MsT0FBT0osTUFBTUksRUFBRTtBQUFBLFFBQzFEO0FBQ0EsZUFBT0o7QUFBQUEsTUFDVDtBQUVBLFlBQU1LLE9BQU8sTUFBTTlCLElBQUksS0FBS2UsdUJBQXVCO0FBQ25ELFVBQUllLFNBQVMvQyxRQUFRcUMsZUFBZTtBQUNsQyxlQUFPVDtBQUFBQSxNQUNUO0FBRUEsWUFBTUssY0FBYyxNQUFNaEIsSUFBSSxLQUFLUyxZQUFZO0FBQy9DLFVBQUksQ0FBQ08sYUFBYTtBQUNoQixlQUFPTDtBQUFBQSxNQUNUO0FBRUEsYUFBTztBQUFBLFFBQ0xvQixNQUFNZixZQUFZZSxRQUFRO0FBQUE7QUFBQTtBQUFBLFFBRzFCQyxjQUNFaEIsWUFBWWlCLHlCQUF5QnBELFFBQVFxRCxRQUN6QztBQUFBLFVBQ0VKLE1BQU07QUFBQSxVQUNOSyxjQUFjbkIsWUFBWW9CLHNCQUFzQjtBQUFBLFVBQ2hEQyxPQUFPckIsWUFBWXNCLHVCQUF1QjtBQUFBLFVBQzFDQyxXQUFXdkIsWUFBWXdCLDBCQUEwQjtBQUFBLFFBQ25ELElBQ0E7QUFBQSxVQUNFVixNQUFNO0FBQUEsVUFDTlcsV0FBV3pCLFlBQVkwQixvQkFBb0I7QUFBQSxVQUMzQ0MsWUFBWTNCLFlBQVk0Qix1QkFBdUI7QUFBQSxVQUMvQ1AsT0FBT3JCLFlBQVlzQix1QkFBdUI7QUFBQSxRQUM1QztBQUFBLFFBQ05PLFlBQ0U3QixZQUFZaUIseUJBQXlCcEQsUUFBUXFELFFBQ3pDO0FBQUEsVUFDRUosTUFBTTtBQUFBLFVBQ05XLFdBQVd6QixZQUFZOEIsc0JBQXNCO0FBQUEsVUFDN0NILFlBQVkzQixZQUFZK0IseUJBQXlCO0FBQUEsVUFDakRWLE9BQU9yQixZQUFZZ0MseUJBQXlCO0FBQUEsUUFDOUMsSUFDQXJDO0FBQUFBLE1BQ1I7QUFBQSxJQUNGLEdBQ0EsQ0FBQ1gsS0FBS0UsS0FBS0MsU0FBK0M7QUFDeERELFVBQUksS0FBS0csZUFBZUYsSUFBSTtBQUFBLElBQzlCLENBQ0Y7QUFDQSxTQUFTOEMsd0JBQXdCaEUsc0JBQXNCLElBQUk7QUFDM0QsU0FBU2lFLE9BQU8sS0FBSzdELEtBQUs4RDtBQUMxQixTQUFTekIsZUFBZXhDLHFCQUFxQixLQUFLZ0UsSUFBSTtBQUN0RCxTQUFTRSxRQUFRLEtBQUsvRCxLQUFLK0Q7QUFDM0IsU0FBU0MsWUFBWSxJQUFJekUsYUFBYSxLQUFLUyxLQUFLZ0UsU0FBUztBQUN6RCxTQUFTQyxjQUE2Q2xGLEtBQUssTUFDekQsS0FBS2lGLFVBQVVFLFFBQ1gsSUFBSUMsdUJBQXVCLEtBQUtuRSxNQUFNLElBQUksSUFDMUNzQixNQUNOO0FBQ0EsU0FBUzhDLFlBQXlDckYsS0FBSyxNQUNyRCxLQUFLaUYsVUFBVUssTUFBTSxJQUFJQyxxQkFBcUIsS0FBS3RFLE1BQU0sSUFBSSxJQUFJc0IsTUFDbkU7QUFFQSxTQUFTaUQsZ0JBQWdCeEYsS0FDdkJDLFlBQVl3RixvQkFBb0IsS0FBS3hFLEtBQUt5RSxrQkFBa0IsQ0FDOUQ7QUFDQSxTQUFTQyxrQkFBa0IzRixLQUN6QkMsWUFBWXdGLG9CQUFvQixLQUFLeEUsS0FBSzJFLGlCQUFpQixDQUM3RDtBQUNBLFNBQVNDLHdCQUF3QmpGLHdCQUF3QixLQUFLNEUsYUFBYTtBQUMzRSxTQUFTTSwwQkFBMEJsRix3QkFDakMsS0FBSytFLGVBQ1A7QUFBQSxFQUUwRTtBQUM1RTtBQUVPLGdCQUFTSSxxQkFDZEMsU0FDK0I7QUFDL0IsU0FBT0EsbUJBQW1CakY7QUFDNUI7QUFFQSxNQUFNcUUsdUJBQThEO0FBQUEsRUF1QmxFcEUsWUFDbUJDLE1BQ0QrRSxTQUNoQjtBQUZpQi9FO0FBQ0QrRTtBQXhCbEIsU0FBU0MsZ0JBQWdCL0YsdUJBQ3ZCLE1BQ0EsS0FBSzhGLFFBQVE5RSxTQUFTb0IsWUFDeEI7QUFDQSxTQUFTNEQsa0JBQWtCL0YsNEJBQTRCLElBQUk7QUFDM0QsU0FBU2dHLHlCQUF5Qi9GLG9DQUNoQyxNQUNBLEtBQUthLEtBQUs4RCxXQUNaO0FBQ0EsU0FBU3FCLGNBQWMsS0FBS25GLEtBQUtvRjtBQUNqQyxTQUFTQyxZQUFZdEcsS0FBeUIseUJBQXlCO0FBQ3ZFLFNBQVN1RyxVQUFVdkcsS0FBeUIseUJBQXlCO0FBQ3JFLFNBQVN3RyxjQUFjO0FBQUEsTUFDckJDLGVBQWV6RyxLQUFLLEtBQUtpQixLQUFLeUYsaUJBQWlCO0FBQUEsSUFDakQ7QUFDQSxTQUFTQyxlQUFlM0csS0FBSyxLQUFLaUIsS0FBSzJGLGVBQWU7QUFDdEQsU0FBU3pGLFdBQVc7QUFDcEIsU0FBUzBGLFVBQVU3RyxLQUFLLEtBQUtpQixLQUFLOEQsV0FBVztBQUM3QyxTQUFTK0IsTUFBTTlHLEtBQUssS0FBS2lCLEtBQUs2RixHQUFHO0FBQ2pDLFNBQVNDLGFBQWExRyxtQkFBbUI7QUFBQSxNQUFFeUcsS0FBSyxLQUFLQTtBQUFBQSxJQUFJLENBQUM7QUFDMUQsU0FBU0UsY0FBYyxLQUFLL0YsS0FBS2dHO0FBQUFBLEVBSzlCO0FBQ0w7QUFFQSxNQUFNMUIscUJBQTBEO0FBQUEsRUFjOUR2RSxZQUNtQkMsTUFDRCtFLFNBQ2hCO0FBRmlCL0U7QUFDRCtFO0FBZmxCLFNBQVNJLGNBQWMsS0FBS25GLEtBQUtpRztBQUNqQyxTQUFTWixZQUFZdEcsS0FBeUIsZUFBZTtBQUM3RCxTQUFTdUcsVUFBVXZHLEtBQXlCLGVBQWU7QUFDM0QsU0FBU3dHLGNBQWM7QUFBQSxNQUNyQkMsZUFBZXpHLEtBQUssS0FBS2lCLEtBQUtrRyxlQUFlO0FBQUEsSUFDL0M7QUFDQSxTQUFTUixlQUFlM0csS0FBSyxLQUFLaUIsS0FBSzJGLGVBQWU7QUFDdEQsU0FBU3pGLFdBQVc7QUFDcEIsU0FBUzBGLFVBQVU3RyxLQUFLLEtBQUtpQixLQUFLOEQsV0FBVztBQUM3QyxTQUFTcUMsTUFBTXBILEtBQUssS0FBS2lCLEtBQUttRyxHQUFHO0FBQ2pDLFNBQVNMLGFBQWExRyxtQkFBbUI7QUFBQSxNQUFFK0csS0FBSyxLQUFLQTtBQUFBQSxJQUFJLENBQUM7QUFDMUQsU0FBU0osY0FBYyxLQUFLL0YsS0FBS29HO0FBQUFBLEVBSzlCO0FBQ0wiLCJuYW1lcyI6WyJhdG9tIiwiRWdvbkFkZHJlc3MiLCJidWlsZFBhbmVsQmVzdFNpemVBdG9tIiwiYnVpbGRQYW5lbENvbXBhdGliaWxpdHlBdG9tIiwiYXRvbVdpdGhQYW5lbHNMb2NhdGlvbkFscmVhZHlBY3RpdmUiLCJhdG9tV2l0aENoZWNrQXNzZXQiLCJhdG9tV2l0aENoZWNrUGF5bWVudCIsImF0b21XaXRoQ2hlY2tDcmVkaXQiLCJDb21tb2RpdHlPYmoiLCJTZWdtZW50IiwiQmlsbCIsIlBheW1lbnQiLCJhdG9tV2l0aEFkZHJlc3NBc1N0cmluZyIsImF0b21XaXRoUGF5bWVudEhvbGRlciIsImF0b21XaXRoUGF5bWVudFRvb2xzIiwiQ2hhbmdlT2ZmZXJBY2NvdW50IiwiY29uc3RydWN0b3IiLCJkYXRhIiwiY3VzdG9tZXIiLCJleGlzdGluZyIsImN1c3RvbWVyJCIsIl9iaWxsVHlwZSQiLCJOT1RfU0VMRUNURUQiLCJiaWxsVHlwZUZyb21TZXJ2aWNlJCIsImJvbGxldHRhRGlnaXRhbGUiLCJESUdJVEFMIiwiUEFQRVIiLCJiaWxsVHlwZSQiLCJnZXQiLCJiaWxsVHlwZSIsInNldCIsImFyZ3MiLCJfcGF5bWVudFR5cGUkIiwiX3BheW1lbnRUb29sJCIsImNoZWNrQ3JlZGl0JCIsInBheW1lbnRUeXBlIiwiY3VzdG9tZXJJbldoaXRlbGlzdCIsInBheW1lbnREYXRhJCIsImN1c3RvbWVyQ29kZSIsInVuZGVmaW5lZCIsInJlc3BvbnNlIiwiZXNpdG8iLCJkYXRpUGFnYW1lbnRvIiwicGF5bWVudFR5cGVGcm9tU2VydmljZSQiLCJwYXltZW50RGF0YSIsImNvbnNvbGUiLCJsb2ciLCJkb21pY2lsaWF6aW9uZSIsIkRPTUlDSUxJQVRJT04iLCJQT1NUQUwiLCJwYXltZW50VHlwZSQiLCJwYXltZW50VG9vbCQiLCJfdHlwZSIsIl90b29sIiwicGF5bWVudFRvb2xzIiwiZmluZCIsInRvb2wiLCJpZCIsInR5cGUiLCJpYmFuIiwiaW50ZXN0YXRhcmlvIiwic2VnbWVudG9JbnRlc3RhdGFyaW8iLCJTTUFMTCIsImJ1c2luZXNzTmFtZSIsInJhZ1NvY0ludGVzdGF0YXJpbyIsInRheElkIiwiY29kRmlzY0ludGVzdGF0YXJpbyIsInZhdE51bWJlciIsInBhcnRpdGFJdmFJbnRlc3RhdGFyaW8iLCJnaXZlbk5hbWUiLCJub21lSW50ZXN0YXRhcmlvIiwiZmFtaWx5TmFtZSIsImNvZ25vbWVJbnRlc3RhdGFyaW8iLCJzdWJzY3JpYmVyIiwibm9tZVNvdHRvc2NyaXR0b3JlIiwiY29nbm9tZVNvdHRvc2NyaXR0b3JlIiwiY29kRmlzY1NvdHRvc2NyaXR0b3JlIiwic2FtZVBheW1lbnRIb2xkZXJBdG9tIiwiY29kZSIsImNvZGljZUNvbnRvIiwiYWxpYXMiLCJjb21tb2RpdHkiLCJwb3dlclN1cHBseSIsInBvd2VyIiwiQ2hhbmdlT2ZmZXJQb3dlclN1cHBseSIsImdhc1N1cHBseSIsImdhcyIsIkNoYW5nZU9mZmVyR2FzU3VwcGx5Iiwic3VwcGx5QWRkcmVzcyIsImZyb21DaGVja0QzNjVGb3JtYXQiLCJpbmRpcml6em9Gb3JuaXR1cmEiLCJzaGlwcGluZ0FkZHJlc3MiLCJpbmRpcml6em9Fc2F6aW9uZSIsInN1cHBseUFkZHJlc3NBc1N0cmluZyIsInNoaXBwaW5nQWRkcmVzc0FzU3RyaW5nIiwiaXNDaGFuZ2VPZmZlckFjY291bnQiLCJhY2NvdW50IiwicGFuZWxCZXN0U2l6ZSIsInBhbmVsQ29tcGF0aWJsZSIsImFjdGl2ZVBhbmVsc0xvY2F0aW9ucyQiLCJwcm9kdWN0TmFtZSIsImNvZGljZVNpZWJlbFByb2RvdHRvUG93ZXIiLCJhc3NldENvZGUiLCJhc3NldElkIiwiY29uc3VtcHRpb24iLCJlc3RpbWF0ZWRZZWFyIiwiY29uc3Vtb0FubnVvUG93ZXIiLCJjb250cmFjdENvZGUiLCJjb2RpY2VDb250cmF0dG8iLCJwZGZDb2RlIiwicG9kIiwiY2hlY2tBc3NldCIsImFzc2V0U2llYmVsIiwiY29kaWNlQXNzZXRTaWViZWxQb3dlciIsImNvZGljZVNpZWJlbFByb2RvdHRvR2FzIiwiY29uc3Vtb0FubnVvR2FzIiwicGRyIiwiY29kaWNlQXNzZXRTaWViZWxHYXMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiQ2hhbmdlT2ZmZXJBY2NvdW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEF0b20sIGF0b20gfSBmcm9tICdqb3RhaSc7XHJcbmltcG9ydCB7IEZvcm5pdHVyYSB9IGZyb20gJy4uL2FwaS9jYW1iaW8tcHJvZG90dG8vZm9ybml0dXJlJztcclxuaW1wb3J0IHsgRWdvbkFkZHJlc3MgfSBmcm9tICcuLi9hcGkvZWdvbic7XHJcbmltcG9ydCB7XHJcbiAgYnVpbGRQYW5lbEJlc3RTaXplQXRvbSxcclxuICBidWlsZFBhbmVsQ29tcGF0aWJpbGl0eUF0b20sXHJcbn0gZnJvbSAnLi4vYXBpL3BhbmVsLWFkb3B0aW9uJztcclxuaW1wb3J0IHsgYXRvbVdpdGhQYW5lbHNMb2NhdGlvbkFscmVhZHlBY3RpdmUgfSBmcm9tICcuLi9hcGkvcHJpdmF0ZS1hcmVhL3BhbmVsc0RldGFpbHMnO1xyXG5pbXBvcnQgeyBhdG9tV2l0aENoZWNrQXNzZXQgfSBmcm9tICcuLi9hcGkvd2Vib3JkZXIvY2hlY2tBc3NldCc7XHJcbmltcG9ydCB7IGF0b21XaXRoQ2hlY2tQYXltZW50IH0gZnJvbSAnLi4vYXBpL3dlYm9yZGVyL2NoZWNrUGF5bWVudCc7XHJcbmltcG9ydCB7IGF0b21XaXRoQ2hlY2tDcmVkaXQgfSBmcm9tICcuLi9hcGkvd2Vib3JkZXIvY3JlZGl0Q2hlY2snO1xyXG5pbXBvcnQgeyBDb21tb2RpdHlPYmogfSBmcm9tICcuLi9hdG9tcy9Db21tb2RpdHlPYmonO1xyXG5pbXBvcnQgeyBTZWdtZW50IH0gZnJvbSAnLi4vYXRvbXMvZW51bXMnO1xyXG5pbXBvcnQgeyBFeGlzdGluZ1N1cHBseSB9IGZyb20gJy4uL2F0b21zL3N1cHBseSc7XHJcbmltcG9ydCB7XHJcbiAgdHlwZSBBY2NvdW50LFxyXG4gIEFzeW5jV3JpdGFibGVBdG9tLFxyXG4gIHR5cGUgQ3VzdG9tZXIsXHJcbiAgRXhpc3RpbmdQYXltZW50VG9vbCxcclxuICBHYXNTdXBwbHksXHJcbiAgTmV3UGF5bWVudFRvb2wsXHJcbiAgUGF5bWVudFRvb2wsXHJcbiAgUG93ZXJTdXBwbHksXHJcbn0gZnJvbSAnLi4vYXRvbXMvdHlwZXMnO1xyXG5pbXBvcnQgeyBCaWxsLCBQYXltZW50IH0gZnJvbSAnLi4vdHJvdWJsZXNob290aW5nL3R5cGVzJztcclxuaW1wb3J0IHsgYXRvbVdpdGhBZGRyZXNzQXNTdHJpbmcgfSBmcm9tICcuL2F0b21XaXRoQWRkcmVzc0FzU3RyaW5nJztcclxuaW1wb3J0IHsgYXRvbVdpdGhQYXltZW50SG9sZGVyIH0gZnJvbSAnLi9hdG9tV2l0aFBheW1lbnRIb2xkZXInO1xyXG5pbXBvcnQgeyBhdG9tV2l0aFBheW1lbnRUb29scyB9IGZyb20gJy4vYnVpbGRQYXltZW50VG9vbHNBdG9tJztcclxuaW1wb3J0IHsgRXhpc3RpbmdBY2NvdW50IH0gZnJvbSAnLi9FeGlzdGluZ0FjY291bnQnO1xyXG5cclxuZXhwb3J0IGNsYXNzIENoYW5nZU9mZmVyQWNjb3VudCBpbXBsZW1lbnRzIEV4aXN0aW5nQWNjb3VudCB7XHJcbiAgcmVhZG9ubHkgZXhpc3RpbmcgPSB0cnVlO1xyXG5cclxuICByZWFkb25seSBjdXN0b21lciQgPSBhdG9tKCgpID0+IHRoaXMuY3VzdG9tZXIpO1xyXG5cclxuICByZWFkb25seSBfYmlsbFR5cGUkID0gYXRvbShCaWxsLk5PVF9TRUxFQ1RFRCk7XHJcbiAgcmVhZG9ubHkgYmlsbFR5cGVGcm9tU2VydmljZSQgPSBhdG9tKCgpID0+XHJcbiAgICB0aGlzLmRhdGEuYm9sbGV0dGFEaWdpdGFsZSA/IEJpbGwuRElHSVRBTCA6IEJpbGwuUEFQRVJcclxuICApO1xyXG4gIHJlYWRvbmx5IGJpbGxUeXBlJCA9IGF0b20oXHJcbiAgICAoZ2V0KSA9PiB7XHJcbiAgICAgIGNvbnN0IGJpbGxUeXBlID0gZ2V0KHRoaXMuX2JpbGxUeXBlJCk7XHJcbiAgICAgIHJldHVybiBiaWxsVHlwZSB8fCBnZXQodGhpcy5iaWxsVHlwZUZyb21TZXJ2aWNlJCk7XHJcbiAgICB9LFxyXG4gICAgKGdldCwgc2V0LCBhcmdzOiBCaWxsKSA9PiB7XHJcbiAgICAgIHNldCh0aGlzLl9iaWxsVHlwZSQsIGFyZ3MpO1xyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIHJlYWRvbmx5IF9wYXltZW50VHlwZSQgPSBhdG9tKFBheW1lbnQuTk9UX1NFTEVDVEVEKTtcclxuICByZWFkb25seSBfcGF5bWVudFRvb2wkID0gYXRvbTxOZXdQYXltZW50VG9vbCB8IEV4aXN0aW5nUGF5bWVudFRvb2w+KCk7XHJcbiAgcmVhZG9ubHkgY2hlY2tDcmVkaXQkID0gYXRvbSgoZ2V0KSA9PiB7XHJcbiAgICBjb25zdCBwYXltZW50VHlwZSA9IGdldCh0aGlzLl9wYXltZW50VHlwZSQpO1xyXG4gICAgaWYgKCFwYXltZW50VHlwZSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGN1c3RvbWVySW5XaGl0ZWxpc3Q6IGZhbHNlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBnZXQoYXRvbVdpdGhDaGVja0NyZWRpdCh0aGlzLmN1c3RvbWVyJCwgdGhpcykpO1xyXG4gIH0pO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHBheW1lbnREYXRhJCA9IGF0b20oYXN5bmMgKGdldCkgPT4ge1xyXG4gICAgY29uc3QgY3VzdG9tZXJDb2RlID0gZ2V0KHRoaXMuY3VzdG9tZXIuY3VzdG9tZXJDb2RlKTtcclxuICAgIGlmICghY3VzdG9tZXJDb2RlKSByZXR1cm4gdW5kZWZpbmVkO1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0KGF0b21XaXRoQ2hlY2tQYXltZW50KGN1c3RvbWVyQ29kZSkpO1xyXG4gICAgaWYgKHJlc3BvbnNlLmVzaXRvICE9PSAnT0snIHx8ICFyZXNwb25zZS5kYXRpUGFnYW1lbnRvKSByZXR1cm4gdW5kZWZpbmVkO1xyXG5cclxuICAgIHJldHVybiByZXNwb25zZS5kYXRpUGFnYW1lbnRvO1xyXG4gIH0pO1xyXG5cclxuICByZWFkb25seSBwYXltZW50VHlwZUZyb21TZXJ2aWNlJCA9IGF0b20oYXN5bmMgKGdldCkgPT4ge1xyXG4gICAgY29uc3QgcGF5bWVudERhdGEgPSBhd2FpdCBnZXQodGhpcy5wYXltZW50RGF0YSQpO1xyXG4gICAgY29uc29sZS5sb2cocGF5bWVudERhdGEpO1xyXG4gICAgcmV0dXJuIHBheW1lbnREYXRhPy5kb21pY2lsaWF6aW9uZSA/IFBheW1lbnQuRE9NSUNJTElBVElPTiA6IFBheW1lbnQuUE9TVEFMO1xyXG4gIH0pO1xyXG5cclxuICByZWFkb25seSBwYXltZW50VHlwZSQgPSBhdG9tKFxyXG4gICAgYXN5bmMgKGdldCkgPT4ge1xyXG4gICAgICBjb25zdCBwYXltZW50VHlwZSA9IGdldCh0aGlzLl9wYXltZW50VHlwZSQpO1xyXG4gICAgICByZXR1cm4gcGF5bWVudFR5cGUgfHwgZ2V0KHRoaXMucGF5bWVudFR5cGVGcm9tU2VydmljZSQpO1xyXG4gICAgfSxcclxuICAgIChnZXQsIHNldCwgYXJnczogUGF5bWVudCkgPT4ge1xyXG4gICAgICBzZXQodGhpcy5fcGF5bWVudFR5cGUkLCBhcmdzKTtcclxuICAgIH1cclxuICApO1xyXG5cclxuICByZWFkb25seSBwYXltZW50VG9vbCQ6IEFzeW5jV3JpdGFibGVBdG9tPFxyXG4gICAgUGF5bWVudFRvb2wgfCBOZXdQYXltZW50VG9vbCB8IHVuZGVmaW5lZCxcclxuICAgIFtOZXdQYXltZW50VG9vbCB8IEV4aXN0aW5nUGF5bWVudFRvb2xdLFxyXG4gICAgdm9pZFxyXG4gID4gPSBhdG9tKFxyXG4gICAgYXN5bmMgKGdldCkgPT4ge1xyXG4gICAgICBjb25zdCBfdHlwZSA9IGdldCh0aGlzLl9wYXltZW50VHlwZSQpO1xyXG4gICAgICBjb25zdCBfdG9vbCA9IGdldCh0aGlzLl9wYXltZW50VG9vbCQpO1xyXG4gICAgICBpZiAoX3R5cGUgJiYgX3Rvb2wpIHtcclxuICAgICAgICAvLyBJZiBpdCdzIGFuIEV4aXN0aW5nUGF5bWVudFRvb2wsIGZpbmQgdGhlIGNvcnJlc3BvbmRpbmcgcGF5bWVudCB0b29sXHJcbiAgICAgICAgaWYgKCdpZCcgaW4gX3Rvb2wgJiYgISgnaWJhbicgaW4gX3Rvb2wpKSB7XHJcbiAgICAgICAgICBjb25zdCBwYXltZW50VG9vbHMgPSBhd2FpdCBnZXQodGhpcy5wYXltZW50VG9vbHMpO1xyXG4gICAgICAgICAgcmV0dXJuIHBheW1lbnRUb29scz8uZmluZCgodG9vbCkgPT4gdG9vbC5pZCA9PT0gX3Rvb2wuaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gX3Rvb2wgYXMgTmV3UGF5bWVudFRvb2w7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHR5cGUgPSBhd2FpdCBnZXQodGhpcy5wYXltZW50VHlwZUZyb21TZXJ2aWNlJCk7XHJcbiAgICAgIGlmICh0eXBlICE9PSBQYXltZW50LkRPTUlDSUxJQVRJT04pIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBwYXltZW50RGF0YSA9IGF3YWl0IGdldCh0aGlzLnBheW1lbnREYXRhJCk7XHJcbiAgICAgIGlmICghcGF5bWVudERhdGEpIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGliYW46IHBheW1lbnREYXRhLmliYW4gfHwgJycsXHJcbiAgICAgICAgLy8gW0NocmlzdGlhbiBNaWNvY2NpXSBEb21lbmljbyBOYXBvbGV0YW5vLCBpbiBkYXRhIDExLzA2LzIwMjUgbWkgaGEgZGV0dG8gY2hlIGliYW5TZWRhIG5vbiBzZXJ2ZSBwZXIgaWwgY2FtYmlvIHByb2RvdHRvLlxyXG4gICAgICAgIC8vIGliYW5TZWRhOiBwYXltZW50RGF0YS5pYmFuU2VkYSxcclxuICAgICAgICBpbnRlc3RhdGFyaW86XHJcbiAgICAgICAgICBwYXltZW50RGF0YS5zZWdtZW50b0ludGVzdGF0YXJpbyA9PT0gU2VnbWVudC5TTUFMTFxyXG4gICAgICAgICAgICA/IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdsZWdhbCcsXHJcbiAgICAgICAgICAgICAgICBidXNpbmVzc05hbWU6IHBheW1lbnREYXRhLnJhZ1NvY0ludGVzdGF0YXJpbyB8fCAnJyxcclxuICAgICAgICAgICAgICAgIHRheElkOiBwYXltZW50RGF0YS5jb2RGaXNjSW50ZXN0YXRhcmlvIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgdmF0TnVtYmVyOiBwYXltZW50RGF0YS5wYXJ0aXRhSXZhSW50ZXN0YXRhcmlvIHx8ICcnLFxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgOiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW5kaXZpZHVhbCcsXHJcbiAgICAgICAgICAgICAgICBnaXZlbk5hbWU6IHBheW1lbnREYXRhLm5vbWVJbnRlc3RhdGFyaW8gfHwgJycsXHJcbiAgICAgICAgICAgICAgICBmYW1pbHlOYW1lOiBwYXltZW50RGF0YS5jb2dub21lSW50ZXN0YXRhcmlvIHx8ICcnLFxyXG4gICAgICAgICAgICAgICAgdGF4SWQ6IHBheW1lbnREYXRhLmNvZEZpc2NJbnRlc3RhdGFyaW8gfHwgJycsXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICBzdWJzY3JpYmVyOlxyXG4gICAgICAgICAgcGF5bWVudERhdGEuc2VnbWVudG9JbnRlc3RhdGFyaW8gPT09IFNlZ21lbnQuU01BTExcclxuICAgICAgICAgICAgPyB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW5kaXZpZHVhbCcsXHJcbiAgICAgICAgICAgICAgICBnaXZlbk5hbWU6IHBheW1lbnREYXRhLm5vbWVTb3R0b3Njcml0dG9yZSB8fCAnJyxcclxuICAgICAgICAgICAgICAgIGZhbWlseU5hbWU6IHBheW1lbnREYXRhLmNvZ25vbWVTb3R0b3Njcml0dG9yZSB8fCAnJyxcclxuICAgICAgICAgICAgICAgIHRheElkOiBwYXltZW50RGF0YS5jb2RGaXNjU290dG9zY3JpdHRvcmUgfHwgJycsXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcclxuICAgICAgfSBzYXRpc2ZpZXMgTmV3UGF5bWVudFRvb2w7XHJcbiAgICB9LFxyXG4gICAgKGdldCwgc2V0LCBhcmdzOiBOZXdQYXltZW50VG9vbCB8IEV4aXN0aW5nUGF5bWVudFRvb2wpID0+IHtcclxuICAgICAgc2V0KHRoaXMuX3BheW1lbnRUb29sJCwgYXJncyk7XHJcbiAgICB9XHJcbiAgKTtcclxuICByZWFkb25seSBzYW1lUGF5bWVudEhvbGRlckF0b20gPSBhdG9tV2l0aFBheW1lbnRIb2xkZXIodGhpcyk7XHJcbiAgcmVhZG9ubHkgY29kZSA9IHRoaXMuZGF0YS5jb2RpY2VDb250bztcclxuICByZWFkb25seSBwYXltZW50VG9vbHMgPSBhdG9tV2l0aFBheW1lbnRUb29scyh0aGlzLmNvZGUpO1xyXG4gIHJlYWRvbmx5IGFsaWFzID0gdGhpcy5kYXRhLmFsaWFzO1xyXG4gIHJlYWRvbmx5IGNvbW1vZGl0eSA9IG5ldyBDb21tb2RpdHlPYmoodGhpcy5kYXRhLmNvbW1vZGl0eSk7XHJcbiAgcmVhZG9ubHkgcG93ZXJTdXBwbHk6IEF0b208UG93ZXJTdXBwbHkgfCB1bmRlZmluZWQ+ID0gYXRvbSgoKSA9PlxyXG4gICAgdGhpcy5jb21tb2RpdHkucG93ZXJcclxuICAgICAgPyBuZXcgQ2hhbmdlT2ZmZXJQb3dlclN1cHBseSh0aGlzLmRhdGEsIHRoaXMpXHJcbiAgICAgIDogdW5kZWZpbmVkXHJcbiAgKTtcclxuICByZWFkb25seSBnYXNTdXBwbHk6IEF0b208R2FzU3VwcGx5IHwgdW5kZWZpbmVkPiA9IGF0b20oKCkgPT5cclxuICAgIHRoaXMuY29tbW9kaXR5LmdhcyA/IG5ldyBDaGFuZ2VPZmZlckdhc1N1cHBseSh0aGlzLmRhdGEsIHRoaXMpIDogdW5kZWZpbmVkXHJcbiAgKTtcclxuXHJcbiAgcmVhZG9ubHkgc3VwcGx5QWRkcmVzcyA9IGF0b208RWdvbkFkZHJlc3MgfCB1bmRlZmluZWQ+KFxyXG4gICAgRWdvbkFkZHJlc3MuZnJvbUNoZWNrRDM2NUZvcm1hdCh0aGlzLmRhdGEuaW5kaXJpenpvRm9ybml0dXJhKVxyXG4gICk7XHJcbiAgcmVhZG9ubHkgc2hpcHBpbmdBZGRyZXNzID0gYXRvbTxFZ29uQWRkcmVzcyB8IHVuZGVmaW5lZD4oXHJcbiAgICBFZ29uQWRkcmVzcy5mcm9tQ2hlY2tEMzY1Rm9ybWF0KHRoaXMuZGF0YS5pbmRpcml6em9Fc2F6aW9uZSlcclxuICApO1xyXG4gIHJlYWRvbmx5IHN1cHBseUFkZHJlc3NBc1N0cmluZyA9IGF0b21XaXRoQWRkcmVzc0FzU3RyaW5nKHRoaXMuc3VwcGx5QWRkcmVzcyk7XHJcbiAgcmVhZG9ubHkgc2hpcHBpbmdBZGRyZXNzQXNTdHJpbmcgPSBhdG9tV2l0aEFkZHJlc3NBc1N0cmluZyhcclxuICAgIHRoaXMuc2hpcHBpbmdBZGRyZXNzXHJcbiAgKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkYXRhOiBGb3JuaXR1cmEsIHB1YmxpYyByZWFkb25seSBjdXN0b21lcjogQ3VzdG9tZXIpIHt9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0NoYW5nZU9mZmVyQWNjb3VudChcclxuICBhY2NvdW50OiBBY2NvdW50XHJcbik6IGFjY291bnQgaXMgQ2hhbmdlT2ZmZXJBY2NvdW50IHtcclxuICByZXR1cm4gYWNjb3VudCBpbnN0YW5jZW9mIENoYW5nZU9mZmVyQWNjb3VudDtcclxufVxyXG5cclxuY2xhc3MgQ2hhbmdlT2ZmZXJQb3dlclN1cHBseSBpbXBsZW1lbnRzIFBvd2VyU3VwcGx5LCBFeGlzdGluZ1N1cHBseSB7XHJcbiAgcmVhZG9ubHkgcGFuZWxCZXN0U2l6ZSA9IGJ1aWxkUGFuZWxCZXN0U2l6ZUF0b20oXHJcbiAgICB0aGlzLFxyXG4gICAgdGhpcy5hY2NvdW50LmN1c3RvbWVyLmN1c3RvbWVyQ29kZVxyXG4gICk7XHJcbiAgcmVhZG9ubHkgcGFuZWxDb21wYXRpYmxlID0gYnVpbGRQYW5lbENvbXBhdGliaWxpdHlBdG9tKHRoaXMpO1xyXG4gIHJlYWRvbmx5IGFjdGl2ZVBhbmVsc0xvY2F0aW9ucyQgPSBhdG9tV2l0aFBhbmVsc0xvY2F0aW9uQWxyZWFkeUFjdGl2ZShcclxuICAgIHRoaXMsXHJcbiAgICB0aGlzLmRhdGEuY29kaWNlQ29udG9cclxuICApO1xyXG4gIHJlYWRvbmx5IHByb2R1Y3ROYW1lID0gdGhpcy5kYXRhLmNvZGljZVNpZWJlbFByb2RvdHRvUG93ZXI7XHJcbiAgcmVhZG9ubHkgYXNzZXRDb2RlID0gYXRvbTxzdHJpbmcgfCB1bmRlZmluZWQ+KCdUT0RPIERBIERPVkUgTE8gUFJFTkRPPycpO1xyXG4gIHJlYWRvbmx5IGFzc2V0SWQgPSBhdG9tPHN0cmluZyB8IHVuZGVmaW5lZD4oJ1RPRE8gREEgRE9WRSBMTyBQUkVORE8/Jyk7XHJcbiAgcmVhZG9ubHkgY29uc3VtcHRpb24gPSB7XHJcbiAgICBlc3RpbWF0ZWRZZWFyOiBhdG9tKHRoaXMuZGF0YS5jb25zdW1vQW5udW9Qb3dlciksXHJcbiAgfTtcclxuICByZWFkb25seSBjb250cmFjdENvZGUgPSBhdG9tKHRoaXMuZGF0YS5jb2RpY2VDb250cmF0dG8pO1xyXG4gIHJlYWRvbmx5IGV4aXN0aW5nID0gdHJ1ZTtcclxuICByZWFkb25seSBwZGZDb2RlID0gYXRvbSh0aGlzLmRhdGEuY29kaWNlQ29udG8pO1xyXG4gIHJlYWRvbmx5IHBvZCA9IGF0b20odGhpcy5kYXRhLnBvZCk7XHJcbiAgcmVhZG9ubHkgY2hlY2tBc3NldCA9IGF0b21XaXRoQ2hlY2tBc3NldCh7IHBvZDogdGhpcy5wb2QgfSk7XHJcbiAgcmVhZG9ubHkgYXNzZXRTaWViZWwgPSB0aGlzLmRhdGEuY29kaWNlQXNzZXRTaWViZWxQb3dlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRhdGE6IEZvcm5pdHVyYSxcclxuICAgIHB1YmxpYyByZWFkb25seSBhY2NvdW50OiBDaGFuZ2VPZmZlckFjY291bnRcclxuICApIHt9XHJcbn1cclxuXHJcbmNsYXNzIENoYW5nZU9mZmVyR2FzU3VwcGx5IGltcGxlbWVudHMgR2FzU3VwcGx5LCBFeGlzdGluZ1N1cHBseSB7XHJcbiAgcmVhZG9ubHkgcHJvZHVjdE5hbWUgPSB0aGlzLmRhdGEuY29kaWNlU2llYmVsUHJvZG90dG9HYXM7XHJcbiAgcmVhZG9ubHkgYXNzZXRDb2RlID0gYXRvbTxzdHJpbmcgfCB1bmRlZmluZWQ+KCdOT1RfQVZBSUxBQkxFJyk7XHJcbiAgcmVhZG9ubHkgYXNzZXRJZCA9IGF0b208c3RyaW5nIHwgdW5kZWZpbmVkPignTk9UX0FWQUlMQUJMRScpO1xyXG4gIHJlYWRvbmx5IGNvbnN1bXB0aW9uID0ge1xyXG4gICAgZXN0aW1hdGVkWWVhcjogYXRvbSh0aGlzLmRhdGEuY29uc3Vtb0FubnVvR2FzKSxcclxuICB9O1xyXG4gIHJlYWRvbmx5IGNvbnRyYWN0Q29kZSA9IGF0b20odGhpcy5kYXRhLmNvZGljZUNvbnRyYXR0byk7XHJcbiAgcmVhZG9ubHkgZXhpc3RpbmcgPSB0cnVlO1xyXG4gIHJlYWRvbmx5IHBkZkNvZGUgPSBhdG9tKHRoaXMuZGF0YS5jb2RpY2VDb250byk7XHJcbiAgcmVhZG9ubHkgcGRyID0gYXRvbSh0aGlzLmRhdGEucGRyKTtcclxuICByZWFkb25seSBjaGVja0Fzc2V0ID0gYXRvbVdpdGhDaGVja0Fzc2V0KHsgcGRyOiB0aGlzLnBkciB9KTtcclxuICByZWFkb25seSBhc3NldFNpZWJlbCA9IHRoaXMuZGF0YS5jb2RpY2VBc3NldFNpZWJlbEdhcztcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRhdGE6IEZvcm5pdHVyYSxcclxuICAgIHB1YmxpYyByZWFkb25seSBhY2NvdW50OiBDaGFuZ2VPZmZlckFjY291bnRcclxuICApIHt9XHJcbn1cclxuIl0sImZpbGUiOiJDOi9Vc2Vycy9haW50cm9uYS9EZXNrdG9wL0FwcC9yZWFjdC9uYWovbGlicy9kYXRhLWFjY2Vzcy9zcmMvbGliL2F0b21zLWdlbmVyYXRvcnMvQ2hhbmdlT2ZmZXJBY2NvdW50LnRzIn0=