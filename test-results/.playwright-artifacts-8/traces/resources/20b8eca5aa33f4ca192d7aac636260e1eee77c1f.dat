globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
  cache: /* @__PURE__ */ new Map(),
  get(name, inst) {
    if (this.cache.has(name)) {
      return this.cache.get(name);
    }
    this.cache.set(name, inst);
    return inst;
  }
};
import { atomAction, PreconditionFailedError } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/util/src/index.ts";
import { EgonAddress } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/egon/index.ts";
import { checkTransfer } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/api/weborder/checkTransfer.ts";
import { currentPlicoCode } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/current-contract-info-atoms.ts";
import { customerAtom } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms/customer-atoms.ts";
import { NewAccount } from "/@fs/C:/Users/aintrona/Desktop/App/react/naj/libs/data-access/src/lib/atoms-generators/NewAccount.ts";
export class TransferAccount extends NewAccount {
  static {
    this.new$ = atomAction(async (get, set, {
      pod,
      pdr,
      taxId
    }) => {
      const codiceProposta = await get(currentPlicoCode);
      if (!codiceProposta) {
        throw new PreconditionFailedError("plicoCode is null");
      }
      const data = await checkTransfer({
        pod,
        pdr,
        codiceProposta,
        codFiscPrevisto: taxId
      });
      const fornituraCommon = data.fornituraLuce || data.fornituraGas;
      if (!fornituraCommon) {
        throw new PreconditionFailedError("fornituraLuce and fornituraGas are null");
      }
      const account = new TransferAccount(customerAtom, data.intestatario, !!pod, !!pdr, fornituraCommon.codiceConto);
      set(account.supplyAddress, EgonAddress.fromCheckD365Format(fornituraCommon.indirizzo));
      if (data.fornituraLuce) {
        const supply = get(account.powerSupply);
        if (!supply) {
          throw new PreconditionFailedError("unexpected power supply is null");
        }
        set(supply.pod, data.fornituraLuce.podPdr);
        set(supply.contractCode, data.fornituraLuce.codiceContratto);
        set(supply.assetCode, data.fornituraLuce.codiceAsset);
        set(supply.assetId, data.fornituraLuce.supplyCode);
        set(supply.pdfCode, data.fornituraLuce.codicePDF);
        set(supply.kwAtom, data.fornituraLuce.potenzaImpegnata);
        set(supply.voltageAtom, data.fornituraLuce.livelloTensione);
      }
      if (data.fornituraGas) {
        const supply = get(account.gasSupply);
        if (!supply) {
          throw new PreconditionFailedError("unexpected gas supply is null");
        }
        set(supply.pdr, data.fornituraGas.podPdr);
        set(supply.contractCode, data.fornituraGas.codiceContratto);
        set(supply.assetCode, data.fornituraGas.codiceAsset);
        set(supply.assetId, data.fornituraGas.supplyCode);
        set(supply.pdfCode, data.fornituraGas.codicePDF);
      }
      return account;
    });
  }
  constructor(customer$, oldCustomer, power, gas, code) {
    super(customer$, power, gas, code);
    this.oldCustomer = {
      ...oldCustomer,
      segment: oldCustomer.segmento
    };
  }
}

//# sourceMappingURL=data:application/json;base64,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b25BZGRyZXNzIiwiY2hlY2tUcmFuc2ZlciIsImN1cnJlbnRQbGljb0NvZGUiLCJjdXN0b21lckF0b20iLCJOZXdBY2NvdW50IiwiVHJhbnNmZXJBY2NvdW50IiwibmV3JCIsImdldCIsInNldCIsInBvZCIsInBkciIsInRheElkIiwiY29kaWNlUHJvcG9zdGEiLCJkYXRhIiwiY29kRmlzY1ByZXZpc3RvIiwiZm9ybml0dXJhQ29tbW9uIiwiZm9ybml0dXJhTHVjZSIsImZvcm5pdHVyYUdhcyIsImFjY291bnQiLCJpbnRlc3RhdGFyaW8iLCJjb2RpY2VDb250byIsInN1cHBseUFkZHJlc3MiLCJmcm9tQ2hlY2tEMzY1Rm9ybWF0IiwiaW5kaXJpenpvIiwic3VwcGx5IiwicG93ZXJTdXBwbHkiLCJwb2RQZHIiLCJjb250cmFjdENvZGUiLCJjb2RpY2VDb250cmF0dG8iLCJhc3NldENvZGUiLCJjb2RpY2VBc3NldCIsImFzc2V0SWQiLCJzdXBwbHlDb2RlIiwicGRmQ29kZSIsImNvZGljZVBERiIsImt3QXRvbSIsInBvdGVuemFJbXBlZ25hdGEiLCJ2b2x0YWdlQXRvbSIsImxpdmVsbG9UZW5zaW9uZSIsImdhc1N1cHBseSIsImNvbnN0cnVjdG9yIiwiY3VzdG9tZXIkIiwib2xkQ3VzdG9tZXIiLCJwb3dlciIsImdhcyIsImNvZGUiLCJzZWdtZW50Iiwic2VnbWVudG8iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiVHJhbnNmZXJBY2NvdW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGF0b21BY3Rpb24sIFByZWNvbmRpdGlvbkZhaWxlZEVycm9yIH0gZnJvbSAnQG5hai13by91dGlsJztcclxuaW1wb3J0IHsgRWdvbkFkZHJlc3MgfSBmcm9tICcuLi9hcGkvZWdvbic7XHJcbmltcG9ydCB7IGNoZWNrVHJhbnNmZXIsIHR5cGUgVm9sdHVyYXRvIH0gZnJvbSAnLi4vYXBpL3dlYm9yZGVyL2NoZWNrVHJhbnNmZXInO1xyXG5pbXBvcnQgeyBjdXJyZW50UGxpY29Db2RlIH0gZnJvbSAnLi4vYXRvbXMvY3VycmVudC1jb250cmFjdC1pbmZvLWF0b21zJztcclxuaW1wb3J0IHsgY3VzdG9tZXJBdG9tIH0gZnJvbSAnLi4vYXRvbXMvY3VzdG9tZXItYXRvbXMnO1xyXG5pbXBvcnQgeyBTZWdtZW50IH0gZnJvbSAnLi4vYXRvbXMvZW51bXMnO1xyXG5pbXBvcnQgeyBBc3luY0F0b20sIEN1c3RvbWVyIH0gZnJvbSAnLi4vYXRvbXMvdHlwZXMnO1xyXG5pbXBvcnQgeyBOZXdBY2NvdW50IH0gZnJvbSAnLi9OZXdBY2NvdW50JztcclxuXHJcbmV4cG9ydCBjbGFzcyBUcmFuc2ZlckFjY291bnQgZXh0ZW5kcyBOZXdBY2NvdW50IHtcclxuICBzdGF0aWMgbmV3JCA9IGF0b21BY3Rpb24oXHJcbiAgICBhc3luYyAoXHJcbiAgICAgIGdldCxcclxuICAgICAgc2V0LFxyXG4gICAgICB7XHJcbiAgICAgICAgcG9kLFxyXG4gICAgICAgIHBkcixcclxuICAgICAgICB0YXhJZCxcclxuICAgICAgfToge1xyXG4gICAgICAgIHBvZD86IHN0cmluZztcclxuICAgICAgICBwZHI/OiBzdHJpbmc7XHJcbiAgICAgICAgdGF4SWQ6IHN0cmluZztcclxuICAgICAgfVxyXG4gICAgKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvZGljZVByb3Bvc3RhID0gYXdhaXQgZ2V0KGN1cnJlbnRQbGljb0NvZGUpO1xyXG4gICAgICBpZiAoIWNvZGljZVByb3Bvc3RhKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFByZWNvbmRpdGlvbkZhaWxlZEVycm9yKCdwbGljb0NvZGUgaXMgbnVsbCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBUT0RPIGlmIGNoZWNrVHJhc25mZXIgY3Jhc2g/XHJcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBjaGVja1RyYW5zZmVyKHtcclxuICAgICAgICBwb2QsXHJcbiAgICAgICAgcGRyLFxyXG4gICAgICAgIGNvZGljZVByb3Bvc3RhLFxyXG4gICAgICAgIGNvZEZpc2NQcmV2aXN0bzogdGF4SWQsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgZm9ybml0dXJhQ29tbW9uID0gZGF0YS5mb3JuaXR1cmFMdWNlIHx8IGRhdGEuZm9ybml0dXJhR2FzO1xyXG4gICAgICBpZiAoIWZvcm5pdHVyYUNvbW1vbikge1xyXG4gICAgICAgIHRocm93IG5ldyBQcmVjb25kaXRpb25GYWlsZWRFcnJvcihcclxuICAgICAgICAgICdmb3JuaXR1cmFMdWNlIGFuZCBmb3JuaXR1cmFHYXMgYXJlIG51bGwnXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgYWNjb3VudCA9IG5ldyBUcmFuc2ZlckFjY291bnQoXHJcbiAgICAgICAgY3VzdG9tZXJBdG9tLFxyXG4gICAgICAgIGRhdGEuaW50ZXN0YXRhcmlvLFxyXG4gICAgICAgICEhcG9kLFxyXG4gICAgICAgICEhcGRyLFxyXG4gICAgICAgIGZvcm5pdHVyYUNvbW1vbi5jb2RpY2VDb250b1xyXG4gICAgICApO1xyXG5cclxuICAgICAgc2V0KFxyXG4gICAgICAgIGFjY291bnQuc3VwcGx5QWRkcmVzcyxcclxuICAgICAgICBFZ29uQWRkcmVzcy5mcm9tQ2hlY2tEMzY1Rm9ybWF0KGZvcm5pdHVyYUNvbW1vbi5pbmRpcml6em8pXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBpZiAoZGF0YS5mb3JuaXR1cmFMdWNlKSB7XHJcbiAgICAgICAgY29uc3Qgc3VwcGx5ID0gZ2V0KGFjY291bnQucG93ZXJTdXBwbHkpO1xyXG4gICAgICAgIGlmICghc3VwcGx5KSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgUHJlY29uZGl0aW9uRmFpbGVkRXJyb3IoJ3VuZXhwZWN0ZWQgcG93ZXIgc3VwcGx5IGlzIG51bGwnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0KHN1cHBseS5wb2QsIGRhdGEuZm9ybml0dXJhTHVjZS5wb2RQZHIpO1xyXG4gICAgICAgIHNldChzdXBwbHkuY29udHJhY3RDb2RlLCBkYXRhLmZvcm5pdHVyYUx1Y2UuY29kaWNlQ29udHJhdHRvKTtcclxuICAgICAgICBzZXQoc3VwcGx5LmFzc2V0Q29kZSwgZGF0YS5mb3JuaXR1cmFMdWNlLmNvZGljZUFzc2V0KTtcclxuICAgICAgICBzZXQoc3VwcGx5LmFzc2V0SWQsIGRhdGEuZm9ybml0dXJhTHVjZS5zdXBwbHlDb2RlKTtcclxuICAgICAgICBzZXQoc3VwcGx5LnBkZkNvZGUsIGRhdGEuZm9ybml0dXJhTHVjZS5jb2RpY2VQREYpO1xyXG4gICAgICAgIHNldChzdXBwbHkua3dBdG9tLCBkYXRhLmZvcm5pdHVyYUx1Y2UucG90ZW56YUltcGVnbmF0YSk7XHJcbiAgICAgICAgc2V0KHN1cHBseS52b2x0YWdlQXRvbSwgZGF0YS5mb3JuaXR1cmFMdWNlLmxpdmVsbG9UZW5zaW9uZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChkYXRhLmZvcm5pdHVyYUdhcykge1xyXG4gICAgICAgIGNvbnN0IHN1cHBseSA9IGdldChhY2NvdW50Lmdhc1N1cHBseSk7XHJcbiAgICAgICAgaWYgKCFzdXBwbHkpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBQcmVjb25kaXRpb25GYWlsZWRFcnJvcigndW5leHBlY3RlZCBnYXMgc3VwcGx5IGlzIG51bGwnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2V0KHN1cHBseS5wZHIsIGRhdGEuZm9ybml0dXJhR2FzLnBvZFBkcik7XHJcbiAgICAgICAgc2V0KHN1cHBseS5jb250cmFjdENvZGUsIGRhdGEuZm9ybml0dXJhR2FzLmNvZGljZUNvbnRyYXR0byk7XHJcbiAgICAgICAgc2V0KHN1cHBseS5hc3NldENvZGUsIGRhdGEuZm9ybml0dXJhR2FzLmNvZGljZUFzc2V0KTtcclxuICAgICAgICBzZXQoc3VwcGx5LmFzc2V0SWQsIGRhdGEuZm9ybml0dXJhR2FzLnN1cHBseUNvZGUpO1xyXG4gICAgICAgIHNldChzdXBwbHkucGRmQ29kZSwgZGF0YS5mb3JuaXR1cmFHYXMuY29kaWNlUERGKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gVE9ETyBpbXBvc3RhcmUgaWwgcmVzdG8gZGVpIHBhcmFtZXRyaSwgcG90ZW56YUltcGVnbmF0YSwgbGl2ZWxsb1RlbnNpb25lLCBjb2RpY2VBdGVjbywgcGVydGluZW56YSwgZmxhZ0NvcnJldHRvcmVcclxuXHJcbiAgICAgIHJldHVybiBhY2NvdW50O1xyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIHJlYWRvbmx5IG9sZEN1c3RvbWVyOiB7XHJcbiAgICBzZWdtZW50OiBTZWdtZW50O1xyXG4gIH0gJiBWb2x0dXJhdG87XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgY3VzdG9tZXIkOiBBc3luY0F0b208Q3VzdG9tZXI+LFxyXG4gICAgb2xkQ3VzdG9tZXI6IFZvbHR1cmF0byxcclxuICAgIHBvd2VyOiBib29sZWFuLFxyXG4gICAgZ2FzOiBib29sZWFuLFxyXG4gICAgY29kZTogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICBzdXBlcihjdXN0b21lciQsIHBvd2VyLCBnYXMsIGNvZGUpO1xyXG4gICAgdGhpcy5vbGRDdXN0b21lciA9IHtcclxuICAgICAgLi4ub2xkQ3VzdG9tZXIsXHJcbiAgICAgIHNlZ21lbnQ6IG9sZEN1c3RvbWVyLnNlZ21lbnRvIGFzIFNlZ21lbnQsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXSwiZmlsZSI6IkM6L1VzZXJzL2FpbnRyb25hL0Rlc2t0b3AvQXBwL3JlYWN0L25hai9saWJzL2RhdGEtYWNjZXNzL3NyYy9saWIvYXRvbXMtZ2VuZXJhdG9ycy9UcmFuc2ZlckFjY291bnQudHMifQ==